/*!
 * KickJS 0.5.0 - New BSD License
 * http://www.kickjs.org/
 * License: https://raw.github.com/mortennobel/KickJS/master/license.txt
 *
 * KickJS Uses
 * - glMatrix.js (New BSD License) (https://raw.github.com/toji/gl-matrix/master/LICENSE.md)
 * - WebGL DebugContext (debug mode only - New BSD License like) (https://www.khronos.org/registry/webgl/sdk/debug/webgl-debug.js)
 */
define("kick/core/Constants",[],function(){var e={};return Object.defineProperties(e,{_VERSION:{value:"0.5.0",configurable:!0,enumerable:!0},_ASSERT:{value:!1,enumerable:!0,configurable:!0},_DEBUG:{value:!1,enumerable:!0,configurable:!0},_DEGREE_TO_RADIAN:{value:.01745329251994,enumerable:!0},_RADIAN_TO_DEGREE:{value:57.2957795130824,enumerable:!0},_EPSILON:{value:1e-5,enumerable:!0},GL_DEPTH_BUFFER_BIT:{value:256,enumerable:!0},GL_STENCIL_BUFFER_BIT:{value:1024,enumerable:!0},GL_COLOR_BUFFER_BIT:{value:16384,enumerable:!0},GL_POINTS:{value:0,enumerable:!0},GL_LINES:{value:1,enumerable:!0},GL_LINE_LOOP:{value:2,enumerable:!0},GL_LINE_STRIP:{value:3,enumerable:!0},GL_TRIANGLES:{value:4,enumerable:!0},GL_TRIANGLE_STRIP:{value:5,enumerable:!0},GL_TRIANGLE_FAN:{value:6,enumerable:!0},GL_ZERO:{value:0,enumerable:!0},GL_ONE:{value:1,enumerable:!0},GL_SRC_COLOR:{value:768,enumerable:!0},GL_ONE_MINUS_SRC_COLOR:{value:769,enumerable:!0},GL_SRC_ALPHA:{value:770,enumerable:!0},GL_ONE_MINUS_SRC_ALPHA:{value:771,enumerable:!0},GL_DST_ALPHA:{value:772,enumerable:!0},GL_ONE_MINUS_DST_ALPHA:{value:773,enumerable:!0},GL_DST_COLOR:{value:774,enumerable:!0},GL_ONE_MINUS_DST_COLOR:{value:775,enumerable:!0},GL_SRC_ALPHA_SATURATE:{value:776,enumerable:!0},GL_FUNC_ADD:{value:32774,enumerable:!0},GL_BLEND_EQUATION:{value:32777,enumerable:!0},GL_BLEND_EQUATION_RGB:{value:32777,enumerable:!0},GL_BLEND_EQUATION_ALPHA:{value:34877,enumerable:!0},GL_FUNC_SUBTRACT:{value:32778,enumerable:!0},GL_FUNC_REVERSE_SUBTRACT:{value:32779,enumerable:!0},GL_BLEND_DST_RGB:{value:32968,enumerable:!0},GL_BLEND_SRC_RGB:{value:32969,enumerable:!0},GL_BLEND_DST_ALPHA:{value:32970,enumerable:!0},GL_BLEND_SRC_ALPHA:{value:32971,enumerable:!0},GL_CONSTANT_COLOR:{value:32769,enumerable:!0},GL_ONE_MINUS_CONSTANT_COLOR:{value:32770,enumerable:!0},GL_CONSTANT_ALPHA:{value:32771,enumerable:!0},GL_ONE_MINUS_CONSTANT_ALPHA:{value:32772,enumerable:!0},GL_BLEND_COLOR:{value:32773,enumerable:!0},GL_ARRAY_BUFFER:{value:34962,enumerable:!0},GL_ELEMENT_ARRAY_BUFFER:{value:34963,enumerable:!0},GL_ARRAY_BUFFER_BINDING:{value:34964,enumerable:!0},GL_ELEMENT_ARRAY_BUFFER_BINDING:{value:34965,enumerable:!0},GL_STREAM_DRAW:{value:35040,enumerable:!0},GL_STATIC_DRAW:{value:35044,enumerable:!0},GL_DYNAMIC_DRAW:{value:35048,enumerable:!0},GL_BUFFER_SIZE:{value:34660,enumerable:!0},GL_BUFFER_USAGE:{value:34661,enumerable:!0},GL_CURRENT_VERTEX_ATTRIB:{value:34342,enumerable:!0},GL_FRONT:{value:1028,enumerable:!0},GL_BACK:{value:1029,enumerable:!0},GL_FRONT_AND_BACK:{value:1032,enumerable:!0},GL_TEXTURE_2D:{value:3553,enumerable:!0},GL_CULL_FACE:{value:2884,enumerable:!0},GL_BLEND:{value:3042,enumerable:!0},GL_DITHER:{value:3024,enumerable:!0},GL_STENCIL_TEST:{value:2960,enumerable:!0},GL_DEPTH_TEST:{value:2929,enumerable:!0},GL_SCISSOR_TEST:{value:3089,enumerable:!0},GL_POLYGON_OFFSET_FILL:{value:32823,enumerable:!0},GL_SAMPLE_ALPHA_TO_COVERAGE:{value:32926,enumerable:!0},GL_SAMPLE_COVERAGE:{value:32928,enumerable:!0},GL_NO_ERROR:{value:0,enumerable:!0},GL_INVALID_ENUM:{value:1280,enumerable:!0},GL_INVALID_VALUE:{value:1281,enumerable:!0},GL_INVALID_OPERATION:{value:1282,enumerable:!0},GL_OUT_OF_MEMORY:{value:1285,enumerable:!0},GL_CW:{value:2304,enumerable:!0},GL_CCW:{value:2305,enumerable:!0},GL_LINE_WIDTH:{value:2849,enumerable:!0},GL_ALIASED_POINT_SIZE_RANGE:{value:33901,enumerable:!0},GL_ALIASED_LINE_WIDTH_RANGE:{value:33902,enumerable:!0},GL_CULL_FACE_MODE:{value:2885,enumerable:!0},GL_FRONT_FACE:{value:2886,enumerable:!0},GL_DEPTH_RANGE:{value:2928,enumerable:!0},GL_DEPTH_WRITEMASK:{value:2930,enumerable:!0},GL_DEPTH_CLEAR_VALUE:{value:2931,enumerable:!0},GL_DEPTH_FUNC:{value:2932,enumerable:!0},GL_STENCIL_CLEAR_VALUE:{value:2961,enumerable:!0},GL_STENCIL_FUNC:{value:2962,enumerable:!0},GL_STENCIL_FAIL:{value:2964,enumerable:!0},GL_STENCIL_PASS_DEPTH_FAIL:{value:2965,enumerable:!0},GL_STENCIL_PASS_DEPTH_PASS:{value:2966,enumerable:!0},GL_STENCIL_REF:{value:2967,enumerable:!0},GL_STENCIL_VALUE_MASK:{value:2963,enumerable:!0},GL_STENCIL_WRITEMASK:{value:2968,enumerable:!0},GL_STENCIL_BACK_FUNC:{value:34816,enumerable:!0},GL_STENCIL_BACK_FAIL:{value:34817,enumerable:!0},GL_STENCIL_BACK_PASS_DEPTH_FAIL:{value:34818,enumerable:!0},GL_STENCIL_BACK_PASS_DEPTH_PASS:{value:34819,enumerable:!0},GL_STENCIL_BACK_REF:{value:36003,enumerable:!0},GL_STENCIL_BACK_VALUE_MASK:{value:36004,enumerable:!0},GL_STENCIL_BACK_WRITEMASK:{value:36005,enumerable:!0},GL_VIEWPORT:{value:2978,enumerable:!0},GL_SCISSOR_BOX:{value:3088,enumerable:!0},GL_COLOR_CLEAR_VALUE:{value:3106,enumerable:!0},GL_COLOR_WRITEMASK:{value:3107,enumerable:!0},GL_UNPACK_ALIGNMENT:{value:3317,enumerable:!0},GL_PACK_ALIGNMENT:{value:3333,enumerable:!0},GL_MAX_TEXTURE_SIZE:{value:3379,enumerable:!0},GL_MAX_VIEWPORT_DIMS:{value:3386,enumerable:!0},GL_SUBPIXEL_BITS:{value:3408,enumerable:!0},GL_RED_BITS:{value:3410,enumerable:!0},GL_GREEN_BITS:{value:3411,enumerable:!0},GL_BLUE_BITS:{value:3412,enumerable:!0},GL_ALPHA_BITS:{value:3413,enumerable:!0},GL_DEPTH_BITS:{value:3414,enumerable:!0},GL_STENCIL_BITS:{value:3415,enumerable:!0},GL_POLYGON_OFFSET_UNITS:{value:10752,enumerable:!0},GL_POLYGON_OFFSET_FACTOR:{value:32824,enumerable:!0},GL_TEXTURE_BINDING_2D:{value:32873,enumerable:!0},GL_SAMPLE_BUFFERS:{value:32936,enumerable:!0},GL_SAMPLES:{value:32937,enumerable:!0},GL_SAMPLE_COVERAGE_VALUE:{value:32938,enumerable:!0},GL_SAMPLE_COVERAGE_INVERT:{value:32939,enumerable:!0},GL_COMPRESSED_TEXTURE_FORMATS:{value:34467,enumerable:!0},GL_DONT_CARE:{value:4352,enumerable:!0},GL_FASTEST:{value:4353,enumerable:!0},GL_NICEST:{value:4354,enumerable:!0},GL_GENERATE_MIPMAP_HINT:{value:33170,enumerable:!0},GL_BYTE:{value:5120,enumerable:!0},GL_UNSIGNED_BYTE:{value:5121,enumerable:!0},GL_SHORT:{value:5122,enumerable:!0},GL_UNSIGNED_SHORT:{value:5123,enumerable:!0},GL_INT:{value:5124,enumerable:!0},GL_UNSIGNED_INT:{value:5125,enumerable:!0},GL_FLOAT:{value:5126,enumerable:!0},GL_DEPTH_COMPONENT:{value:6402,enumerable:!0},GL_ALPHA:{value:6406,enumerable:!0},GL_RGB:{value:6407,enumerable:!0},GL_RGBA:{value:6408,enumerable:!0},GL_LUMINANCE:{value:6409,enumerable:!0},GL_LUMINANCE_ALPHA:{value:6410,enumerable:!0},GL_UNSIGNED_SHORT_4_4_4_4:{value:32819,enumerable:!0},GL_UNSIGNED_SHORT_5_5_5_1:{value:32820,enumerable:!0},GL_UNSIGNED_SHORT_5_6_5:{value:33635,enumerable:!0},GL_FRAGMENT_SHADER:{value:35632,enumerable:!0},GL_VERTEX_SHADER:{value:35633,enumerable:!0},GL_MAX_VERTEX_ATTRIBS:{value:34921,enumerable:!0},GL_MAX_VERTEX_UNIFORM_VECTORS:{value:36347,enumerable:!0},GL_MAX_VARYING_VECTORS:{value:36348,enumerable:!0},GL_MAX_COMBINED_TEXTURE_IMAGE_UNITS:{value:35661,enumerable:!0},GL_MAX_VERTEX_TEXTURE_IMAGE_UNITS:{value:35660,enumerable:!0},GL_MAX_TEXTURE_IMAGE_UNITS:{value:34930,enumerable:!0},GL_MAX_FRAGMENT_UNIFORM_VECTORS:{value:36349,enumerable:!0},GL_SHADER_TYPE:{value:35663,enumerable:!0},GL_DELETE_STATUS:{value:35712,enumerable:!0},GL_LINK_STATUS:{value:35714,enumerable:!0},GL_VALIDATE_STATUS:{value:35715,enumerable:!0},GL_ATTACHED_SHADERS:{value:35717,enumerable:!0},GL_ACTIVE_UNIFORMS:{value:35718,enumerable:!0},GL_ACTIVE_ATTRIBUTES:{value:35721,enumerable:!0},GL_SHADING_LANGUAGE_VERSION:{value:35724,enumerable:!0},GL_CURRENT_PROGRAM:{value:35725,enumerable:!0},GL_NEVER:{value:512,enumerable:!0},GL_LESS:{value:513,enumerable:!0},GL_EQUAL:{value:514,enumerable:!0},GL_LEQUAL:{value:515,enumerable:!0},GL_GREATER:{value:516,enumerable:!0},GL_NOTEQUAL:{value:517,enumerable:!0},GL_GEQUAL:{value:518,enumerable:!0},GL_ALWAYS:{value:519,enumerable:!0},GL_KEEP:{value:7680,enumerable:!0},GL_REPLACE:{value:7681,enumerable:!0},GL_INCR:{value:7682,enumerable:!0},GL_DECR:{value:7683,enumerable:!0},GL_INVERT:{value:5386,enumerable:!0},GL_INCR_WRAP:{value:34055,enumerable:!0},GL_DECR_WRAP:{value:34056,enumerable:!0},GL_VENDOR:{value:7936,enumerable:!0},GL_RENDERER:{value:7937,enumerable:!0},GL_VERSION:{value:7938,enumerable:!0},GL_NEAREST:{value:9728,enumerable:!0},GL_LINEAR:{value:9729,enumerable:!0},GL_NEAREST_MIPMAP_NEAREST:{value:9984,enumerable:!0},GL_LINEAR_MIPMAP_NEAREST:{value:9985,enumerable:!0},GL_NEAREST_MIPMAP_LINEAR:{value:9986,enumerable:!0},GL_LINEAR_MIPMAP_LINEAR:{value:9987,enumerable:!0},GL_TEXTURE_MAG_FILTER:{value:10240,enumerable:!0},GL_TEXTURE_MIN_FILTER:{value:10241,enumerable:!0},GL_TEXTURE_WRAP_S:{value:10242,enumerable:!0},GL_TEXTURE_WRAP_T:{value:10243,enumerable:!0},GL_TEXTURE:{value:5890,enumerable:!0},GL_TEXTURE_CUBE_MAP:{value:34067,enumerable:!0},GL_TEXTURE_BINDING_CUBE_MAP:{value:34068,enumerable:!0},GL_TEXTURE_CUBE_MAP_POSITIVE_X:{value:34069,enumerable:!0},GL_TEXTURE_CUBE_MAP_NEGATIVE_X:{value:34070,enumerable:!0},GL_TEXTURE_CUBE_MAP_POSITIVE_Y:{value:34071,enumerable:!0},GL_TEXTURE_CUBE_MAP_NEGATIVE_Y:{value:34072,enumerable:!0},GL_TEXTURE_CUBE_MAP_POSITIVE_Z:{value:34073,enumerable:!0},GL_TEXTURE_CUBE_MAP_NEGATIVE_Z:{value:34074,enumerable:!0},GL_MAX_CUBE_MAP_TEXTURE_SIZE:{value:34076,enumerable:!0},GL_TEXTURE0:{value:33984,enumerable:!0},GL_TEXTURE1:{value:33985,enumerable:!0},GL_TEXTURE2:{value:33986,enumerable:!0},GL_TEXTURE3:{value:33987,enumerable:!0},GL_TEXTURE4:{value:33988,enumerable:!0},GL_TEXTURE5:{value:33989,enumerable:!0},GL_TEXTURE6:{value:33990,enumerable:!0},GL_TEXTURE7:{value:33991,enumerable:!0},GL_TEXTURE8:{value:33992,enumerable:!0},GL_TEXTURE9:{value:33993,enumerable:!0},GL_TEXTURE10:{value:33994,enumerable:!0},GL_TEXTURE11:{value:33995,enumerable:!0},GL_TEXTURE12:{value:33996,enumerable:!0},GL_TEXTURE13:{value:33997,enumerable:!0},GL_TEXTURE14:{value:33998,enumerable:!0},GL_TEXTURE15:{value:33999,enumerable:!0},GL_TEXTURE16:{value:34e3,enumerable:!0},GL_TEXTURE17:{value:34001,enumerable:!0},GL_TEXTURE18:{value:34002,enumerable:!0},GL_TEXTURE19:{value:34003,enumerable:!0},GL_TEXTURE20:{value:34004,enumerable:!0},GL_TEXTURE21:{value:34005,enumerable:!0},GL_TEXTURE22:{value:34006,enumerable:!0},GL_TEXTURE23:{value:34007,enumerable:!0},GL_TEXTURE24:{value:34008,enumerable:!0},GL_TEXTURE25:{value:34009,enumerable:!0},GL_TEXTURE26:{value:34010,enumerable:!0},GL_TEXTURE27:{value:34011,enumerable:!0},GL_TEXTURE28:{value:34012,enumerable:!0},GL_TEXTURE29:{value:34013,enumerable:!0},GL_TEXTURE30:{value:34014,enumerable:!0},GL_TEXTURE31:{value:34015,enumerable:!0},GL_ACTIVE_TEXTURE:{value:34016,enumerable:!0},GL_REPEAT:{value:10497,enumerable:!0},GL_CLAMP_TO_EDGE:{value:33071,enumerable:!0},GL_MIRRORED_REPEAT:{value:33648,enumerable:!0},GL_FLOAT_VEC2:{value:35664,enumerable:!0},GL_FLOAT_VEC3:{value:35665,enumerable:!0},GL_FLOAT_VEC4:{value:35666,enumerable:!0},GL_INT_VEC2:{value:35667,enumerable:!0},GL_INT_VEC3:{value:35668,enumerable:!0},GL_INT_VEC4:{value:35669,enumerable:!0},GL_BOOL:{value:35670,enumerable:!0},GL_BOOL_VEC2:{value:35671,enumerable:!0},GL_BOOL_VEC3:{value:35672,enumerable:!0},GL_BOOL_VEC4:{value:35673,enumerable:!0},GL_FLOAT_MAT2:{value:35674,enumerable:!0},GL_FLOAT_MAT3:{value:35675,enumerable:!0},GL_FLOAT_MAT4:{value:35676,enumerable:!0},GL_SAMPLER_2D:{value:35678,enumerable:!0},GL_SAMPLER_CUBE:{value:35680,enumerable:!0},GL_VERTEX_ATTRIB_ARRAY_ENABLED:{value:34338,enumerable:!0},GL_VERTEX_ATTRIB_ARRAY_SIZE:{value:34339,enumerable:!0},GL_VERTEX_ATTRIB_ARRAY_STRIDE:{value:34340,enumerable:!0},GL_VERTEX_ATTRIB_ARRAY_TYPE:{value:34341,enumerable:!0},GL_VERTEX_ATTRIB_ARRAY_NORMALIZED:{value:34922,enumerable:!0},GL_VERTEX_ATTRIB_ARRAY_POINTER:{value:34373,enumerable:!0},GL_VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:{value:34975,enumerable:!0},GL_COMPILE_STATUS:{value:35713,enumerable:!0},GL_LOW_FLOAT:{value:36336,enumerable:!0},GL_MEDIUM_FLOAT:{value:36337,enumerable:!0},GL_HIGH_FLOAT:{value:36338,enumerable:!0},GL_LOW_INT:{value:36339,enumerable:!0},GL_MEDIUM_INT:{value:36340,enumerable:!0},GL_HIGH_INT:{value:36341,enumerable:!0},GL_FRAMEBUFFER:{value:36160,enumerable:!0},GL_RENDERBUFFER:{value:36161,enumerable:!0},GL_RGBA4:{value:32854,enumerable:!0},GL_RGB5_A1:{value:32855,enumerable:!0},GL_RGB565:{value:36194,enumerable:!0},GL_DEPTH_COMPONENT16:{value:33189,enumerable:!0},GL_STENCIL_INDEX:{value:6401,enumerable:!0},GL_STENCIL_INDEX8:{value:36168,enumerable:!0},GL_DEPTH_STENCIL:{value:34041,enumerable:!0},GL_RENDERBUFFER_WIDTH:{value:36162,enumerable:!0},GL_RENDERBUFFER_HEIGHT:{value:36163,enumerable:!0},GL_RENDERBUFFER_INTERNAL_FORMAT:{value:36164,enumerable:!0},GL_RENDERBUFFER_RED_SIZE:{value:36176,enumerable:!0},GL_RENDERBUFFER_GREEN_SIZE:{value:36177,enumerable:!0},GL_RENDERBUFFER_BLUE_SIZE:{value:36178,enumerable:!0},GL_RENDERBUFFER_ALPHA_SIZE:{value:36179,enumerable:!0},GL_RENDERBUFFER_DEPTH_SIZE:{value:36180,enumerable:!0},GL_RENDERBUFFER_STENCIL_SIZE:{value:36181,enumerable:!0},GL_FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:{value:36048,enumerable:!0},GL_FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:{value:36049,enumerable:!0},GL_FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:{value:36050,enumerable:!0},GL_FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:{value:36051,enumerable:!0},GL_COLOR_ATTACHMENT0:{value:36064,enumerable:!0},GL_DEPTH_ATTACHMENT:{value:36096,enumerable:!0},GL_STENCIL_ATTACHMENT:{value:36128,enumerable:!0},GL_DEPTH_STENCIL_ATTACHMENT:{value:33306,enumerable:!0},GL_NONE:{value:0,enumerable:!0},GL_FRAMEBUFFER_COMPLETE:{value:36053,enumerable:!0},GL_FRAMEBUFFER_INCOMPLETE_ATTACHMENT:{value:36054,enumerable:!0},GL_FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:{value:36055,enumerable:!0},GL_FRAMEBUFFER_INCOMPLETE_DIMENSIONS:{value:36057,enumerable:!0},GL_FRAMEBUFFER_UNSUPPORTED:{value:36061,enumerable:!0},GL_FRAMEBUFFER_BINDING:{value:36006,enumerable:!0},GL_RENDERBUFFER_BINDING:{value:36007,enumerable:!0},GL_MAX_RENDERBUFFER_SIZE:{value:34024,enumerable:!0},GL_INVALID_FRAMEBUFFER_OPERATION:{value:1286,enumerable:!0},GL_UNPACK_FLIP_Y_WEBGL:{value:37440,enumerable:!0},GL_UNPACK_PREMULTIPLY_ALPHA_WEBGL:{value:37441,enumerable:!0},GL_CONTEXT_LOST_WEBGL:{value:37442,enumerable:!0},GL_UNPACK_COLORSPACE_CONVERSION_WEBGL:{value:37443,enumerable:!0},GL_BROWSER_DEFAULT_WEBGL:{value:37444,enumerable:!0}}),e}),define("kick/core/EngineSingleton",["./Constants"],function(e){var t={},n=null;return Object.defineProperty(t,"engine",{set:function(e){n!==null&&!1&&console.log("Engine is created twice in same context."),n=e},get:function(){return n==null&&!1&&console.log("Engine is not initialized yet."),n}}),Object.freeze(t),t}),define("kick/core/Util",["require","./Constants","./EngineSingleton"],function(e,t,n){var r=!1,i=!1,s=new ArrayBuffer(4),o=new Uint32Array(s),u=new Uint8Array(s),a;return a={deserializeConfig:function(e,t){var r,i=n.engine,s;if(typeof e=="number")return e;if(Array.isArray(e)){s=new Array(e.length);for(r=0;r<e.length;r++)s[r]=a.deserializeConfig(e[r],t);e=s}else if(e&&e&&e.ref&&e.reftype)if(e.reftype==="project")e=i.project.load(e.ref);else if(e.reftype==="gameobject"||e.reftype==="component")e=t.getObjectByUID(e.ref);return e},deepCopy:function(e,t){var n,r=!1,i,s,o;t=t||[];for(i=0;i<t.length;i++)if(e instanceof t[i]){r=!0;break}s=typeof e;if(r)n=e;else if(e===null||typeof e=="undefined")n=null;else if(Array.isArray(e)||e.buffer instanceof ArrayBuffer){n=[];for(i=0;i<e.length;i++)n[i]=a.deepCopy(e[i],t)}else if(s==="object"){n={};for(o in e)e.hasOwnProperty(o)&&(n[o]=a.deepCopy(e[o],t))}else n=e;return n},copyStaticPropertiesToObject:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&Object.defineProperty(e,n,{value:t[n]})},hasProperty:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},toCamelCase:function(e,t){t||(t="");var n,r=!0,i,s="",o;for(n=0;n<e.length;n++){i=e.charAt(n);if(i!=="_")break;s+=i}for(;n<e.length;n++)i=e.charAt(n),o=i==="_",o&&(i=t),s+=r?i.toUpperCase():i.toLowerCase(),r=o;return s},getJSONReference:function(t){var r=n.engine;if(t===null)return null;var i=t instanceof e("kick/scene/GameObject"),s=!i&&t.gameObject instanceof e("kick/scene/GameObject");return s||i?{ref:r.getUID(t),name:typeof t.name=="string"?t.name:"",reftype:i?"gameobject":"component"}:{ref:t.uid,name:t.name,reftype:"project"}},componentToJSON:function(e,t){var r,s=n.engine,o={},u={},f={type:t||e.constructor.name,uid:s.getUID(e),config:o},l,c;i&&e===n.engine&&a.fail("Util.componentToJSON parameters has changed to Util.componentToJSON(kick.scene.Component, String)"),f.type===""&&a.fail("Cannot serialize object type. Either provide toJSON function or use explicit function name 'function SomeObject(){}' ");var h=function(e){var t,n,r,i;if(Array.isArray(e)){t=[];for(n=0;n<e.length;n++)r=h(e[n]),t.push(r);return t}return i=typeof e,i!=="function"?e&&e.buffer instanceof ArrayBuffer?a.typedArrayToArray(e):i==="object"?a.getJSONReference(e):e:u};for(r in e)a.hasProperty(e,r)&&r!=="gameObject"&&(l=e[r],c=h(l),c!==u&&(o[r]=c));return f},applyConfig:function(e,t,n){var r=a.contains,i=a.hasProperty;t=t||{},n=n||[];for(var s in t)typeof t[s]!="function"&&!r(n,s)&&i(e,s)&&(e[s]=t[s]);t.uid&&t.uid!==e.uid&&(e.uid=t.uid)},getParameter:function(e,t){var n="[\\?&]"+t+"=([^&#]*)",r=new RegExp(n),i=r.exec(e);return i===null?null:i[1]},getParameterInt:function(e,t,n){var r=a.getParameter(e,t);return r===null?n:parseInt(r,10)},getParameterFloat:function(e,t,n){var r=a.getParameter(e,t);return r===null?n:parseFloat(r)},scaleImage:function(e,t,n){var r=document.createElement("canvas"),i;return r.width=t,r.height=n,i=r.getContext("2d"),i.drawImage(e,0,0,e.width,e.height,0,0,r.width,r.height),r},typedArrayToArray:function(e){var t=e.length,n=new Array(t),r;for(r=0;r<t;r++)n[r]=e[r];return n},removeElementFromArray:function(e,t,n){var r=!1,i;for(i=e.length-1;i>=0;i--)if(e[i]===t){r=!0,e.splice(i,1);if(!n)break}return r},removeElementsFromArray:function(e,t){var n,r;for(n=e.length-1;n>=0;n--)for(r=t.length-1;r>=0;r--)e[n]===t[r]&&e.splice(n,1)},insertSorted:function(e,t,n){var r;n||(n=a.numberSortFunction);for(r=t.length-1;r>=0;r--)if(n(t[r],e)<=0){t.splice(r+1,0,e);return}t.unshift(e)},numberSortFunction:function(e,t){return e-t},contains:function(e,t){var n;for(n=e.length-1;n>=0;n--)if(e[n]===t)return!0;return!1},uint32ToVec4:function(e,t){var n;t||(t=new Float32Array(4)),o[0]=e;for(n=0;n<4;n++)t[n]=u[n]/255;return t},vec4ToUint32:function(e){var t;for(t=0;t<4;t++)u[t]=e[t]*255;return o[0]},vec4uint8ToUint32:function(e){var t;for(t=0;t<4;t++)u[t]=e[t];return o[0]},utf8Encode:function(e){var t=[],n,i;for(n=0;n<e.length;n++)i=e.charCodeAt(n),i<127?t.push(i):i<=2047?(t.push(192+(i>>6)),t.push(128+(i&63))):i<=65535?(t.push(224+(i>>12)),t.push(128+(i>>6&63)),t.push(128+(i&63))):r&&a.fail("Unsupported character. Charcode "+i);return new Uint8Array(t)},removeAllProperties:function(e){for(var t in e)e.hasOwnProperty(t)&&delete e[t]},utf8Decode:function(e){var t="",n,i,s,o,u;for(n=0;n<e.length;n++)i=e[n],(i&128)===0?t+=String.fromCharCode(i):(i&224)===192?(n++,s=e[n],i=(i&31)<<6,s&=63,u=i+s,t+=String.fromCharCode(u)):(i&240)===224?(n++,s=e[n],n++,o=e[n],i=(i&31)<<12,s=(s&63)<<6,o&=63,u=i+s+o,t+=String.fromCharCode(u)):r&&a.fail("Unsupported encoding");return t},isPowerOfTwo:function(e){return(e&e-1)===0},nextHighestPowerOfTwo:function(e){var t;--e;for(t=1;t<32;t<<=1)e|=e>>t;return e+1},convertSubMeshesToTriangleIndices:function(e,t,n){var r=[],i,s;for(i=0;i<e.length;i++){s=a.convertToTriangleIndices(e[i],t,n);if(!s)return null;r=r.concat(a.typedArrayToArray(s))}return r},convertToTriangleIndices:function(e,t,n){if(t===4)return e;if(t!==5)return null;var r,i=1,s=[e[0],e[1],e[2]];for(r=3;r<e.length;r++){if(n)if(e[r-1]===e[r]||e[r-2]===e[r]||e[r-1]===e[r-2])continue;r%2===i?(s.push(e[r-1]),s.push(e[r-2]),s.push(e[r])):(s.push(e[r-2]),s.push(e[r-1]),s.push(e[r]))}return s},warn:function(e){debugger;console.log(e)},fail:function(e){debugger;console.error(e)}},a}),define("kick/core/ChunkData",["./Util","./Constants"],function(e,t){var n=e.utf8Decode,r=e.utf8Encode,i=!1,s=e.fail,o=new Uint8Array(4);return function(){var e=61441,t=1,u=1,a=2,f=3,l=4,c=5,h=6,p=7,d=8,v=function(e,t,n,r){var i=this;this.chunkId=e,this.chunkType=t,this.chunkDataLength=n,this.data=r,Object.defineProperties(this,{paddingSize:{get:function(){var e=i.data.length*i.data.BYTES_PER_ELEMENT,t=e%8;return t?8-t:0}},paddingData:{get:function(){return o.subarray(0,i.paddingSize)}}})},m=this,g=[],y=function(){return 8},b=function(){var e=0,t=8,n;for(n=0;n<g.length;n++)e+=g[n].chunkDataLength+t+g[n].paddingSize;return e},w=function(e){return e instanceof Float32Array?u:e instanceof Float64Array?a:e instanceof Int16Array?f:e instanceof Int32Array?l:e instanceof Int8Array?c:e instanceof Uint16Array?h:e instanceof Uint8Array?d:null},E=function(e){return e===u?Float32Array:e===a?Float64Array:e===f?Int16Array:e===l?Int32Array:e===c?Int8Array:e===h?Uint16Array:e===d?Uint8Array:null};this.getSize=function(){var e=y()+b(),t=e%8;return t!==0&&(e+=8-t),e},this.serialize=function(){var n=new ArrayBuffer(m.getSize()),r=0,i=new Uint8Array(n,0),s=new Uint16Array(n,r),o,u,a,f;s[0]=e,s[1]=t,r+=4,o=new Uint32Array(n,r),o[0]=g.length,r+=4;for(u=0;u<g.length;u++)s=new Uint16Array(n,r),s[0]=g[u].chunkId,s[1]=g[u].chunkType,r+=4,o=new Uint32Array(n,r),o[0]=g[u].chunkDataLength,r+=4,a=E(g[u].chunkType),f=new a(n),f.set(g[u].data,r/f.BYTES_PER_ELEMENT),r+=g[u].chunkDataLength,i.set(g[u].paddingData,r),r+=g[u].paddingSize;return n},this.get=function(e){var t;for(t=0;t<g.length;t++)if(g[t].chunkId===e)return g[t].data;return null},this.getString=function(e){var t=m.get(e);return t?n(t):null},this.getNumber=function(e){var t=m.get(e);return t?t[0]:null},this.getArrayBuffer=function(e){var t=m.get(e),n,r;return t?(n=new ArrayBuffer(t.length*t.BYTES_PER_ELEMENT),r=new Uint8Array(n),r.set(t),n):null},this.remove=function(e){var t;for(t=0;t<g.length;t++)if(g[t].chunkId===e)return g=g.splice(t,1),!0;return!1},this.setString=function(e,t){var n=r(t);m.set(e,n)},this.setNumber=function(e,t){var n=new Float32Array([t]);m.set(e,n)},this.setArrayBuffer=function(e,t){m.set(e,new Uint8Array(t))},this.set=function(e,t){m.remove(e);var n=w(t),r;n?(r=t.length*t.BYTES_PER_ELEMENT,g.push(new v(e,n,r,t))):i&&s("Unsupported array type")},this.deserialize=function(n){if(n instanceof ArrayBuffer){var r=[],o=0,u=new Uint16Array(n,o),a,f,l,c,h,p,d,m,y;if(u[0]!==e||u[1]!==t)return i&&(u[0]!==e?s("Invalid magic number"):s("Unsupported version number")),!1;o+=4,a=new Uint32Array(n,o),f=a[0],o+=4;for(l=0;l<f;l++)u=new Uint16Array(n,o),c=u[0],h=u[1],o+=4,a=new Uint32Array(n,o),p=a[0],o+=4,d=E(h),m=new d(n,o,p/d.BYTES_PER_ELEMENT),y=new v(c,h,p,m),r.push(y),o+=p,o+=y.paddingSize;return g=r,!0}return i&&s("binaryData is not instanceof ArrayBuffer"),!1}}}),define("kick/math/Vec4",["kick/core/Constants"],function(e){var t=function(e,t){var n,r=0,i=e.length/t,s=[];for(n=0;n<i;n++,r+=t)s[n]=e.subarray(r,r+t);return s};return{array:function(e,n){var r=new Float32Array(e*4);return n&&(n.mem=r),t(r,4)},wrapArray:function(e){return t(e,4)},create:function(){return new Float32Array(4)},clone:function(e){var t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},fromValues:function(e,t,n,r){var i=new Float32Array(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},set:function(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e},add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},subtract:function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e},multiply:function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e},divide:function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e},min:function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},max:function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},scale:function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},distance:function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],s=t[3]-e[3];return Math.sqrt(n*n+r*r+i*i+s*s)},squaredDistance:function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],s=t[3]-e[3];return n*n+r*r+i*i+s*s},length:function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)},squaredLength:function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i},negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},normalize:function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n*n+r*r+i*i+s*s;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o),e},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},lerp:function(e,t,n,r){var i=t[0],s=t[1],o=t[2],u=t[3];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e[2]=o+r*(n[2]-o),e[3]=u+r*(n[3]-u),e},transformMat4:function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,e[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,e[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,e[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,e},transformQuat:function(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[0],u=n[1],a=n[2],f=n[3],l=f*r+u*s-a*i,c=f*i+a*r-o*s,h=f*s+o*i-u*r,p=-o*r-u*i-a*s;return e[0]=l*f+p*-o+c*-a-h*-u,e[1]=c*f+p*-u+h*-o-l*-a,e[2]=h*f+p*-a+l*-u-c*-o,e},forEach:function(){var e=new Float32Array(4);return function(t,n,r,i,s,o){var u,a;n||(n=4),r||(r=0),i?a=Math.min(i*n+r,t.length):a=t.length;for(u=r;u<a;u+=n)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],e[3]=t[u+3],s(e,e,o),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2],t[u+3]=e[3];return t}}(),equal:function(e,t,n){var r;n||(n=1e-5);for(r=0;r<2;r++)if(Math.abs(e[r]-t[r])>n)return!1;return!0},str:function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"}}}),define("kick/math/Mat4",["./Vec4"],function(e){var t=1e-6,n=function(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)},r,i=function(e,t){t||(t=e);var n=e[0],r=e[1],i=e[2],s=e[3],o=Math.sqrt(n*n+r*r+i*i+s*s);return o===0?(t[0]=0,t[1]=0,t[2]=0,t[3]=0,t):(o=1/o,t[0]=n*o,t[1]=r*o,t[2]=i*o,t[3]=s*o,t)},s=function(t,n){function w(e,t){return t<0?-Math.abs(e):Math.abs(e)}var s,o,u,a,f=n[0],l=n[4],c=n[8],h=n[1],p=n[5],d=n[9],v=n[2],m=n[6],g=n[10],y,b=e;return y=Math.pow(r.determinant(n),1/3),a=Math.sqrt(Math.max(0,y+f+p+g))/2,s=Math.sqrt(Math.max(0,y+f-p-g))/2,o=Math.sqrt(Math.max(0,y-f+p-g))/2,u=Math.sqrt(Math.max(0,y-f-p+g))/2,s=w(s,m-d),o=w(o,c-v),u=w(u,h-l),b.copy(t,[s,o,u,a]),i(t),t};return r={create:function(){var e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},clone:function(e){var t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},setTRS:function(e,t,n,r){var i=r[0],s=r[1],o=r[2],u=n[0],a=n[1],f=n[2],l=n[3],c=u+u,h=a+a,p=f+f,d=u*c,v=u*h,m=u*p,g=a*h,y=a*p,b=f*p,w=l*c,E=l*h,S=l*p;return e[0]=(1-(g+b))*i,e[1]=(v+S)*i,e[2]=(m-E)*i,e[3]=0,e[4]=(v-S)*s,e[5]=(1-(d+b))*s,e[6]=(y+w)*s,e[7]=0,e[8]=(m+E)*o,e[9]=(y-w)*o,e[10]=(1-(d+g))*o,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},setTRSInverse:function(e,t,n,r){var i=r[0],s=r[1],o=r[2],u=n[0],a=n[1],f=n[2],l=n[3],c=u+u,h=a+a,p=f+f,d=u*c,v=u*h,m=u*p,g=a*h,y=a*p,b=f*p,w=l*c,E=l*h,S=l*p,x=(1-(g+b))*i,T=(v+S)*i,N=(m-E)*i,C=(v-S)*s,k=(1-(d+b))*s,L=(y+w)*s,A=(m+E)*o,O=(y-w)*o,M=(1-(d+g))*o,_=t[0],D=t[1],P=t[2],H=1,B=x*k-T*C,j=x*L-N*C,F=T*L-N*k,I=A*D-O*_,q=A*P-M*_,R=A*H,U=O*P-M*D,z=O*H,W=M*H,X=B*W-j*z+F*R,V;return X?(V=1/X,e[0]=(k*W-L*z)*V,e[1]=(-T*W+N*z)*V,e[2]=H*F*V,e[3]=0,e[4]=(-C*W+L*R)*V,e[5]=(x*W-N*R)*V,e[6]=-H*j*V,e[7]=0,e[8]=(C*z-k*R)*V,e[9]=(-x*z+T*R)*V,e[10]=H*B*V,e[11]=0,e[12]=(-C*U+k*q-L*I)*V,e[13]=(x*U-T*q+N*I)*V,e[14]=(-_*F+D*j-P*B)*V,e[15]=(A*F-O*j+M*B)*V,e):null},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},transpose:function(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],s=t[6],o=t[7],u=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=s,e[11]=t[14],e[12]=i,e[13]=o,e[14]=u}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},invert:function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15],y=n*u-r*o,b=n*a-i*o,w=n*f-s*o,E=r*a-i*u,S=r*f-s*u,x=i*f-s*a,T=l*v-c*d,N=l*m-h*d,C=l*g-p*d,k=c*m-h*v,L=c*g-p*v,A=h*g-p*m,O=y*A-b*L+w*k+E*C-S*N+x*T;return O?(O=1/O,e[0]=(u*A-a*L+f*k)*O,e[1]=(i*L-r*A-s*k)*O,e[2]=(v*x-m*S+g*E)*O,e[3]=(h*S-c*x-p*E)*O,e[4]=(a*C-o*A-f*N)*O,e[5]=(n*A-i*C+s*N)*O,e[6]=(m*w-d*x-g*b)*O,e[7]=(l*x-h*w+p*b)*O,e[8]=(o*L-u*C+f*T)*O,e[9]=(r*C-n*L-s*T)*O,e[10]=(d*S-v*w+g*y)*O,e[11]=(c*w-l*S-p*y)*O,e[12]=(u*N-o*k-a*T)*O,e[13]=(n*k-r*N+i*T)*O,e[14]=(v*b-d*E-m*y)*O,e[15]=(l*E-c*b+h*y)*O,e):null},adjoint:function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15];return e[0]=u*(h*g-p*m)-c*(a*g-f*m)+v*(a*p-f*h),e[1]=-(r*(h*g-p*m)-c*(i*g-s*m)+v*(i*p-s*h)),e[2]=r*(a*g-f*m)-u*(i*g-s*m)+v*(i*f-s*a),e[3]=-(r*(a*p-f*h)-u*(i*p-s*h)+c*(i*f-s*a)),e[4]=-(o*(h*g-p*m)-l*(a*g-f*m)+d*(a*p-f*h)),e[5]=n*(h*g-p*m)-l*(i*g-s*m)+d*(i*p-s*h),e[6]=-(n*(a*g-f*m)-o*(i*g-s*m)+d*(i*f-s*a)),e[7]=n*(a*p-f*h)-o*(i*p-s*h)+l*(i*f-s*a),e[8]=o*(c*g-p*v)-l*(u*g-f*v)+d*(u*p-f*c),e[9]=-(n*(c*g-p*v)-l*(r*g-s*v)+d*(r*p-s*c)),e[10]=n*(u*g-f*v)-o*(r*g-s*v)+d*(r*f-s*u),e[11]=-(n*(u*p-f*c)-o*(r*p-s*c)+l*(r*f-s*u)),e[12]=-(o*(c*m-h*v)-l*(u*m-a*v)+d*(u*h-a*c)),e[13]=n*(c*m-h*v)-l*(r*m-i*v)+d*(r*h-i*c),e[14]=-(n*(u*m-a*v)-o*(r*m-i*v)+d*(r*a-i*u)),e[15]=n*(u*h-a*c)-o*(r*h-i*c)+l*(r*a-i*u),e},determinant:function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8],l=e[9],c=e[10],h=e[11],p=e[12],d=e[13],v=e[14],m=e[15],g=t*o-n*s,y=t*u-r*s,b=t*a-i*s,w=n*u-r*o,E=n*a-i*o,S=r*a-i*u,x=f*d-l*p,T=f*v-c*p,N=f*m-h*p,C=l*v-c*d,k=l*m-h*d,L=c*m-h*v;return g*L-y*k+b*C+w*N-E*T+S*x},multiply:function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=t[9],p=t[10],d=t[11],v=t[12],m=t[13],g=t[14],y=t[15],b=n[0],w=n[1],E=n[2],S=n[3];return e[0]=b*r+w*u+E*c+S*v,e[1]=b*i+w*a+E*h+S*m,e[2]=b*s+w*f+E*p+S*g,e[3]=b*o+w*l+E*d+S*y,b=n[4],w=n[5],E=n[6],S=n[7],e[4]=b*r+w*u+E*c+S*v,e[5]=b*i+w*a+E*h+S*m,e[6]=b*s+w*f+E*p+S*g,e[7]=b*o+w*l+E*d+S*y,b=n[8],w=n[9],E=n[10],S=n[11],e[8]=b*r+w*u+E*c+S*v,e[9]=b*i+w*a+E*h+S*m,e[10]=b*s+w*f+E*p+S*g,e[11]=b*o+w*l+E*d+S*y,b=n[12],w=n[13],E=n[14],S=n[15],e[12]=b*r+w*u+E*c+S*v,e[13]=b*i+w*a+E*h+S*m,e[14]=b*s+w*f+E*p+S*g,e[15]=b*o+w*l+E*d+S*y,e},translate:function(e,t,n){var r=n[0],i=n[1],s=n[2],o,u,a,f,l,c,h,p,d,v,m,g;return t===e?(e[12]=t[0]*r+t[4]*i+t[8]*s+t[12],e[13]=t[1]*r+t[5]*i+t[9]*s+t[13],e[14]=t[2]*r+t[6]*i+t[10]*s+t[14],e[15]=t[3]*r+t[7]*i+t[11]*s+t[15]):(o=t[0],u=t[1],a=t[2],f=t[3],l=t[4],c=t[5],h=t[6],p=t[7],d=t[8],v=t[9],m=t[10],g=t[11],e[0]=o,e[1]=u,e[2]=a,e[3]=f,e[4]=l,e[5]=c,e[6]=h,e[7]=p,e[8]=d,e[9]=v,e[10]=m,e[11]=g,e[12]=o*r+l*i+d*s+t[12],e[13]=u*r+c*i+v*s+t[13],e[14]=a*r+h*i+m*s+t[14],e[15]=f*r+p*i+g*s+t[15]),e},scale:function(e,t,n){var r=n[0],i=n[1],s=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},rotate:function(e,n,r,i){var s=i[0],o=i[1],u=i[2],a=Math.sqrt(s*s+o*o+u*u),f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_;return Math.abs(a)<t?null:(a=1/a,s*=a,o*=a,u*=a,f=Math.sin(r),l=Math.cos(r),c=1-l,h=n[0],p=n[1],d=n[2],v=n[3],m=n[4],g=n[5],y=n[6],b=n[7],w=n[8],E=n[9],S=n[10],x=n[11],T=s*s*c+l,N=o*s*c+u*f,C=u*s*c-o*f,k=s*o*c-u*f,L=o*o*c+l,A=u*o*c+s*f,O=s*u*c+o*f,M=o*u*c-s*f,_=u*u*c+l,e[0]=h*T+m*N+w*C,e[1]=p*T+g*N+E*C,e[2]=d*T+y*N+S*C,e[3]=v*T+b*N+x*C,e[4]=h*k+m*L+w*A,e[5]=p*k+g*L+E*A,e[6]=d*k+y*L+S*A,e[7]=v*k+b*L+x*A,e[8]=h*O+m*M+w*_,e[9]=p*O+g*M+E*_,e[10]=d*O+y*M+S*_,e[11]=v*O+b*M+x*_,n!==e&&(e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e)},rotateX:function(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[4],o=t[5],u=t[6],a=t[7],f=t[8],l=t[9],c=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*i+f*r,e[5]=o*i+l*r,e[6]=u*i+c*r,e[7]=a*i+h*r,e[8]=f*i-s*r,e[9]=l*i-o*r,e[10]=c*i-u*r,e[11]=h*i-a*r,e},rotateY:function(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[0],o=t[1],u=t[2],a=t[3],f=t[8],l=t[9],c=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i-f*r,e[1]=o*i-l*r,e[2]=u*i-c*r,e[3]=a*i-h*r,e[8]=s*r+f*i,e[9]=o*r+l*i,e[10]=u*r+c*i,e[11]=a*r+h*i,e},rotateZ:function(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[0],o=t[1],u=t[2],a=t[3],f=t[4],l=t[5],c=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i+f*r,e[1]=o*i+l*r,e[2]=u*i+c*r,e[3]=a*i+h*r,e[4]=f*i-s*r,e[5]=l*i-o*r,e[6]=c*i-u*r,e[7]=h*i-a*r,e},fromRotationTranslation:function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=r+r,a=i+i,f=s+s,l=r*u,c=r*a,h=r*f,p=i*a,d=i*f,v=s*f,m=o*u,g=o*a,y=o*f;return e[0]=1-(p+v),e[1]=c+y,e[2]=h-g,e[3]=0,e[4]=c-y,e[5]=1-(l+v),e[6]=d+m,e[7]=0,e[8]=h+g,e[9]=d-m,e[10]=1-(l+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},frustum:function(e,t,n,r,i,s,o){var u=1/(n-t),a=1/(i-r),f=1/(s-o);return e[0]=s*2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*a,e[6]=0,e[7]=0,e[8]=(n+t)*u,e[9]=(i+r)*a,e[10]=(o+s)*f,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*s*2*f,e[15]=0,e},perspective:function(e,t,n,r,i){var s=1/Math.tan(t/2),o=1/(r-i);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(i+r)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*i*r*o,e[15]=0,e},ortho:function(e,t,n,r,i,s,o){var u=1/(t-n),a=1/(r-i),f=1/(s-o);return e[0]=-2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*f,e[11]=0,e[12]=(t+n)*u,e[13]=(i+r)*a,e[14]=(o+s)*f,e[15]=1,e},lookAt:function(e,n,i,s){var o,u,a,f,l,c,h,p,d,v,m=n[0],g=n[1],y=n[2],b=s[0],w=s[1],E=s[2],S=i[0],x=i[1],T=i[2];return Math.abs(m-S)<t&&Math.abs(g-x)<t&&Math.abs(y-T)<t?r.identity(e):(h=m-S,p=g-x,d=y-T,v=1/Math.sqrt(h*h+p*p+d*d),h*=v,p*=v,d*=v,o=w*d-E*p,u=E*h-b*d,a=b*p-w*h,v=Math.sqrt(o*o+u*u+a*a),v?(v=1/v,o*=v,u*=v,a*=v):(o=0,u=0,a=0),f=p*a-d*u,l=d*o-h*a,c=h*u-p*o,v=Math.sqrt(f*f+l*l+c*c),v?(v=1/v,f*=v,l*=v,c*=v):(f=0,l=0,c=0),e[0]=o,e[1]=f,e[2]=h,e[3]=0,e[4]=u,e[5]=l,e[6]=p,e[7]=0,e[8]=a,e[9]=c,e[10]=d,e[11]=0,e[12]=-(o*m+u*g+a*y),e[13]=-(f*m+l*g+c*y),e[14]=-(h*m+p*g+d*y),e[15]=1,e)},toRotationMat:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},toMat3:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},toNormalMat3:function(e,t){var n=t[0],r=t[1],i=t[2],s=t[4],o=t[5],u=t[6],a=t[8],f=t[9],l=t[10],c=l*o-u*f,h=-l*s+u*a,p=f*s-o*a,d=n*c+r*h+i*p,v;return d?(v=1/d,e[0]=c*v,e[3]=(-l*r+i*f)*v,e[6]=(u*r-i*o)*v,e[1]=h*v,e[4]=(l*n-i*a)*v,e[7]=(-u*n+i*s)*v,e[2]=p*v,e[5]=(-f*n+r*a)*v,e[8]=(o*n-r*s)*v,e):null},toInverseMat3:function(e,t){var n=t[0],r=t[1],i=t[2],s=t[4],o=t[5],u=t[6],a=t[8],f=t[9],l=t[10],c=l*o-u*f,h=-l*s+u*a,p=f*s-o*a,d=n*c+r*h+i*p,v;return d?(v=1/d,e[0]=c*v,e[1]=(-l*r+i*f)*v,e[2]=(u*r-i*o)*v,e[3]=h*v,e[4]=(l*n-i*a)*v,e[5]=(-u*n+i*s)*v,e[6]=p*v,e[7]=(-f*n+r*a)*v,e[8]=(o*n-r*s)*v,e):null},multiplyVec3:function(e,t,n){var r=n[0],i=n[1],s=n[2];return e[0]=t[0]*r+t[4]*i+t[8]*s+t[12],e[1]=t[1]*r+t[5]*i+t[9]*s+t[13],e[2]=t[2]*r+t[6]*i+t[10]*s+t[14],e},multiplyVec3Vector:function(e,t,n){var r=n[0],i=n[1],s=n[2];return e[0]=t[0]*r+t[4]*i+t[8]*s,e[1]=t[1]*r+t[5]*i+t[9]*s,e[2]=t[2]*r+t[6]*i+t[10]*s,e[3]=t[3]*r+t[7]*i+t[11]*s,e},multiplyVec4:function(e,t,n){var r=n[0],i=n[1],s=n[2],o=n[3];return e[0]=t[0]*r+t[4]*i+t[8]*s+t[12]*o,e[1]=t[1]*r+t[5]*i+t[9]*s+t[13]*o,e[2]=t[2]*r+t[6]*i+t[10]*s+t[14]*o,e[3]=t[3]*r+t[7]*i+t[11]*s+t[15]*o,e},decompose:function(){var e=new Float32Array(16);return function(t,r,i,o){var u=[t[0],t[1],t[2]],a=[t[4],t[5],t[6]],f=[t[8],t[9],t[10]],l,c,h;return r[0]=t[12],r[1]=t[13],r[2]=t[14],o[0]=l=n(u),o[1]=c=n(a),o[2]=h=n(f),this.copy(e,t),e[0]/=l,e[1]/=l,e[2]/=l,e[4]/=c,e[5]/=c,e[6]/=c,e[8]/=h,e[9]/=h,e[10]/=h,s(i,e),[r,i,o]}}(),str:function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+"]"},strPretty:function(e){return"["+e[0]+", "+e[4]+", "+e[8]+", "+e[12]+"\n"+", "+e[1]+", "+e[5]+", "+e[9]+", "+e[13]+"\n"+", "+e[2]+", "+e[6]+", "+e[10]+", "+e[14]+"\n"+", "+e[3]+", "+e[7]+", "+e[11]+", "+e[15]+"]"}},r}),define("kick/math/Vec3",["kick/core/Constants","./Mat4"],function(e,t){var n=function(e,t){var n,r=0,i=e.length/t,s=[];for(n=0;n<i;n++,r+=t)s[n]=e.subarray(r,r+t);return s};return{wrapArray:function(e){return n(e,3)},array:function(e,t){var r=new Float32Array(e*3);return t&&(t.mem=r),n(r,3)},create:function(){return new Float32Array(3)},clone:function(e){var t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},fromValues:function(e,t,n){var r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=n,r},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},set:function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e},add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},subtract:function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},multiply:function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e},divide:function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e},min:function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},max:function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},scale:function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},distance:function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)},squaredDistance:function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i},length:function(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)},squaredLength:function(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r},negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},normalize:function(e,t){var n=t[0],r=t[1],i=t[2],s=n*n+r*r+i*i;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s),e},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},cross:function(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[0],u=n[1],a=n[2];return e[0]=i*a-s*u,e[1]=s*o-r*a,e[2]=r*u-i*o,e},lerp:function(e,t,n,r){var i=t[0],s=t[1],o=t[2];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e[2]=o+r*(n[2]-o),e},transformMat4:function(e,t,n){var r=t[0],i=t[1],s=t[2];return e[0]=n[0]*r+n[4]*i+n[8]*s+n[12],e[1]=n[1]*r+n[5]*i+n[9]*s+n[13],e[2]=n[2]*r+n[6]*i+n[10]*s+n[14],e},transformQuat:function(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[0],u=n[1],a=n[2],f=n[3],l=f*r+u*s-a*i,c=f*i+a*r-o*s,h=f*s+o*i-u*r,p=-o*r-u*i-a*s;return e[0]=l*f+p*-o+c*-a-h*-u,e[1]=c*f+p*-u+h*-o-l*-a,e[2]=h*f+p*-a+l*-u-c*-o,e},forEach:function(){var e=new Float32Array(3);return function(t,n,r,i,s,o){var u,a;n||(n=3),r||(r=0),i?a=Math.min(i*n+r,t.length):a=t.length;for(u=r;u<a;u+=n)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],s(e,e,o),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2];return t}}(),direction:function(e,t,n){var r=t[0]-n[0],i=t[1]-n[1],s=t[2]-n[2],o=Math.sqrt(r*r+i*i+s*s);return o?(o=1/o,e[0]=r*o,e[1]=i*o,e[2]=s*o,e):(e[0]=0,e[1]=0,e[2]=0,e)},dist:function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)},unproject:function(){var e=new Float32Array(16),n=new Float32Array(4);return function(r,i,s,o,u){return n[0]=(i[0]-u[0])*2/u[2]-1,n[1]=(i[1]-u[1])*2/u[3]-1,n[2]=2*i[2]-1,n[3]=1,t.multiply(e,o,s),t.invert(e,e)?(t.multiplyVec4(n,e,n),n[3]===0?null:(r[0]=n[0]/n[3],r[1]=n[1]/n[3],r[2]=n[2]/n[3],r)):null}}(),sphericalToCarterian:function(e,t){var n=t[0],r=-t[1],i=t[2],s=n*Math.cos(i);return e[0]=s*Math.cos(r),e[1]=n*Math.sin(i),e[2]=s*Math.sin(r),e},equal:function(e,t,n){var r;n||(n=1e-5);for(r=0;r<3;r++)if(Math.abs(e[r]-t[r])>n)return!1;return!0},cartesianToSpherical:function(e,t){var n=t[0],r=t[1],i=t[2],s;return n===0&&(n=1e-5),e[0]=s=Math.sqrt(n*n+r*r+i*i),e[1]=-Math.atan(i/n),n<0&&(e[1]+=Math.PI),e[2]=Math.asin(r/s),e},str:function(e){return"["+e[0]+", "+e[1]+", "+e[2]+"]"}}}),define("kick/math/Aabb",["kick/core/Constants","./Vec3","./Mat4"],function(e,t,n){return{create:function(e,t){var n=new Float32Array(6);return e?(n[0]=e[0],n[1]=e[1],n[2]=e[2],e.length===6?(n[3]=e[3],n[4]=e[4],n[5]=e[5]):t?(n[3]=t[0],n[4]=t[1],n[5]=t[2]):(n[3]=n[0],n[4]=n[1],n[5]=n[2])):(n[0]=Number.MAX_VALUE,n[1]=Number.MAX_VALUE,n[2]=Number.MAX_VALUE,n[3]=-Number.MAX_VALUE,n[4]=-Number.MAX_VALUE,n[5]=-Number.MAX_VALUE),n},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},transform:function(){var e=t.create(),r=new Float32Array(6);return function(t,i,s){var o=Number.MAX_VALUE,u=-Number.MAX_VALUE,a,f,l,c;this.copy(r,[o,o,o,u,u,u]);for(a=0;a<2;a++)for(f=0;f<2;f++)for(l=0;l<2;l++)e[0]=i[a*3],e[1]=i[f*3+1],e[2]=i[l*3+2],c=n.multiplyVec3(e,s,e),this.addPoint(r,r,c);return this.copy(t,r),t}}(),merge:function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e[4]=Math.max(t[4],n[4]),e[5]=Math.max(t[5],n[5]),e},addPoint:function(e,t,n){var r=n[0],i=n[1],s=n[2];return e[0]=Math.min(t[0],r),e[1]=Math.min(t[1],i),e[2]=Math.min(t[2],s),e[3]=Math.max(t[3],r),e[4]=Math.max(t[4],i),e[5]=Math.max(t[5],s),t},center:function(e,t){return e[0]=(t[0]+t[3])*.5,e[1]=(t[1]+t[4])*.5,e[2]=(t[2]+t[5])*.5,e},halfVec3:function(e,t){return e[0]=(t[3]-t[0])*.5,e[1]=(t[4]-t[1])*.5,e[2]=(t[5]-t[2])*.5,e},diagonal:function(e,t){return e[0]=t[3]-t[0],e[1]=t[4]-t[1],e[2]=t[5]-t[2],e},str:function(e){return"{("+e[0]+","+e[1]+","+e[2]+"),("+e[3]+","+e[4]+","+e[5]+")}"}}}),define("kick/math/Vec2",["kick/core/Constants"],function(e){var t=function(e,t){var n,r=0,i=e.length/t,s=[];for(n=0;n<i;n++,r+=t)s[n]=e.subarray(r,r+t);return s};return{wrapArray:function(e){return t(e,2)},array:function(e,n){var r=new Float32Array(e*2);return n&&(n.mem=r),t(r,2)},create:function(){return new Float32Array(2)},clone:function(e){var t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t},fromValues:function(e,t){var n=new Float32Array(2);return n[0]=e,n[1]=t,n},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e},set:function(e,t,n){return e[0]=t,e[1]=n,e},add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e},subtract:function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e},multiply:function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e},divide:function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e},min:function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e},max:function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e},scale:function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},distance:function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)},squaredDistance:function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r},length:function(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)},squaredLength:function(e){var t=e[0],n=e[1];return t*t+n*n},negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e},normalize:function(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i),e},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]},cross:function(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e},lerp:function(e,t,n,r){var i=t[0],s=t[1];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e},transformMat2:function(e,t,n){var r=t[0],i=t[1];return e[0]=r*n[0]+i*n[1],e[1]=r*n[2]+i*n[3],e},forEach:function(){var e=new Float32Array(2);return function(t,n,r,i,s,o){var u,a;n||(n=2),r||(r=0),i?a=Math.min(i*n+r,t.length):a=t.length;for(u=r;u<a;u+=n)e[0]=t[u],e[1]=t[u+1],s(e,e,o),t[u]=e[0],t[u+1]=e[1];return t}}(),equal:function(e,t,n){var r;n||(n=1e-5);for(r=0;r<2;r++)if(Math.abs(e[r]-t[r])>n)return!1;return!0},str:function(e){return"["+e[0]+", "+e[1]+"]"}}}),define("kick/mesh/MeshData",["kick/core/Constants","kick/core/Util","kick/core/ChunkData","kick/math/Aabb","kick/math/Vec2","kick/math/Vec3","kick/math/Vec4","kick/math/Mat4"],function(e,t,n,r,i,s,o,u){var a=!1,f;return f=function(e){var i={},o=this,l=[],c,h,p,d,v,m=function(){c=null,h=null,p=null},g=function(){return i.vertex},y=function(){return c},b=function(){var e=c.byteLength/p,t,n,r,s,o=0,u,a;i={};for(t=0;t<e;t++){for(r in h)if(h.hasOwnProperty(r)){s=h[r],u=s.type===5126?Float32Array:Int32Array,t===0&&(i[r]=new u(e*s.size)),a=new u(c,o+s.pointer);for(n=0;n<s.size;n++)i[r][t*s.size+n]=a[n]}o+=p}},w=function(e,n){if(e===5126||e===5124){var r=e===5126?Float32Array:Int32Array;return{get:function(){return!g()&&y()&&b(),i[n]},set:function(e){e?i[n]&&i[n].length===e.length?i[n].set(e):i[n]=new r(e):i[n]=null,m()}}}a&&t.fail("Unexpected type")},E=function(){var e=[],t=[],n=[],r=0,i=[],s,u,a,f,l=o.vertex,d=l?l.length/3:0,v={},m,g,y,b,w=function(s,u,a){var f=o[s];f&&(e.push(u),t.push(s),n.push(a),i.push(f),v[s]={pointer:r*4,size:u,normalized:!1,type:a,name:s},r+=u)};w("vertex",3,5126),w("normal",3,5126),w("uv1",2,5126),w("uv2",2,5126),w("tangent",4,5126),w("color",4,5126),w("int1",1,5124),w("int2",2,5124),w("int3",3,5124),w("int4",4,5124),m=new ArrayBuffer(r*d*4);for(u=0;u<d;u++){g=u*r*4;for(a=0;a<t.length;a++){n[a]===5126?s=new Float32Array(m,g):s=new Int32Array(m,g),y=i[a],b=e[a];for(f=0;f<b;f++)s[f]=y[u*b+f],g+=4}}c=m,h=v,p=r*4};this.serialize=function(){var e,t,r,i=new n;i.setArrayBuffer(1,o.interleavedArray),i.setString(2,JSON.stringify(o.interleavedArrayFormat)),i.setString(3,o.name||"MeshData"),e=o.subMeshes,t=e.length,i.setNumber(4,t),i.setNumber(5,o.vertexAttrLength);for(r=0;r<t;r++)i.set(10+r,e[r]);return i.serialize()},this.deserialize=function(e){var t=new n,r,i,s;if(t.deserialize(e)){o.interleavedArray=t.getArrayBuffer(1),o.interleavedArrayFormat=JSON.parse(t.getString(2)),o.name=t.getString(3),r=t.getNumber(4),o.vertexAttrLength=t.getNumber(5),i=[];for(s=0;s<r;s++)i[s]=t.get(10+s);return o.subMeshes=i,!0}return!1},Object.defineProperties(this,{aabb:{get:function(){var e,t,n,i,s=o.vertex;if(!s)return null;e=s.length,t=r.create();for(n=0;n<e;n+=3)i=s.subarray(n,n+3),r.addPoint(t,t,i);return t}},name:{get:function(){return v},set:function(e){v=e}},interleavedArray:{get:function(){return!y()&&g()&&E(),c},set:function(e){a&&e&&!(e instanceof ArrayBuffer)&&t.fail("MeshData.interleavedArray must be an ArrayBuffer"),e?c=e:m()}},interleavedArrayFormat:{get:function(){return!y()&&g()&&E(),h},set:function(e){if(a){var n,r;if(e!==null)for(n in e)r=e[n],typeof r=="object"&&(typeof r.pointer!="number"||typeof r.size!="number"||typeof r.normalized!="boolean"||typeof r.type!="number")&&t.fail("Invalid object signature - expected {pointer:,size:,normalized:,type:}")}e?h=e:m()}},vertexAttrLength:{get:function(){return!y()&&g()&&E(),p},set:function(e){a&&(typeof e!="number"||e<0)&&t.fail("Invalid MeshData.vertexAttrLength - expected a real number"),e?p=e:m()}},vertex:w(5126,"vertex"),normal:w(5126,"normal"),uv1:w(5126,"uv1"),uv2:w(5126,"uv2"),tangent:w(5126,"tangent"),color:w(5126,"color"),int1:w(5124,"int1"),int2:w(5124,"int2"),int3:w(5124,"int3"),int4:w(5124,"int4"),indices:{get:function(){return l===0?null:l[0]},set:function(e){e&&!(e instanceof Uint16Array)&&(e=new Uint16Array(e)),l[0]&&g()&&m(),e&&(l[0]=e)}},subMeshes:{get:function(){return l},set:function(e){var t;for(t=0;t<e.length;t++)e[t]&&!(e[t]instanceof Uint16Array)&&(e[t]=new Uint16Array(e[t]));l=e}},meshType:{get:function(){return d},set:function(e){a&&e!==1&&e!==4&&e!==6&&e!==5&&t.fail("MeshData.meshType must be GL_TRIANGLES, GL_TRIANGLE_FAN or GL_TRIANGLE_STRIP"),d=e}}}),this.isValid=function(){!g()&&y()&&b();var e=i.vertex.length/3,n,r;for(n=0;n<l.length;n++)for(r=l[n].length-1;r>=0;r--)if(l[n][r]>=e)return t.warn("_indices["+n+"]["+r+"] >= vertexCount"),!1;return!0},this.isVertexDataInitialized=g,this.isInterleavedDataInitialized=y,this.transform=function(e){var t=new f(this),n=s.wrapArray(t.vertex),r;for(r=n.length-1;r>=0;r--)u.multiplyVec3(n[r],e,n[r]);return t},this.combine=function(e,n){if(o.meshType!==e.meshType||o.meshType===6)return a?(o.meshType!==e.meshType?t.fail("Mesh.combine does not support different meshTypes"):t.fail("Mesh.combine does not support triangle fans"),null):null;var r=["vertex","normal","uv1","uv2","tangent","color","int1","int2","int3","int4","indices"],i,s,u,l;for(i=r.length-1;i>=0;i--)s=r[i],(!o[s]||!e[s])&&r.splice(i,1);return u=function(e,n,i){var s,o,u,a,f;for(s=r.length-1;s>=0;s--){u=r[s];if(!e[u])e[u]=t.typedArrayToArray(n[u]);else{a=n[u];if(i&&u==="indices"){a=new Uint16Array(a),f=a.length;for(o=0;o<f;o++)a[o]+=i}for(o=0;o<a.length;o++)e[u].push(a[o])}}},l={meshType:o.meshType},n&&(e=e.transform(n)),u(l,o,0),u(l,e,this.vertex.length/3),o.meshType===5&&l.indices.splice(o.indices,0,l.indices[o.indices.length],l.indices[o.indices.length+1]),new f(l)},function(){e||(e={});var r=function(){o.vertex=e.vertex?new Float32Array(e.vertex):null,o.normal=e.normal?new Float32Array(e.normal):null,o.uv1=e.uv1?new Float32Array(e.uv1):null,o.uv2=e.uv2?new Float32Array(e.uv2):null,o.tangent=e.tangent?new Float32Array(e.tangent):null,o.color=e.color?new Float32Array(e.color):null,o.int1=e.int1?new Int32Array(e.int1):null,o.int2=e.int2?new Int32Array(e.int2):null,o.int3=e.int3?new Int32Array(e.int3):null,o.int4=e.int4?new Int32Array(e.int4):null},i=function(){o.interleavedArray=e.interleavedArray,o.interleavedArrayFormat=e.interleavedArrayFormat,o.vertexAttrLength=e.vertexAttrLength};e instanceof f?e.isVertexDataInitialized()?r():(a&&(e.isInterleavedDataInitialized()||t.fail("Either vertex or interleaved data should be initialized")),i()):e.vertex?r():e.interleavedArray&&i(),o.name=e.name,o.indices=e.indices,o.meshType=e.meshType||4}()},f.prototype.createUv1=function(){var e=this.vertex.length/3;this.uv1=new Float32Array(e*2)},f.prototype.createUv2=function(){var e=this.vertex.length/3;this.uv2=new Float32Array(e*2)},f.prototype.recalculateNormals=function(){var e=this.vertex.length/3,n=t.convertSubMeshesToTriangleIndices(this.subMeshes,this.meshType,!0),r=n.length/3,i=s.wrapArray(this.vertex),o,u={},a=s.array(e,u),f=s.create(),l=s.create(),c=l,h=f,p,d,v=s.create(),m,g,y,b,w,E;if(!n)return!1;for(o=0;o<r;o++)m=n[o*3],g=n[o*3+1],y=n[o*3+2],b=i[m],w=i[g],E=i[y],s.subtract(f,w,b),s.subtract(l,E,b),s.normalize(f,f),s.normalize(l,l),s.cross(v,f,l),s.normalize(v,v),p=Math.acos(Math.max(-1,Math.min(1,s.dot(f,l)))),s.subtract(c,E,w),s.normalize(c,c),d=Math.PI-Math.max(-1,Math.min(1,Math.acos(s.dot(f,c)))),s.add(a[m],a[m],s.scale(h,v,p)),s.add(a[g],a[g],s.scale(h,v,d)),s.add(a[y],a[y],s.scale(h,v,Math.PI-p-d));for(o=0;o<e;o++)s.normalize(a[o],a[o]);this.normal=u.mem},f.prototype.recalculateTangents=function(){var e=s.wrapArray(this.vertex),n=e.length,r=s.wrapArray(this.normal),u=i.wrapArray(this.uv1),a=t.convertSubMeshesToTriangleIndices(this.subMeshes,this.meshType,!0),f=a.length/3,l=new Float32Array(n*4),c=o.wrapArray(l),h=s.array(n),p=s.array(n),d,v=0,m=s.create(),g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q;if(!a)return!1;for(d=0;d<f;d++)g=a[d*3],y=a[d*3+1],b=a[d*3+2],w=e[g],E=e[y],S=e[b],x=u[g],T=u[y],N=u[b],C=E[0]-w[0],k=S[0]-w[0],L=E[1]-w[1],A=S[1]-w[1],O=E[2]-w[2],M=S[2]-w[2],_=T[0]-x[0],D=N[0]-x[0],P=T[1]-x[1],H=N[1]-x[1],B=1/(_*H-D*P),I=s.clone([(H*C-P*k)*B,(H*L-P*A)*B,(H*O-P*M)*B]),q=s.clone([(_*k-D*C)*B,(_*A-D*L)*B,(_*M-D*O)*B]),s.add(h[g],h[g],I),s.add(h[y],h[y],I),s.add(h[b],h[b],I),s.add(p[g],p[g],q),s.add(p[y],p[y],q),s.add(p[b],p[b],q);for(d=0;d<n;d++)F=r[d],j=h[d],v=s.dot(F,j),s.scale(m,F,v),s.subtract(m,j,m),s.normalize(m,m),s.copy(c[d],m),c[d][3]=s.dot(s.cross(F,j,s.create()),p[d])<0?-1:1;return this.tangent=l,!0},f}),define("kick/mesh/MeshDataFactory",["./MeshData","kick/math/Vec2","kick/math/Vec3","kick/core/Constants","kick/core/Util"],function(e,t,n,r,i){return{createTriangleData:function(){var t=Math.sqrt(.75);return new e({name:"Triangle",vertex:[0,1,0,-t,-0.5,0,t,-0.5,0],uv1:[.5,1,.125,.25,.875,.25],normal:[0,0,1,0,0,1,0,0,1],indices:[0,1,2]})},createPlaneData:function(){return new e({name:"Plane",vertex:[1,-1,0,1,1,0,-1,-1,0,-1,1,0],uv1:[1,0,1,1,0,0,0,1],normal:[0,0,1,0,0,1,0,0,1,0,0,1],indices:[0,1,2,2,1,3]})},createUVSphereData:function(r,i,s){if(!r||r<3)r=64;if(!i||i<2)i=32;s||(s=1);var o,u,a=i*(r+1)*2+2*(i-1),f={},l=n.array(a,f),c={},h=n.array(a,c),p={},d=t.array(a,p),v=[],m=Math.PI/i,g=Math.PI/2,y=Math.PI*2,b=0,w,E,S,x,T,N,C,k,L,A;for(o=0;o<=i;o++){w=m*o-g,E=Math.sin(w),S=Math.cos(w);for(u=0;u<=r;u++)x=y/r*u,T=Math.sin(x),N=Math.cos(x),C=N*S,k=E,L=T*S,n.copy(l[b],[C,k,L]),t.copy(d[b],[1-u/r,o/i]),n.copy(h[b],[s*C,s*k,s*L]),b++}for(o=0;o<i;o++){o>0&&v.push(o*(r+1));for(u=0;u<=r;u++)b=o*(r+1)+u,v.push(b),v.push(b+r+1);o+1<i&&v.push(b+r+1)}return A={name:"UVSphere",vertex:c.mem,uv1:p.mem,normal:f.mem,indices:v,meshType:5},new e(A)},createCubeData:function(t){t||(t=1);var n={name:"Cube",vertex:[t,t,t,-t,t,t,-t,-t,t,t,-t,t,t,t,t,t,-t,t,t,-t,-t,t,t,-t,t,t,t,t,t,-t,-t,t,-t,-t,t,t,-t,t,t,-t,t,-t,-t,-t,-t,-t,-t,t,-t,-t,-t,t,-t,-t,t,-t,t,-t,-t,t,t,-t,-t,-t,-t,-t,-t,t,-t,t,t,-t],uv1:[1,1,0,1,0,0,1,0,0,1,0,0,1,0,1,1,1,0,1,1,0,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,0,0,1,0,1,1,0,1],normal:[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],color:[1,1,1,1,1,1,0,1,1,0,0,1,1,0,1,1,1,1,1,1,1,0,1,1,0,0,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,0,1,1,1,0,1,1,1,0,1,0,1,0,1,0,0,0,1,1,0,0,1,0,0,0,1,0,0,1,1,1,0,1,1,1,0,0,1,0,0,1,1,0,0,0,1,0,1,0,1,0,1,1,1],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]};return new e(n)}}}),define("kick/material/GLSLConstants",[],function(){return{"__error_fs.glsl":"#ifdef GL_ES\nprecision highp float;\n#endif\nvoid main(void)\n{\ngl_FragColor = vec4(1.0,0.5, 0.9, 1.0);\n}","__error_vs.glsl":"attribute vec3 vertex;\nuniform mat4 _mvProj;\nvoid main(void) {\ngl_Position = _mvProj * vec4(vertex, 1.0);\n} ","__pick_fs.glsl":"#ifdef GL_ES\nprecision mediump float;\n#endif\nvarying vec4 gameObjectUID;\nvoid main(void)\n{\ngl_FragColor = gameObjectUID;\n}","__pick_normal_fs.glsl":"#ifdef GL_ES\nprecision mediump float;\n#endif\nvarying vec3 vNormal;\nvoid main(void)\n{\ngl_FragColor = vec4(vNormal,0);\n}","__pick_normal_vs.glsl":"attribute vec3 vertex;\nattribute vec3 normal;\nuniform mat4 _mvProj;\nuniform mat3 _norm;\nvarying vec3 vNormal;\nvoid main(void) {\n// compute position\ngl_Position = _mvProj * vec4(vertex, 1.0);\nvNormal = (_norm * normal) / 2.0 + vec3(0.5, 0.5, 0.5);\n}","__pick_uv_fs.glsl":"#ifdef GL_ES\nprecision mediump float;\n#endif\nvarying vec2 vUV;\nvoid main(void)\n{\ngl_FragColor = vec4(vUV, 0, 0);\n}","__pick_uv_vs.glsl":"attribute vec3 vertex;\nattribute vec2 uv1;\nuniform mat4 _mvProj;\nuniform mat3 _norm;\nvarying vec2 vUV;\nvoid main(void) {\n// compute position\ngl_Position = _mvProj * vec4(vertex, 1.0);\nvUV = uv1;\n}","__pick_vs.glsl":"attribute vec3 vertex;\nuniform mat4 _mvProj;\nuniform vec4 _gameObjectUID;\nvarying vec4 gameObjectUID;\nvoid main(void) {\n// compute position\ngl_Position = _mvProj * vec4(vertex, 1.0);\ngameObjectUID = _gameObjectUID;\n}","__shadowmap_fs.glsl":"#ifdef GL_ES\nprecision highp float;\n#endif\nvec4 packDepth( const in float depth ) {\nconst vec4 bitShift = vec4( 16777216.0, 65536.0, 256.0, 1.0 );\nconst vec4 bitMask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bitShift );\nres -= res.xxyz * bitMask;\nreturn res;\n}\nvoid main() {\ngl_FragColor = packDepth( gl_FragCoord.z );\n}\n","__shadowmap_vs.glsl":"attribute vec3 vertex;\nuniform mat4 _mvProj;\nvoid main(void) {\ngl_Position = _mvProj * vec4(vertex, 1.0);\n} ","diffuse_fs.glsl":'precision mediump float;\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vEcPosition;\nuniform vec4 mainColor;\nuniform sampler2D mainTexture;\n#pragma include "light.glsl"\n#pragma include "shadowmap.glsl"\nvoid main(void)\n{\nvec3 normal = normalize(vNormal);\nvec3 directionalLight = getDirectionalLightDiffuse(normal,_dLight);\nvec3 pointLight = getPointLightDiffuse(normal,vEcPosition, _pLights);\nfloat visibility;\nif (SHADOWS){\nvisibility = computeLightVisibility();\n} else {\nvisibility = 1.0;\n}\nvec3 color = max((directionalLight+pointLight)*visibility,_ambient.xyz)*mainColor.xyz;\ngl_FragColor = vec4(texture2D(mainTexture,vUv).xyz*color, 1.0);\n}\n',"diffuse_vs.glsl":"attribute vec3 vertex;\nattribute vec3 normal;\nattribute vec2 uv1;\nuniform mat4 _mvProj;\nuniform mat4 _mv;\nuniform mat4 _lightMat;\nuniform mat3 _norm;\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec4 vShadowMapCoord;\nvarying vec3 vEcPosition;\nvoid main(void) {\nvec4 v = vec4(vertex, 1.0);\ngl_Position = _mvProj * v;\nvEcPosition = (_mv * v).xyz;\nvUv = uv1;\nvNormal = _norm * normal;\nvShadowMapCoord = _lightMat * v;\n} ","light.glsl":"vec3 getPointLightDiffuse(vec3 normal, vec3 ecPosition, mat3 pLights[LIGHTS]){\nvec3 diffuse = vec3(0.0);\nfor (int i=0;i<LIGHTS;i++){\nvec3 ecLightPos = pLights[i][0]; // light position in eye coordinates\nvec3 colorIntensity = pLights[i][1];\nvec3 attenuationVector = pLights[i][2];\n// direction from surface to light position\nvec3 VP = ecLightPos - ecPosition;\n// compute distance between surface and light position\nfloat d = length(VP);\n// normalize the vector from surface to light position\nVP = normalize(VP);\n// compute attenuation\nfloat attenuation = 1.0 / dot(vec3(1.0,d,d*d),attenuationVector); // short for constA + liniearA * d + quadraticA * d^2\nfloat nDotVP = max(0.0, dot(normal, VP));\ndiffuse += colorIntensity*nDotVP * attenuation;\n}\nreturn diffuse;\n}\nvoid getPointLight(vec3 normal, vec3 ecPosition, mat3 pLights[LIGHTS],float specularExponent, out vec3 diffuse, out float specular){\ndiffuse = vec3(0.0, 0.0, 0.0);\nspecular = 0.0;\nvec3 eye = vec3(0.0,0.0,1.0);\nfor (int i=0;i<LIGHTS;i++){\nvec3 ecLightPos = pLights[i][0]; // light position in eye coordinates\nvec3 colorIntensity = pLights[i][1];\nvec3 attenuationVector = pLights[i][2];\n// direction from surface to light position\nvec3 VP = ecLightPos - ecPosition;\n// compute distance between surface and light position\nfloat d = length(VP);\n// normalize the vector from surface to light position\nVP = normalize(VP);\n// compute attenuation\nfloat attenuation = 1.0 / dot(vec3(1.0,d,d*d),attenuationVector); // short for constA + liniearA * d + quadraticA * d^2\nvec3 halfVector = normalize(VP + eye);\nfloat nDotVP = max(0.0, dot(normal, VP));\nfloat nDotHV = max(0.0, dot(normal, halfVector));\nfloat pf;\nif (nDotVP == 0.0){\npf = 0.0;\n} else {\npf = pow(nDotHV, specularExponent);\n}\nbool isLightEnabled = (attenuationVector[0]+attenuationVector[1]+attenuationVector[2])>0.0;\nif (isLightEnabled){\ndiffuse += colorIntensity * nDotVP * attenuation;\nspecular += pf * attenuation;\n}\n}\n}\nvec3 getDirectionalLightDiffuse(vec3 normal, mat3 dLight){\nvec3 ecLightDir = dLight[0]; // light direction in eye coordinates\nvec3 colorIntensity = dLight[1];\nfloat diffuseContribution = max(dot(normal, ecLightDir), 0.0);\nreturn (colorIntensity * diffuseContribution);\n}\n// assumes that normal is normalized\nvoid getDirectionalLight(vec3 normal, mat3 dLight, float specularExponent, out vec3 diffuse, out float specular){\nvec3 ecLightDir = dLight[0]; // light direction in eye coordinates\nvec3 colorIntensity = dLight[1];\nvec3 halfVector = dLight[2];\nfloat diffuseContribution = max(dot(normal, ecLightDir), 0.0);\n	float specularContribution = max(dot(normal, halfVector), 0.0);\nspecular = pow(specularContribution, specularExponent);\n	diffuse = (colorIntensity * diffuseContribution);\n}\nuniform mat3 _dLight;\nuniform vec3 _ambient;\nuniform mat3 _pLights[LIGHTS];\n","shadowmap.glsl":"varying vec4 vShadowMapCoord;\nuniform sampler2D _shadowMapTexture;\nconst float shadowBias = 0.005;\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 16777216.0 ), 1.0 / ( 65536.0 ), 1.0 / 256.0, 1.0 );\nreturn dot( rgba_depth, bit_shift );\n}\nfloat computeLightVisibility(){\nvec3 shadowCoord = vShadowMapCoord.xyz / vShadowMapCoord.w;\nif (shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0){\nvec4 packedShadowDepth = texture2D(_shadowMapTexture,shadowCoord.xy);\nbool isMaxDepth = dot(packedShadowDepth, vec4(1.0,1.0,1.0,1.0))==4.0;\nif (!isMaxDepth){\nfloat shadowDepth = unpackDepth(packedShadowDepth);\nif (shadowDepth > shadowCoord.z - shadowBias){\nreturn 1.0;\n}\nreturn 0.0;\n}\n}\nreturn 1.0; // if outside shadow map, then not occcluded\n}","specular_fs.glsl":'precision mediump float;\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vEcPosition;\nuniform vec4 mainColor;\nuniform float specularExponent;\nuniform vec4 specularColor;\nuniform sampler2D mainTexture;\n#pragma include "light.glsl"\n#pragma include "shadowmap.glsl"\nvoid main(void)\n{\nvec3 normal = normalize(vNormal);\nvec3 diffuse;\nfloat specular;\ngetDirectionalLight(normal, _dLight, specularExponent, diffuse, specular);\nvec3 diffusePoint;\nfloat specularPoint;\ngetPointLight(normal,vEcPosition, _pLights,specularExponent,diffusePoint,specularPoint);\nfloat visibility;\nif (SHADOWS){\nvisibility = computeLightVisibility();\n} else {\nvisibility = 1.0;\n}\nvec3 color = max((diffuse+diffusePoint)*visibility,_ambient.xyz)*mainColor.xyz;\ngl_FragColor = vec4(texture2D(mainTexture,vUv).xyz*color.xyz, 1.0)+vec4((specular+specularPoint)*specularColor.xyz,0.0);\n}\n',"specular_vs.glsl":"attribute vec3 vertex;\nattribute vec3 normal;\nattribute vec2 uv1;\nuniform mat4 _mvProj;\nuniform mat4 _mv;\nuniform mat4 _lightMat;\nuniform mat3 _norm;\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vEcPosition;\nvarying vec4 vShadowMapCoord;\nvoid main(void) {\nvec4 v = vec4(vertex, 1.0);\ngl_Position = _mvProj * v;\nvUv = uv1;\nvEcPosition = (_mv * v).xyz;\nvNormal= _norm * normal;\nvShadowMapCoord = _lightMat * v;\n} ","transparent_diffuse_fs.glsl":'precision mediump float;\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vEcPosition;\nuniform vec4 mainColor;\nuniform float specularExponent;\nuniform vec4 specularColor;\nuniform sampler2D mainTexture;\n#pragma include "light.glsl"\nvoid main(void)\n{\nvec3 normal = normalize(vNormal);\nvec3 diffuseDirectionalLight = getDirectionalLightDiffuse(normal,_dLight);\nvec3 diffusePointLight = getPointLightDiffuse(normal,vEcPosition, _pLights);\nvec4 color = vec4(max(diffuseDirectionalLight+diffusePointLight,_ambient.xyz),1.0)*mainColor;\ngl_FragColor = texture2D(mainTexture,vUv)*color;\n}\n',"transparent_diffuse_vs.glsl":"attribute vec3 vertex;\nattribute vec3 normal;\nattribute vec2 uv1;\nuniform mat4 _mvProj;\nuniform mat3 _norm;\nuniform mat4 _mv;\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vEcPosition;\nvoid main(void) {\nvec4 v = vec4(vertex, 1.0);\n// compute position\ngl_Position = _mvProj * v;\nvEcPosition = (_mv * v).xyz;\nvUv = uv1;\n// compute light info\nvNormal= _norm * normal;\n} ","transparent_specular_fs.glsl":'precision mediump float;\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vEcPosition;\nuniform vec4 mainColor;\nuniform float specularExponent;\nuniform vec4 specularColor;\nuniform sampler2D mainTexture;\n#pragma include "light.glsl"\nvoid main(void)\n{\nvec3 normal = normalize(vNormal);\nvec3 diffuse;\nfloat specular;\ngetDirectionalLight(normal, _dLight, specularExponent, diffuse, specular);\nvec3 diffusePoint;\nfloat specularPoint;\ngetPointLight(normal,vEcPosition, _pLights,specularExponent,diffusePoint,specularPoint);\nvec4 color = vec4(max(diffuse+diffusePoint,_ambient.xyz),1.0)*mainColor;\ngl_FragColor = texture2D(mainTexture,vUv)*color+vec4((specular+specularPoint)*specularColor.xyz,0.0);\n}\n',"transparent_specular_vs.glsl":"attribute vec3 vertex;\nattribute vec3 normal;\nattribute vec2 uv1;\nuniform mat4 _mvProj;\nuniform mat4 _mv;\nuniform mat3 _norm;\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vEcPosition;\nvoid main(void) {\nvec4 v = vec4(vertex, 1.0);\n// compute position\ngl_Position = _mvProj * v;\nvEcPosition = (_mv * v).xyz;\nvUv = uv1;\n// compute light info\nvNormal= _norm * normal;\n} ","transparent_unlit_fs.glsl":"precision mediump float;\nvarying vec2 vUv;\nuniform vec4 mainColor;\nuniform sampler2D mainTexture;\nvoid main(void)\n{\ngl_FragColor = texture2D(mainTexture,vUv)*mainColor;\n}\n","transparent_unlit_vs.glsl":"attribute vec3 vertex;\nattribute vec2 uv1;\nuniform mat4 _mvProj;\nvarying vec2 vUv;\nvoid main(void) {\ngl_Position = _mvProj * vec4(vertex, 1.0);\nvUv = uv1;\n}","unlit_fs.glsl":"#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec2 vUv;\nuniform vec4 mainColor;\nuniform sampler2D mainTexture;\nvoid main(void)\n{\ngl_FragColor = vec4(texture2D(mainTexture,vUv).xyz*mainColor.xyz,1.0);\n}\n","unlit_vertex_color_fs.glsl":"precision mediump float;\nvarying vec2 vUv;\nvarying vec4 vColor;\nuniform vec4 mainColor;\nuniform sampler2D mainTexture;\nvoid main(void)\n{\ngl_FragColor = vec4(texture2D(mainTexture,vUv).xyz*mainColor.xyz*vColor.xyz,1.0);\n}\n","unlit_vertex_color_vs.glsl":"attribute vec3 vertex;\nattribute vec2 uv1;\nattribute vec4 color;\nuniform mat4 _mvProj;\nvarying vec2 vUv;\nvarying vec4 vColor;\nvoid main(void) {\ngl_Position = _mvProj * vec4(vertex, 1.0);\nvUv = uv1;\nvColor = color;\n}","unlit_vs.glsl":"attribute vec3 vertex;\nattribute vec2 uv1;\nuniform mat4 _mvProj;\nvarying vec2 vUv;\nvoid main(void) {\ngl_Position = _mvProj * vec4(vertex, 1.0);\nvUv = uv1;\n}"}}),define("kick/core/BuiltInResourceProvider",["./Util","kick/mesh/MeshDataFactory","kick/material/GLSLConstants","./Constants"],function(e,t,n,r){var i=!1;return function(r){var s=r.gl,o=this;Object.defineProperties(this,{protocol:{value:"kickjs://"}}),this.getMeshData=function(n,r,i){var s,o,u,a,f,l=e.getParameterInt,c=e.getParameterFloat;i&&i.resourceLoadingStarted&&i.resourceLoadingStarted(n,r);if(n.indexOf("kickjs://mesh/triangle/")===0)s=t.createTriangleData();else if(n.indexOf("kickjs://mesh/plane/")===0)s=t.createPlaneData();else if(n.indexOf("kickjs://mesh/uvsphere/")===0)o=l(n,"slices"),u=l(n,"stacks"),a=c(n,"radius"),s=t.createUVSphereData(o,u,a);else{if(n.indexOf("kickjs://mesh/cube/")!==0){e.fail("No meshdata found for "+n),i&&i.resourceLoadingStarted&&i.resourceLoadingFailed(n,r);return}f=c(n,"length"),s=t.createCubeData(f)}r.meshData=s,i&&i.resourceLoadingStarted&&i.resourceLoadingFinished(n,r)},this.getShaderData=function(t,s,o){var u,a,f,l,c=!1,h=!1,p=!0,d=1e3,v=n,m={},g=function(e){var n=t.indexOf("kickjs://shader/"+e+"/")===0;if(n){f=v[e+"_vs.glsl"],l=v[e+"_fs.glsl"],e.indexOf("transparent_")===0&&(c=!0,p=!1,d=2e3),e==="__shadowmap"&&(h=!0);if(e==="specular"||e==="transparent_specular")m={mainColor:[1,1,1,1],mainTexture:r.project.load(r.project.ENGINE_TEXTURE_WHITE),specularColor:[1,1,1,1],specularExponent:50};if(e==="diffuse"||e==="transparent_diffuse"||e==="unlit"||e==="unlit_vertex_color"||e==="transparent_unlit")m={mainColor:[1,1,1,1],mainTexture:r.project.load(r.project.ENGINE_TEXTURE_WHITE)}}return n},y=["specular","diffuse","__shadowmap","__error","__pick","__pick_normal","__pick_uv","transparent_specular","transparent_diffuse","unlit","unlit_vertex_color","transparent_unlit"];t==="kickjs://shader/default/"&&(t="kickjs://shader/diffuse/");for(u=0;u<y.length;u++)if(g(y[u]))break;i&&(f||e.fail("Cannot find shader url '"+t+"'")),a={blend:c,depthMask:p,renderOrder:d,polygonOffsetEnabled:h,vertexShaderSrc:f,fragmentShaderSrc:l,defaultUniforms:m},e.applyConfig(s,a),s.apply()},this.getImageData=function(t,n,r){r&&r.resourceLoadingStarted&&r.resourceLoadingStarted(url,n);var i,s=function(){r&&r.resourceLoadingFailed&&r.resourceLoadingFailed(url,n)},o,u="data:image/png;base64,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";if(t.indexOf("kickjs://texture/black/")===0)i=new Uint8Array([0,0,0,255,0,0,0,255,0,0,0,255,0,0,0,255]);else if(t.indexOf("kickjs://texture/white/")===0)i=new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]);else if(t.indexOf("kickjs://texture/gray/")===0)i=new Uint8Array([127,127,127,255,127,127,127,255,127,127,127,255,127,127,127,255]);else{if(t.indexOf("kickjs://texture/checkerboard/")!==0){if(t.indexOf("kickjs://texture/logo/")===0){n.setTemporaryTexture(),o=document.createElement("img"),o.onload=function(){n.generateMipmaps=!0,n.internalFormat=6408,n.magFilter=9729,n.minFilter=9987,n.setImage(o,t),r&&r.resourceLoadingStarted&&r.resourceLoadingFinished(url,n)},o.onerror=function(){s()},o.src=u;return}return e.fail("Unknown uri "+t),s(),null}i=new Uint8Array([255,255,255,255,0,0,0,255,0,0,0,255,255,255,255,255])}n.setImageData(2,2,0,5121,i,t),r&&r.resourceLoadingStarted&&r.resourceLoadingFinished(url,n)}}}),define("kick/core/Config",["./Util","./Constants"],function(e,t){return function(t){this.highDPISupport=t.highDPISupport||!0,this.shadows=t.shadows||!1,this.shadowDistance=t.shadowDistance||20,this.shadowNearMultiplier=t.shadowNearMultiplier||2,this.shadowMapQuality=t.shadowMapQuality||1,this.maxNumerOfLights=typeof t.maxNumerOfLights=="number"?t.maxNumerOfLights:1,this.enableDebugContext=typeof t.enableDebugContext=="boolean"?t.enableDebugContext:!1,this.preserveDrawingBuffer=t.preserveDrawingBuffer||!1,this.alpha=typeof t.alpha=="boolean"?t.alpha:!0,this.depth=typeof t.depth=="boolean"?t.depth:!0,this.stencil=typeof t.stencil=="boolean"?t.stencil:!1,this.antialias=typeof t.antialias=="boolean"?t.antialias:!0,this.premultipliedAlpha=typeof t.premultipliedAlpha=="boolean"?t.premultipliedAlpha:!0,this.checkCanvasResizeInterval=t.checkCanvasResizeInterval||0,this.webglNotFoundFn=function(){return t.webglNotFoundFn?typeof t.webglNotFoundFn=="string"?e.namespace(t.webglNotFoundFn):t.webglNotFoundFn:function(e){var t;e.innerHTML="",t=document.createElement("div"),t.style.cssText=e.style.cssText+";width:"+e.width+"px;height:"+e.height+"px;display: table-cell;vertical-align: middle;background:#ffeeee;",t.innerHTML="<div style='padding:12px;text-align: center;'>It doesn't appear your computer can support WebGL.<br><br><a href=\"http://get.webgl.org/troubleshooting/\">Click here for more information.</a></div>",e.parentNode.replaceChild(t,e)}}()}}),define("kick/core/GLState",["kick/core/Constants"],function(e){var t=!1;return function(){var e=this;this.currentClearColor=null,this.meshBuffer=null,this.meshShader=null,this.renderTarget=null,this.boundShader=null,this.currentMaterial=null,this.faceCulling=null,this.zTest=null,this.depthMaskCache=null,this.blendKey=null,this.polygonOffsetEnabled=null,this.viewportSize=null,this.clear=function(){var t;for(t in e)e.hasOwnProperty(t)&&t!=="clear"&&(e[t]=null)},t&&Object.preventExtensions(this)}}),define("kick/core/ResourceDescriptor",["require","./Util","./Constants","./EngineSingleton"],function(e,t,n,r){var i=!1;return function(t){var n=r.engine,s=t||{},o=s.type,u=s.uid,a=s.config;Object.defineProperties(this,{name:{get:function(){return a.name},set:function(e){a.name=e}},type:{value:o},config:{get:function(){return a}},uid:{value:u}}),this.updateConfig=function(e,t){a=e.toJSON?e.toJSON(t):e},this.instantiate=function(t,r){i&&(typeof t!="function"&&console.log("ResourceDescriptor.onSuccess is not a function"),n===t&&console.log("ResourceDescriptor.onSuccess is not "));var s=o.replace(/\./g,"/");e([s],function(e){var n=new e({uid:u});t(n)},r)},this.toJSON=function(){return{type:o,uid:u,config:a}}}}),define("kick/core/ProjectAsset",["kick/core/Constants","./Util","./EngineSingleton"],function(e,t,n){var r=!1;return function(e,i,s){var o=i&&i.uid?i.uid:0;Object.defineProperty(e,"uid",{get:function(){return o},set:function(e){r&&(typeof e!="number"&&t.fail("uid must be number"),o!==0&&e!==o&&t.fail("uid cannot be reassigned")),o=e}}),e.init=function(e,n){t.applyConfig(this,e,["uid"])},e.toJSON=function(){t.fail("toJSON does not exist for the Asset")},function(){n.engine.project.registerObject(e,s)}()}}),define("kick/material/UniformDescriptor",[],function(){return function(e,t,n,r){this.name=e,this.type=t,this.size=n,this.location=r,Object.freeze(this)}}),define("kick/math/Mat3",[],function(){return{create:function(){var e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e},clone:function(e){var t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},transpose:function(e,t){if(e===t){var n=t[1],r=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},invert:function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=l*o-u*f,h=-l*s+u*a,p=f*s-o*a,d=n*c+r*h+i*p;return d?(d=1/d,e[0]=c*d,e[1]=(-l*r+i*f)*d,e[2]=(u*r-i*o)*d,e[3]=h*d,e[4]=(l*n-i*a)*d,e[5]=(-u*n+i*s)*d,e[6]=p*d,e[7]=(-f*n+r*a)*d,e[8]=(o*n-r*s)*d,e):null},adjoint:function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8];return e[0]=o*l-u*f,e[1]=i*f-r*l,e[2]=r*u-i*o,e[3]=u*a-s*l,e[4]=n*l-i*a,e[5]=i*s-n*u,e[6]=s*f-o*a,e[7]=r*a-n*f,e[8]=n*o-r*s,e},determinant:function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8];return t*(f*s-o*a)+n*(-f*i+o*u)+r*(a*i-s*u)},toMat4:function(e,t){return e[15]=1,e[14]=0,e[13]=0,e[12]=0,e[11]=0,e[10]=t[8],e[9]=t[7],e[8]=t[6],e[7]=0,e[6]=t[5],e[5]=t[4],e[4]=t[3],e[3]=0,e[2]=t[2],e[1]=t[1],e[0]=t[0],e},multiply:function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=n[0],p=n[1],d=n[2],v=n[3],m=n[4],g=n[5],y=n[6],b=n[7],w=n[8];return e[0]=h*r+p*o+d*f,e[1]=h*i+p*u+d*l,e[2]=h*s+p*a+d*c,e[3]=v*r+m*o+g*f,e[4]=v*i+m*u+g*l,e[5]=v*s+m*a+g*c,e[6]=y*r+b*o+w*f,e[7]=y*i+b*u+w*l,e[8]=y*s+b*a+w*c,e},toQuat:function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=n+o+l,h;return e||(e=new Float32Array(4)),c>0?(h=.5/Math.sqrt(c+1),e[0]=(u-f)*h,e[1]=(a-i)*h,e[2]=(r-s)*h,e[3]=.25/h):n>o&&n>l?(h=2*Math.sqrt(1+n-o-l),e[0]=.25*h,e[1]=(s+r)/h,e[2]=(a+i)/h,e[3]=(u-f)/h):o>l?(h=2*Math.sqrt(1+o-n-l),e[0]=(s+r)/h,e[1]=.25*h,e[2]=(f+u)/h,e[3]=(a-i)/h):(h=2*Math.sqrt(1+l-n-o),e[0]=(a+i)/h,e[1]=(f+u)/h,e[2]=.25*h,e[3]=(r-s)/h),e},str:function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+"]"},strPretty:function(e){return"["+e[0]+", "+e[3]+", "+e[6]+"\n"+", "+e[1]+", "+e[4]+", "+e[7]+"\n"+", "+e[2]+", "+e[5]+", "+e[8]+"]"}}}),define("kick/material/Shader",["kick/core/ProjectAsset","kick/core/Constants","./GLSLConstants","kick/core/Util","./UniformDescriptor","kick/math/Vec3","kick/math/Vec4","kick/math/Mat4","kick/math/Mat3","kick/core/EngineSingleton"],function(e,t,n,r,i,s,o,u,a,f){var l,c=0,h=0,p=s.create(),d=o.create(),v=u.create(),m=a.create(),g=!1,y=function(e){return e.charAt(0)!=="_"};return l=function(s){e(this,s,"kick.material.Shader"),g&&s===f.engine&&r.fail("Shader constructor changed - engine parameter is removed");var o=f.engine,u=o.gl,a=o.glState,p=this,d=[],v=-1,m=!0,b=1029,w=513,E=!1,S=770,x=771,T=!1,N=2.5,C=10,k=1e3,L="memory://void",A="",O,M=[],_=[],D=[],P={},H=n,B=H["__error_vs.glsl"],j=H["__error_fs.glsl"],F,I=r.fail,q=-1,R=function(){O=(S+x*1e4)*(E?-1:1)},U=function(){var e;for(e=0;e<d.length;e++)d[e]()},z=function(e,n){var r,i,s=t;return e=l.getPrecompiledSource(o,e),n?r=u.createShader(35632):r=u.createShader(35633),u.shaderSource(r,e),u.compileShader(r),u.getShaderParameter(r,35713)?r:(i=u.getShaderInfoLog(r),typeof I=="function"&&I(i),null)},W=function(){var e=a.faceCulling;e!==b&&(b===0?u.disable(2884):((!e||e===0)&&u.enable(2884),u.cullFace(b)),a.faceCulling=b)},X=function(){a.zTest!==w&&(u.depthFunc(w),a.zTest=w),a.depthMaskCache!==m&&(u.depthMask(m),a.depthMaskCache=m)},V=function(){a.blendKey!==O&&(a.blendKey=O,E?u.enable(3042):u.disable(3042),u.blendFunc(S,x))},$=function(){a.polygonOffsetEnabled!==T&&(a.polygonOffsetEnabled=T,T?u.enable(32823):u.disable(32823)),T&&u.polygonOffset(N,C)},J=function(e,t){switch(e){case 5126:return new Float32Array(t);case 35674:return new Float32Array(4*t);case 35675:return new Float32Array(9*t);case 35676:return new Float32Array(16*t);case 35664:return new Float32Array(2*t);case 35665:return new Float32Array(3*t);case 35666:return new Float32Array(4*t);case 5124:return new Int32Array(t);case 35667:return new Int32Array(2*t);case 35668:return new Int32Array(3*t);case 35669:return new Int32Array(4*t);case 35680:return t!==1&&r.fail("Texture arrays not currently supported"),o.project.load(o.project.ENGINE_TEXTURE_CUBEMAP_WHITE);case 35678:return t!==1&&r.fail("Texture arrays not currently supported"),o.project.load(o.project.ENGINE_TEXTURE_WHITE);default:r.fail("Unknown type")}},K=function(e){var t,n,r,s=F,o,a;M=[],P={},F={},D.length=0,_.length=0;for(o=0;o<e;o++)t=u.getActiveUniform(v,o),r=u.getUniformLocation(v,t.name),n=new i(t.name,t.type,t.size,r),Object.freeze(n),M[o]=n,P[t.name]=n,y(t.name)?(a=J(t.type,t.size),F[t.name]=a,D.push(n)):_.push(n);s&&(p.defaultUniforms=s)};this.addListener=function(e){g&&typeof e!="function"&&r.warn("Shader.addListener: listenerFn not function"),d.push(e)},this.removeListener=function(e){g&&typeof e!="function"&&r.warn("Shader.removeListener: listenerFn not function"),r.removeElementFromArray(d,e,!0)},this.contextLost=function(){u=null,v=-1,M.length=0,_.length=0,D.length=0},this.contextRestored=function(e){u||(u=e,p.apply())},o.addContextListener(this),Object.defineProperties(this,{lookupUniform:{get:function(){return P}},activeUniforms:{get:function(){return M}},engineUniforms:{get:function(){return _}},materialUniforms:{get:function(){return D}},name:{get:function(){return A},set:function(e){A=e}},dataURI:{get:function(){return L},set:function(e){L!==e&&(L=e,L&&o.resourceLoader.getShaderData(L,p))}},gl:{value:u},glState:{value:a},defaultUniforms:{get:function(){return F},set:function(e){var t,n;for(t in F)F.hasOwnProperty(t)&&e.hasOwnProperty(t)&&(n=P[t].type,F[t]=l.convertUniformValue(n,e[t],o))}},vertexShaderSrc:{get:function(){return B},set:function(e){typeof e!="string"&&r.fail("Shader.vertexShaderSrc must be a string"),B=e}},fragmentShaderSrc:{get:function(){return j},set:function(e){typeof e!="string"&&r.fail("Shader.fragmentShaderSrc must be a string"),j=e}},renderOrder:{get:function(){return k},set:function(e){typeof e!="number"&&r.fail("Shader.renderOrder must be a number"),k=e}},errorLog:{get:function(){return I},set:function(e){g&&e&&typeof e!="function"&&r.fail("Shader.errorLog should be a function (or null)"),I=e}},engine:{value:o},shaderProgramId:{get:function(){return v}},polygonOffsetEnabled:{get:function(){return T},set:function(e){T=e}},polygonOffsetFactor:{get:function(){return N},set:function(e){N=e}},polygonOffsetUnits:{get:function(){return C},set:function(e){C=e}},faceCulling:{get:function(){return b},set:function(e){g&&e!==1028&&e!==1032&&e!==1029&&e!==0&&r.fail("Shader.faceCulling must be kick.material.Shader.FRONT, kick.material.Shader.BACK (default), kick.material.Shader.NONE"),b=e}},depthMask:{get:function(){return m},set:function(e){g&&typeof e!="boolean"&&r.fail("Shader.depthMask must be a boolean. Was "+typeof e),m=e}},zTest:{get:function(){return w},set:function(e){g&&e!==512&&e!==513&&e!==514&&e!==515&&e!==516&&e!==517&&e!==518&&e!==519&&r.fail("Shader.zTest must be 512, 513,514,515,516,517,518, or 519"),w=e}},blend:{get:function(){return E},set:function(e){g&&typeof e!="boolean"&&r.fail("Shader.blend must be a boolean"),E=e,R()}},blendSFactor:{get:function(){return S},set:function(e){if(g){var n=t;e!==0&&e!==1&&e!==768&&e!==769&&e!==774&&e!==775&&e!==770&&e!==771&&e!==772&&e!==773&&e!==32769&&e!==32770&&e!==32771&&e!==32772&&e!==776&&r.fail("Shader.blendSFactor must be a one of GL_ZERO, GL_ONE, GL_SRC_COLOR, GL_ONE_MINUS_SRC_COLOR, GL_DST_COLOR, GL_ONE_MINUS_DST_COLOR, GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA, GL_DST_ALPHA, GL_ONE_MINUS_DST_ALPHA, GL_CONSTANT_COLOR, GL_ONE_MINUS_CONSTANT_COLOR, GL_CONSTANT_ALPHA, GL_ONE_MINUS_CONSTANT_ALPHA, and GL_SRC_ALPHA_SATURATE.")}S=e,R()}},blendDFactor:{get:function(){return x},set:function(e){if(g){var n=t;e!==0&&e!==1&&e!==768&&e!==769&&e!==774&&e!==775&&e!==770&&e!==771&&e!==772&&e!==773&&e!==32769&&e!==32770&&e!==32771&&e!==32772&&r.fail("Shader.blendSFactor must be a one of GL_ZERO, GL_ONE, GL_SRC_COLOR, GL_ONE_MINUS_SRC_COLOR, GL_DST_COLOR, GL_ONE_MINUS_DST_COLOR, GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA, GL_DST_ALPHA, GL_ONE_MINUS_DST_ALPHA, GL_CONSTANT_COLOR, GL_ONE_MINUS_CONSTANT_COLOR, GL_CONSTANT_ALPHA, and GL_ONE_MINUS_CONSTANT_ALPHA.")}x=e,R()}},shaderVersion:{get:function(){return q}}}),this.markUniformUpdated=function(){a.boundShader=-1,a.meshShader=-1},this.apply=function(){var e=I||console.log,n=z(B,!1,e),r=z(j,!0,e),i=r===null||n===null,s,o=t,f,l,h;i&&(n=z(H["__error_vs.glsl"],!1,e),r=z(H["__error_fs.glsl"],!0,e)),v=u.createProgram(),u.attachShader(v,n),u.attachShader(v,r),u.linkProgram(v),u.deleteShader(n),u.deleteShader(r);if(!u.getProgramParameter(v,35714))return e("Could not initialise shaders"),!1;q=c++,u.useProgram(v),a.boundShader=v,f=u.getProgramParameter(v,35718),K(f),l=u.getProgramParameter(v,35721),p.activeAttributes=[],p.lookupAttribute={};for(s=0;s<l;s++)h=u.getActiveAttrib(v,s),p.activeAttributes[s]={size:h.size,type:h.type,name:h.name},p.lookupAttribute[h.name]=s;return p.markUniformUpdated(),U(),!i},this.destroy=function(){v!==-1&&(o.removeContextListener(p),u.deleteProgram(v),v=-1,o.project.removeResourceDescriptor(p.uid))},this.isValid=function(){return v!==-1},this.bind=function(){g&&(p.isValid||r.fail("Cannot bind a shader that is not valid")),a.boundShader!==v&&(a.boundShader=v,u.useProgram(v),W(),X(),V(),$())},this.toJSON=function(){return L?{uid:p.uid,name:A,dataURI:L}:{uid:p.uid,name:A,blend:E,blendSFactor:S,blendDFactor:x,dataURI:L,depthMask:m,faceCulling:b,fragmentShaderSrc:j,vertexShaderSrc:B,polygonOffsetEnabled:T,polygonOffsetFactor:N,polygonOffsetUnits:C,renderOrder:k,zTest:w,defaultUniforms:F}},this.init=function(e){r.applyConfig(p,e,["uid"]),L&&L.indexOf("memory://")!==0?o.resourceLoader.getShaderData(L,p):(R(),p.apply()),A===""&&(A="Shader_"+h,h++)},this.init(s)},l.getPrecompiledSource=function(e,t){var r,i,s="#version 100",o=1,u;for(r in n)n.hasOwnProperty(r)&&typeof r=="string"&&(i=n[r],t=t.replace('#pragma include "'+r+'"',i),t=t.replace("#pragma include '"+r+"'",i));return t.indexOf("#version ")===0&&(u=t.indexOf("\n"),s=t.substring(0,u),t=t.substring(u+1),o=2),t=s+"\n"+"#define SHADOWS "+(e.config.shadows===!0)+"\n"+"#define LIGHTS "+e.config.maxNumerOfLights+"\n"+"#line "+o+"\n"+t,t},l.prototype.bindMaterialUniform=function(e,t){var n=this.gl,r=this.glState,i,s=t.sceneLights,o,u=this.lookupUniform,a=u._proj,f=u._dLight,l=u._dLightWorldDir,c=u["_pLights[0]"],h=u._time,d=u._viewport,v=u._ambient,m=0,g;return m=e.bind(m),a&&n.uniformMatrix4fv(a.location,!1,t.projectionMatrix),v&&(o=s.ambientLight,g=o!==null?o.colorIntensity:p,n.uniform3fv(v.location,g)),f&&n.uniformMatrix3fv(f.location,!1,s.directionalLightData),l&&n.uniform3fv(l.location,s.directionalLightWorld),c&&n.uniformMatrix3fv(c.location,!1,s.pointLightData),h&&(i=this.engine.time,n.uniform1f(h.location,i.time)),d&&n.uniform2fv(d.location,r.viewportSize),m},l.prototype.bindUniform=function(e,t,n){var i=this.lookupUniform,s=this.gl,o=this.glState,a=i._m,f=i._mv,l=i._worldCamPos,c=i._world2object,h=i._mvProj,p=i._norm,y=i._gameObjectUID,b=i._shadowMapTexture,w=i._lightMat,E=t.sceneLights,S=E.directionalLight,x,T,N,C,k,L=0;o.currentMaterial!==e&&(o.currentMaterial=e,L=this.bindMaterialUniform(e,t));if(a||f||p)x=n.getGlobalMatrix(),a&&s.uniformMatrix4fv(a.location,!1,x),C=u.multiply(v,t.viewMatrix,x),f&&s.uniformMatrix4fv(f.location,!1,C),p&&(k=u.toNormalMat3(m,C),g&&(k||r.fail("Singular matrix")),s.uniformMatrix3fv(p.location,!1,k));l&&s.uniform3fv(l.location,t.currentCameraTransform.position),c&&s.uniformMatrix4fv(c.location,!1,n.getGlobalTRSInverse()),h&&(x=x||n.getGlobalMatrix(),s.uniformMatrix4fv(h.location,!1,u.multiply(v,t.viewProjectionMatrix,x))),y&&(N=r.uint32ToVec4(n.gameObject.uid,d),this.engine.time.frame<3&&console.log("transform.gameObject.uid "+n.gameObject.uid),s.uniform4fv(y.location,N)),b&&S&&S.shadowTexture&&(S.shadowTexture.bind(L),s.uniform1i(b.location,L),L++),w&&(x=n.getGlobalMatrix(),s.uniformMatrix4fv(w.location,!1,u.multiply(v,t.lightMatrix,x)))},l.convertUniformValue=function(e,t,n){if(e===35678||e===35680)if(t&&typeof t.ref=="number")return n.project.load(t.ref);if(Array.isArray(t)||typeof t=="number"){var r=t;return typeof r=="number"&&(r=[r]),e===5124||e===35667||e===35668||e===35669?new Int32Array(r):new Float32Array(r)}return t},Object.freeze(l),l}),define("kick/texture/Texture",["kick/core/ProjectAsset","kick/core/Constants","kick/core/Util","kick/math/Vec2","kick/core/EngineSingleton"],function(e,t,n,r,i){var s=!1;return function(t){e(this,t,"kick.texture.Texture");var o=i.engine,u=o.gl,a=o.glState,f=33984,l,c,h=u.createTexture(),p="Texture",d=10497,v=10497,m=9729,g=9729,y=!0,b=!1,w=!1,E="memory://void",S=!0,x=6408,T=3553,N=null,C=this,k=r.create(),L=function(){N!==null&&N!==T&&(u.deleteTexture(h),h=u.createTexture()),N=T},A=function(){u.generateMipmap(T),b=!0},O={contextLost:function(){console.log("_textureId ",h,u),u=null},contextRestored:function(e){u=e,h=u.createTexture(),l&&l.apply(C,c)}};this.init=function(){E&&o.resourceLoader.getImageData(E,C)},this.apply=function(){s&&(y||m!==9728&&m!==9729&&n.warn("When generateMipmaps is false min filter must be either GL_NEAREST or GL_LINEAR")),C.bind(0),T===3553&&(u.texParameteri(3553,10242,d),u.texParameteri(3553,10243,v)),u.texParameteri(T,10240,g),u.texParameteri(T,10241,m)},this.bind=function(e){u.activeTexture(f+e),u.bindTexture(T,h)},this.destroy=function(){h!==null&&(u.deleteTexture(h),h=null,o.project.removeResourceDescriptor(C.uid)),l=null,c=null,o.removeContextListener(O)},this.setImage=function(e,t){l=C.setImage,c=arguments;var i,s,o,f,h,p,d,v;E=t,L(),C.bind(0);if(T===3553){if(!n.isPowerOfTwo(e.width)||!n.isPowerOfTwo(e.height))i=n.nextHighestPowerOfTwo(e.width),s=n.nextHighestPowerOfTwo(e.height),e=n.scaleImage(e,i,s);S?u.pixelStorei(37440,!0):u.pixelStorei(37440,!1),u.pixelStorei(3317,1),u.texImage2D(3553,0,x,x,5121,e),r.copy(k,[e.width,e.height])}else{o=[34069,34070,34071,34072,34073,34074],f=e.width/6,h=e.height,s=n.nextHighestPowerOfTwo(e.height),i=s,p=document.createElement("canvas"),p.width=i,p.height=s,d=p.getContext("2d");for(v=0;v<6;v++)d.drawImage(e,v*f,0,f,h,0,0,i,s),u.pixelStorei(37440,!1),u.pixelStorei(3317,1),u.texImage2D(o[v],0,x,x,5121,p);r.copy(k,[i,s])}C.apply(),y&&A(),w=!0,a.currentMaterial=null},this.isFPTexturesSupported=function(){var e=u.isTexFloatEnabled;return typeof e!="boolean"&&(e=u.getExtension("OES_texture_float"),u.isTexFloatEnabled=e),e},this.setImageData=function(e,t,i,s,o,f){l=C.setImageData,c=arguments;var h,p,b=T===3553?[3553]:[34069,34070,34071,34072,34073,34074];L(),s===5126&&!u.isTexFloatEnabled&&(h=C.isFPTexturesSupported(),h||(n.fail("OES_texture_float unsupported on the platform. Using GL_UNSIGNED_BYTE instead of GL_FLOAT."),s=5121));if(!T){n.fail("Texture.textureType not set");return}r.copy(k,[e,t]),E=f,C.bind(0);for(p=0;p<b.length;p++)u.pixelStorei(3317,1),u.texImage2D(b[p],0,x,e,t,i,x,s,o);u.texParameteri(T,10240,g),u.texParameteri(T,10241,m),u.texParameteri(T,10242,d),u.texParameteri(T,10243,v),y&&A(),w=!0,a.currentMaterial=null},this.setTemporaryTexture=function(){var e=new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255]),t=x;x=6407,this.setImageData(2,2,0,5121,e,"kickjs://texture/white/"),x=t},this.setDataURI=function(e,t){e!==E&&(E=e,t&&o.resourceLoader.getImageData(E,C))},Object.defineProperties(this,{engine:{value:o},textureId:{value:h},name:{get:function(){return p},set:function(e){p=e}},dimension:{get:function(){return k}},dataURI:{get:function(){return E},set:function(e){C.setDataURI(e,!0)}},wrapS:{get:function(){return d},set:function(e){d=e}},wrapT:{get:function(){return v},set:function(e){v=e}},minFilter:{get:function(){return m},set:function(e){m=e}},magFilter:{get:function(){return g},set:function(e){g=e}},generateMipmaps:{get:function(){return y},set:function(e){y=e,y&&!b&&w&&(C.bind(0),A())}},flipY:{get:function(){return S},set:function(e){S=e}},internalFormat:{get:function(){return x},set:function(e){e!==6406&&e!==6407&&e!==6408&&e!==6409&&e!==6410&&n.fail("Texture.internalFormat should be either GL_ALPHA, GL_RGB, GL_RGBA, GL_LUMINANCE, or LUMINANCE_ALPHA"),x=e}},textureType:{get:function(){return T},set:function(e){e!==3553&&e!==34067&&n.fail("Texture.textureType should be either GL_TEXTURE_2D or GL_TEXTURE_CUBE_MAP"),T=e}}}),this.toJSON=function(){return{uid:C.uid,wrapS:d,wrapT:v,minFilter:m,magFilter:g,name:p,generateMipmaps:y,flipY:S,internalFormat:x,textureType:T,dataURI:E}},this.init=function(e){n.applyConfig(C,e,["uid","dataURI"]),e&&e.dataURI&&(C.dataURI=e.dataURI)},this.init(t),o.addContextListener(O)}}),define("kick/mesh/Mesh",["kick/core/ProjectAsset","kick/core/Constants","kick/core/Util","./MeshData","kick/core/EngineSingleton"],function(e,t,n,r,i){var s=!1;return function(o){e(this,o,"kick.mesh.Mesh"),s&&o===i.engine&&n.fail("Mesh constructor changed - engine parameter is removed");var u=i.engine,a=u.gl,f=u.glState,l,c,h=[],p=[],d,v,m="memory://void",g=null,y=this,b=t,w=0,E,S=[],x=function(){var e;for(e=0;e<p.length;e++)a.deleteBuffer(p[e]);typeof l=="number"&&(a.deleteBuffer(l),l=null),S.length=0,p.length=0},T=function(){var e,t;h.length=0;for(t in c)c.hasOwnProperty(t)&&(e=c[t],e.name||(e.name=t),h.push(e))},N=function(){var e=v.subMeshes,t,n,r;x(),c=v.interleavedArrayFormat,T(),w=v.vertexAttrLength,E=v.meshType,l=a.createBuffer(),a.bindBuffer(34962,l),a.bufferData(34962,v.interleavedArray,35044);for(t=0;t<e.length;t++)n=e[t],r=a.createBuffer(),S[t]=n.length,p.push(r),a.bindBuffer(34963,r),a.bufferData(34963,n,35044)},C={contextLost:function(){p.length=0,l=null,a=null},contextRestored:function(e){a=e,N()}};u.addContextListener(C),Object.defineProperties(this,{aabb:{get:function(){return!g&&v&&(g=v.aabb),g}},name:{get:function(){return d},set:function(e){d=e||"Mesh"}},meshData:{get:function(){return v},set:function(e){s&&e&&!(e instanceof r)&&n.fail("Mesh.meshData must be instanceof kick.mesh.MeshData"),v=e,g=null,N()}},dataURI:{get:function(){return m},set:function(e){y.setDataURI(e,!0)}}}),this.setDataURI=function(e,t,n){e!==m&&(m=e,t&&u.resourceLoader.getMeshData(e,y,n))},n.applyConfig(this,o,["uid"]),this.verify=function(e){var t=[],n,r;for(r in e.lookupAttribute)typeof r=="string"&&(n=c[r],n||t.push(r));return t.length===0?null:null},this.bind=function(e){var t,r,i,o,u,p;e.bind();if(f.meshBuffer!==l||f.meshShader!==e){f.meshBuffer=l,f.meshShader=e,a.bindBuffer(34962,l);for(t=0;t<h.length;t++)r=h[t],i=r.name,o=e.lookupAttribute[i],typeof o!="undefined"&&(a.enableVertexAttribArray(o),a.vertexAttribPointer(o,r.size,r.type,!1,w,r.pointer));if(s)for(t=e.activeAttributes.length-1;t>=0;t--){u=e.activeAttributes[t];if(c&&!c[u.name]){n.fail("Shader wants "+u.name+" but mesh does not have it."),p=e.lookupAttribute[u.name],a.disableVertexAttribArray(p);switch(u.type){case 5126:a.vertexAttrib1f(p,0);break;case 35664:a.vertexAttrib2f(p,0,0);break;case 35665:a.vertexAttrib3f(p,0,0,0);break;case 35666:a.vertexAttrib4f(p,0,0,0,0);break;default:n.fail("Shader wants "+u.name+" no default value for type.")}}}}},this.render=function(e){a.bindBuffer(34963,p[e]),a.drawElements(E,S[e],5123,0)},this.destroy=function(){l!==null&&(x(),u.removeContextListener(C),u.project.removeResourceDescriptor(y.uid))},this.toJSON=function(){return s&&(m||n.fail("_dataURI not defined")),{uid:y.uid,name:d,dataURI:m}},this.init=function(e,t){n.applyConfig(this,e,["uid","dataURI"]),e.dataURI&&y.setDataURI(e.dataURI,!0,t)}}}),define("kick/material/MaterialUniform",["kick/core/Util","kick/core/Constants","kick/texture/Texture"],function(e,t,n){var r=!1;return function(t){var i,s=this;t=t||{},i=t.value,this.location=null,this.type=null,this.name=t.name,Object.defineProperties(this,{value:{get:function(){return i},set:function(e){i=e}}}),this.toJSON=function(){var t=s.value;return t instanceof Float32Array||t instanceof Int32Array?t=e.typedArrayToArray(t):(r&&!t instanceof n&&e.fail("Unknown uniform value type. Expected Texture"),t=e.getJSONReference(t)),{name:s.name,value:t}}}}),define("kick/material/Material",["kick/core/ProjectAsset","kick/core/Util","kick/core/Constants","./Shader","./MaterialUniform","kick/core/EngineSingleton"],function(e,t,n,r,i,s){var o=!1;return function(n){e(this,n,"kick.material.Material"),o&&n===s.engine&&t.fail("Material constructor changed - engine parameter is removed");var u=s.engine,a="Material",f=null,l=[],c=this,h=u.gl,p=0,d={contextLost:function(){},contextRestored:function(e){h=e;if(f){f.contextRestored(e);var t=f;f=null,c.shader=t}}},v=function(){var e,t,n={},r,i;for(e=l.length-1;e>=0;e--)t=f.lookupUniform[l[e].name],t?(l[e].type=t.type,l[e].location=t.location,n[l[e].name]=!0):l.splice(e,1);for(e=0;e<f.materialUniforms.length;e++)t=f.materialUniforms[e],r=t.name,n.hasOwnProperty(r)||(i=c.setUniform(r,f.defaultUniforms[r]),i.location=t.location,i.type=t.type)};Object.defineProperties(this,{engine:{value:u},name:{get:function(){return a},set:function(e){a=e}},shader:{get:function(){return f},set:function(e){!e instanceof r&&t.fail("kick.material.Shader expected"),f!==e&&(f&&f.removeListener(v),f=e,f&&(p=f.renderOrder,v(),f.addListener(v)))}},uniforms:{value:null},renderOrder:{get:function(){return p}}}),this.bind=function(e){var t,n,r;for(t=0;t<l.length;t++){n=l[t].value,r=l[t].location;switch(l[t].type){case 5126:h.uniform1fv(r,n);break;case 35674:h.uniformMatrix2fv(r,!1,n);break;case 35675:h.uniformMatrix3fv(r,!1,n);break;case 35676:h.uniformMatrix4fv(r,!1,n);break;case 35664:h.uniform2fv(r,n);break;case 35665:h.uniform3fv(r,n);break;case 35666:h.uniform4fv(r,n);break;case 5124:h.uniform1iv(r,n);break;case 35667:h.uniform2iv(r,n);break;case 35668:h.uniform3iv(r,n);break;case 35669:h.uniform4iv(r,n);break;case 35680:case 35678:n.bind(e),h.uniform1i(r,e),e++}}return e},this.setUniform=function(e,n){if(n===undefined||n===null)return null;var r,s;for(s=0;s<l.length&&!r;s++)l[s].name===e&&(r=l[s],r.value=n);return r&&f?f.markUniformUpdated():r||(r=new i({name:e,value:n}),l.push(r)),o&&f&&typeof n=="undefined"&&t.fail("Type of value is undefined"),r},this.getUniform=function(e){var t;for(t=0;t<l.length;t++)if(l[t].name===e)return l[t].value;return null},this.destroy=function(){c.shader=null,u.project.removeResourceDescriptor(c.uid),u.removeContextListener(d)},this.toJSON=function(){var e,n={};for(e=0;e<l.length;e++)n[l[e].name]=l[e].toJSON().value;return{uid:c.uid,name:a,shader:t.getJSONReference(f),uniformData:n}},this.init=function(e){var n=e.uniformData,i,s,o={uid:e.uid||0,name:e.name,shader:e.shader};u.addContextListener(d),t.applyConfig(c,o,["uid"]);if(!f||!f.isValid())e.shader&&t.warn("Problem using shader in material. ",e.shader),c.shader=u.project.load(u.project.ENGINE_SHADER___ERROR);if(n)for(i in n)n.hasOwnProperty(i)&&(f.lookupUniform[i]?(s=n[i],s=r.convertUniformValue(f.lookupUniform[i].type,s,u),c.setUniform(i,s)):t.warn("Cannot find uniform "+i+" in shader. "));v()},this.init(n)}}),define("kick/core/Project",["./Constants","./ResourceDescriptor","kick/material/Shader","./Util","kick/texture/Texture","kick/mesh/Mesh","kick/material/Material"],function(e,t,n,r,i,s,o){var u=!1,a=!1,f=function(e){var l={},c={},h=this,p=0,d=function(e,n){if(l[e]instanceof t){var r=c[e];r&&l[e].updateConfig(r,n)}},v=function(e){var t=e.split("/");return t.length>2?(t=t[t.length-2],t=t.substring(0,1).toUpperCase()+t.substring(1)):t=e,t},m=function(e){var t,a,l,h,p,d;if(e<=f.ENGINE_SHADER_DEFAULT&&e>=f.ENGINE_SHADER___PICK_NORMAL){switch(e){case f.ENGINE_SHADER_DEFAULT:a="kickjs://shader/default/";break;case f.ENGINE_SHADER_SPECULAR:a="kickjs://shader/specular/";break;case f.ENGINE_SHADER_DIFFUSE:a="kickjs://shader/diffuse/";break;case f.ENGINE_SHADER_UNLIT:a="kickjs://shader/unlit/";break;case f.ENGINE_SHADER_UNLIT_VERTEX_COLOR:a="kickjs://shader/unlit_vertex_color/";break;case f.ENGINE_SHADER_TRANSPARENT_SPECULAR:a="kickjs://shader/transparent_specular/";break;case f.ENGINE_SHADER_TRANSPARENT_DIFFUSE:a="kickjs://shader/transparent_diffuse/";break;case f.ENGINE_SHADER_TRANSPARENT_UNLIT:a="kickjs://shader/transparent_unlit/";break;case f.ENGINE_SHADER___SHADOWMAP:a="kickjs://shader/__shadowmap/";break;case f.ENGINE_SHADER___PICK_UV:a="kickjs://shader/__pick_uv/";break;case f.ENGINE_SHADER___PICK_NORMAL:a="kickjs://shader/__pick_normal/";break;case f.ENGINE_SHADER___PICK:a="kickjs://shader/__pick/";break;case f.ENGINE_SHADER___ERROR:a="kickjs://shader/__error/";break;default:return u&&r.fail("uid not mapped "+e),null}t=new n({dataURI:a,name:v(a),uid:e})}else if(e<=f.ENGINE_TEXTURE_BLACK&&e>=f.ENGINE_TEXTURE_CUBEMAP_WHITE){l=e===f.ENGINE_TEXTURE_CUBEMAP_WHITE;switch(e){case f.ENGINE_TEXTURE_BLACK:a="kickjs://texture/black/";break;case f.ENGINE_TEXTURE_WHITE:a="kickjs://texture/white/";break;case f.ENGINE_TEXTURE_GRAY:a="kickjs://texture/gray/";break;case f.ENGINE_TEXTURE_LOGO:a="kickjs://texture/logo/";break;case f.ENGINE_TEXTURE_CUBEMAP_WHITE:break;default:return u&&r.fail("uid not mapped "+e),null}l?(t=new i({name:"cubemap_white",minFilter:9728,magFilter:9728,generateMipmaps:!1,uid:e,textureType:34067}),h=document.createElement("canvas"),h.width=12,h.height=2,d=h.getContext("2d"),d.fillStyle="rgb(255,255,255)",d.fillRect(0,0,12,2),t.setImage(h,"memory://cubemap_white/")):t=new i({name:v(a),minFilter:9728,magFilter:9728,generateMipmaps:!1,uid:e,textureType:3553,dataURI:a})}else if(e<=f.ENGINE_MESH_TRIANGLE&&e>=f.ENGINE_MESH_CUBE){switch(e){case f.ENGINE_MESH_TRIANGLE:a="kickjs://mesh/triangle/";break;case f.ENGINE_MESH_PLANE:a="kickjs://mesh/plane/";break;case f.ENGINE_MESH_UVSPHERE:a="kickjs://mesh/uvsphere/";break;case f.ENGINE_MESH_CUBE:a="kickjs://mesh/cube/";break;default:return u&&r.fail("uid not mapped "+e),null}t=new s({dataURI:a,name:v(a),uid:e})}else e<=f.ENGINE_MATERIAL_DEFAULT&&(p=m(f.ENGINE_SHADER_UNLIT),t=new o({shader:p,name:"Default material"}));return c[e]=t,t};r.copyStaticPropertiesToObject(h,f),Object.defineProperties(this,{maxUID:{get:function(){return p},set:function(e){p=e}},resourceDescriptorUIDs:{get:function(){var e=[],t;for(t in l)l.hasOwnProperty(t)&&e.push(t);return e}}}),this.newProject=function(){h.loadProject({maxUID:0,resourceDescriptors:[]})},this.loadProjectByURL=function(e,t,n){var r=function(){a&&console.log(arguments)},i;t=t||r,n=n||r,i=new XMLHttpRequest,i.open("GET",e,!0),i.onreadystatechange=function(e){if(i.readyState===4)if(i.status===200){var r=JSON.parse(i.responseText);try{h.loadProject(r,t,n)}catch(s){n(s)}}else n()},i.send(null)},this.loadProject=function(t,n,i){p>0&&h.closeProject(),typeof n!="function"&&u&&r.fail("Project.loadProject - onSuccess parameter not a function"),t=t||{};var s=t.resourceDescriptors||[],o,a,f=function(t){var n={},i,s,o,u;for(i in t)r.hasProperty(t,i)&&(s=t[i],o=s?s.reftype:null,u=s?s.ref:null,s&&u&&o&&(o==="resource"?s=e.resourceLoader[s.refMethod](u):o==="project"&&(s=e.project.load(u))),n[i]=s);return n},d=function(){var r=1,s=function(i){r--,r===0&&(p=t.maxUID||0,t.activeScene?e.activeScene=h.load(t.activeScene):e.activeScene=null,n&&n(h))},o={resourceLoadingStarted:function(){r++},resourceLoadingFinished:s,resourceLoadingFailed:i};for(a in l)l.hasOwnProperty(a)&&c[a].init(f(l[a].config),o);s()},v=s.length,m=0,g=function(e){if(c[e.uid]!==e){i("Did not restore uid correct for "+e.uid+".");return}m++,m===v&&d()};p=t.maxUID||0;for(o=0;o<v;o++)h.addResourceDescriptor(s[o]);for(a in l)l.hasOwnProperty(a)&&l[a].instantiate(g,i)},this.closeProject=function(){var e;for(e in l)l.hasOwnProperty(e)&&h.removeResourceDescriptor(e);l={},c={}},this.load=function(e,t,n){var r=c[e];return r?r:m(e)},this.removeCacheReference=function(e){c[e]&&delete c[e]},this.loadByName=function(e,t){var n,r;for(n in l)if(l.hasOwnProperty(n)){r=l[n];if(r.name===e)if(!t||r.type===t)return h.load(r.uid)}return null},this.registerObject=function(n,i){var s=e.getUID(n);if(c[s])return;c[s]=n,l[s]||(l[s]=new t({uid:s,type:i,config:{name:n.name}}))},this.refreshResourceDescriptors=function(e){var t;e=e||function(){return!0};for(t in l)l.hasOwnProperty(t)&&d(t,e)},this.getEngineResourceDescriptorsByType=function(e){var n=[],i,s,o;e==="kick.mesh.Mesh"?i="ENGINE_MESH_":e==="kick.material.Shader"?i="ENGINE_SHADER_":e==="kick.texture.Texture"&&(i="ENGINE_TEXTURE_");if(i)for(s in f)typeof f[s]=="number"&&f.hasOwnProperty(s)&&s.indexOf(i)===0&&(o=f[s],s=r.toCamelCase(s.substr(i.length)," "),n.push(new t({type:e,config:{name:s,uid:o}})));return n},this.getResourceDescriptorsByType=function(e){var t=[],n;for(n in l)l.hasOwnProperty(n)&&l[n].type===e&&t.push(l[n]);return t},this.getResourceDescriptorsByName=function(e){var t=[],n;for(n in l)l.hasOwnProperty(n)&&l[n].name===e&&t.push(l[n]);return t},this.getResourceDescriptor=function(e){return d(e),l[e]},this.addResourceDescriptor=function(e){return e instanceof t||(e=new t(e)),l[e.uid]=e,e},this.removeResourceDescriptor=function(e){var t=c[e];t&&(delete c[e],t.destroy&&t.destroy()),delete l[e]},this.toJSON=function(n){var r=[],i,s;n=n||function(){return!0},h.refreshResourceDescriptors(n);for(i in l)l.hasOwnProperty(i)&&i>=0&&(s=l[i],s instanceof t&&n(s)&&r.push(s.toJSON(n)));return{engineVersion:e.version,maxUID:p,activeScene:e.activeScene?e.activeScene.uid:0,resourceDescriptors:r}}};return f.ENGINE_SHADER_DEFAULT=-100,f.ENGINE_SHADER_SPECULAR=-101,f.ENGINE_SHADER_UNLIT=-102,f.ENGINE_SHADER_TRANSPARENT_SPECULAR=-103,f.ENGINE_SHADER_TRANSPARENT_UNLIT=-104,f.ENGINE_SHADER___SHADOWMAP=-105,f.ENGINE_SHADER___PICK=-106,f.ENGINE_SHADER___ERROR=-107,f.ENGINE_SHADER_DIFFUSE=-108,f.ENGINE_SHADER_TRANSPARENT_DIFFUSE=-109,f.ENGINE_SHADER_UNLIT_VERTEX_COLOR=-110,f.ENGINE_SHADER___PICK_UV=-111,f.ENGINE_SHADER___PICK_NORMAL=-112,f.ENGINE_TEXTURE_BLACK=-200,f.ENGINE_TEXTURE_WHITE=-201,f.ENGINE_TEXTURE_GRAY=-202,f.ENGINE_TEXTURE_LOGO=-203,f.ENGINE_TEXTURE_CUBEMAP_WHITE=-204,f.ENGINE_MESH_TRIANGLE=-300,f.ENGINE_MESH_PLANE=-301,f.ENGINE_MESH_UVSPHERE=-302,f.ENGINE_MESH_CUBE=-303,f.ENGINE_MATERIAL_DEFAULT=-400,f}),define("kick/core/URLResourceProvider",["kick/mesh/MeshData","./Util"],function(e,t){return function(n){var r=n.gl,i=this;Object.defineProperties(this,{protocol:{value:""}}),this.getMeshData=function(n,r,i){function o(){if(s.readyState===4)if(s.status===200){var o=s.response,u=new e;u.deserialize(o)?(r.meshData=u,i&&i.resourceLoadingStarted&&i.resourceLoadingFinished(n,r)):(t.fail("Cannot deserialize meshdata "+n),i&&i.resourceLoadingFailed&&i.resourceLoadingFailed(n,r))}else t.fail("Cannot load meshdata "+n+". Server responded "+s.status),i&&i.resourceLoadingFailed&&i.resourceLoadingFailed(n,r)}var s=new XMLHttpRequest;i&&i.resourceLoadingStarted&&i.resourceLoadingStarted(n,r),s.open("GET",n,!0),s.responseType="arraybuffer",s.onreadystatechange=o,s.send()},this.getImageData=function(e,n,r){var i=new Image;r&&r.resourceLoadingStarted&&r.resourceLoadingStarted(url,n),i.onload=function(){try{n.setImage(i,e),r&&r.resourceLoadingStarted&&r.resourceLoadingFinished(url,n)}catch(s){t.fail("Exception when loading image "+e),r&&r.resourceLoadingFailed&&r.resourceLoadingFailed(url,n)}},i.onerror=function(i){t.fail(i),t.fail("Exception when loading image "+e),r&&r.resourceLoadingFailed&&r.resourceLoadingFailed(url,n)},e.indexOf("data:")!==0&&(i.crossOrigin="anonymous"),i.src=e}}}),define("kick/core/ResourceLoader",["./URLResourceProvider","./BuiltInResourceProvider"],function(e,t){return function(n){var r=[new e(n),new t(n)],i=function(e){return function(t,n,i){var s,o,u;for(s=r.length-1;s>=0;s--){o=r[s],u=o.protocol;if(t.indexOf(u)===0){o[e](t,n,i);return}}}};this.getMeshData=i("getMeshData"),this.getImageData=i("getImageData"),this.getShaderData=i("getShaderData"),this.addResourceProvider=function(e){r.push(e)},this.removeResourceProvider=function(e){var t;for(t=e.length-1;t>=0;t--)r[t]===e&&r.splice(t,1)}}}),define("kick/core/MouseInput",["kick/math/Vec2","./Util"],function(e,t){return function(n){var r=e,i=[],s=[],o=[],u=r.create(),a=r.create(),f=null,l=r.create(),c=r.create(),h=!1,p=n.canvas,d=n.config.highDPISupport?window.devicePixelRatio||1:1,v=t.removeElementFromArray,m=t.contains,g=!0,y=!0,b=document.body,w=navigator.userAgent.indexOf("Firefox")!==-1,E=navigator.userAgent.indexOf("Chrome")!==-1,S=function(e){return e.preventDefault(),!1},x=function(e){u[0]=(e.clientX-l[0]+b.scrollLeft)*d,u[1]=(e.clientY-l[1]+b.scrollTop)*d,f?r.subtract(f,u,a):f=r.create(),r.copy(a,u)},T=function(e){E?(c[0]+=e.wheelDeltaX,c[1]+=e.wheelDeltaY):e.axis===1?c[0]-=e.detail:c[1]-=e.detail;if(h)return e.preventDefault(),!1},N=function(e){var t=e.button;m(i,t)||(o.push(t),i.push(t)),g||x()},C=function(e){var t=e.button;s.push(t),v(i,t),g||x()},k=function(){var e;if(y)for(e=i.length-1;e>=0;e--)C({button:i[e]})},L=function(){var e=p,t=0,n=0;while(e.offsetParent)t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;t+=e.offsetLeft,n+=e.offsetTop,l[0]=t,l[1]=n};Object.defineProperties(this,{mousePosition:{get:function(){return u}},deltaMovement:{get:function(){return f||r.create()}},deltaWheel:{get:function(){return c}},mouseWheelPreventDefaultAction:{get:function(){return h},set:function(e){h=e}},releaseMouseButtonOnMouseOut:{get:function(){return y},set:function(e){e!==y&&(y=e,y?p.addEventListener("mouseout",k,!1):p.removeEventListener("mouseout",k,!1))}},mouseMovementEventsEnabled:{get:function(){return g},set:function(e){g!==e&&(g=e,g?p.addEventListener("mousemove",x,!1):(p.removeEventListener("mousemove",x,!1),f=null))}}}),this.isButtonDown=function(e){return m(o,e)},this.isButtonUp=function(e){return m(s,e)},this.isButton=function(e){return m(i,e)},this.frameUpdated=function(){o.length=0,s.length=0,c[0]=0,c[1]=0,f&&(f[0]=0,f[1]=0)},this.updateCanvasElementPosition=L,function(){L();var t=n.canvas;t.addEventListener("mousedown",N,!0),t.addEventListener("mouseup",C,!0),t.addEventListener("mousemove",x,!0),t.addEventListener("mouseout",k,!0),t.addEventListener("contextmenu",S,!0),w?t.addEventListener("MozMousePixelScroll",T,!0):E?t.addEventListener("mousewheel",T,!0):t.addEventListener("DOMMouseScroll",T,!0)}()}}),define("kick/core/KeyInput",["./Util"],function(e){return function(){var t=[],n=[],r=[],i=e.removeElementFromArray,s=e.contains,o=function(e){var n=e.keyCode;s(r,n)||(t.push(n),r.push(n))},u=function(e){var t=e.keyCode;n.push(t),i(r,t)};this.isKeyDown=function(e){return s(t,e)},this.isKeyUp=function(e){return s(n,e)},this.isKey=function(e){return s(r,e)},this.frameUpdated=function(){t.length=0,n.length=0},function(){document.addEventListener("keydown",o,!1),document.addEventListener("keyup",u,!1)}()}}),define("kick/core/EventQueue",["./Util"],function(e){return function(t){var n=[],r=function(e,t){return e.timeStart-t.timeStart},i=t.time;this.add=function(t,s,o){var u=i.time+1,a={task:t,timeStart:s+u,timeEnd:(o||s)+u};return e.insertSorted(a,n,r),a},this.cancel=function(t){e.removeElementFromArray(n,t)},this.run=function(){var e,t=i.time,r=n.length,s;for(e=0;e<r&&(s=n[e]).timeStart<t;e++)s.task(),s.timeEnd<t&&(n.splice(e,1),r--)},this.clear=function(){n=[]}}}),define("kick/math/Quat",["kick/core/Constants","./Vec3","./Vec4","./Mat3","./Mat4"],function(e,t,n,r,i){return{create:function(){var e=new Float32Array(4);return e[3]=1,e},clone:n.clone,fromValues:n.fromValues,copy:n.copy,set:n.set,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},setAxisAngle:function(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e},add:n.add,multiply:function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=n[0],a=n[1],f=n[2],l=n[3];return e[0]=r*l+o*u+i*f-s*a,e[1]=i*l+o*a+s*u-r*f,e[2]=s*l+o*f+r*a-i*u,e[3]=o*l-r*u-i*a-s*f,e},scale:n.scale,rotateX:function(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a+o*u,e[1]=i*a+s*u,e[2]=s*a-i*u,e[3]=o*a-r*u,e},rotateY:function(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a-s*u,e[1]=i*a+o*u,e[2]=s*a+r*u,e[3]=o*a-i*u,e},rotateZ:function(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a+i*u,e[1]=i*a-r*u,e[2]=s*a+o*u,e[3]=o*a-s*u,e},calculateW:function(e,t){var n=t[0],r=t[1],i=t[2];return e[0]=n,e[1]=r,e[2]=i,e[3]=-Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e},dot:n.dot,lerp:n.lerp,slerp:function(e,t,n,r){var i=t[0],s=t[1],o=t[2],u=t[3],a=n[0],f=n[1],l=n[2],c=t[3],h=i*a+s*f+o*l+u*c,p,d,v,m;return Math.abs(h)>=1?(e!==t&&(e[0]=i,e[1]=s,e[2]=o,e[3]=u),e):(p=Math.acos(h),d=Math.sqrt(1-h*h),Math.abs(d)<.001?(e[0]=i*.5+a*.5,e[1]=s*.5+f*.5,e[2]=o*.5+l*.5,e[3]=u*.5+c*.5,e):(v=Math.sin((1-r)*p)/d,m=Math.sin(r*p)/d,e[0]=i*v+a*m,e[1]=s*v+f*m,e[2]=o*v+l*m,e[3]=u*v+c*m,e))},invert:function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n*n+r*r+i*i+s*s,u=o?1/o:0;return e[0]=-n*u,e[1]=-r*u,e[2]=-i*u,e[3]=s*u,e},conjugate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},length:n.length,squaredLength:n.squaredLength,normalize:n.normalize,multiplyVec3:function(e,t,n){var r=n[0],i=n[1],s=n[2],o=t[0],u=t[1],a=t[2],f=t[3],l=f*r+u*s-a*i,c=f*i+a*r-o*s,h=f*s+o*i-u*r,p=-o*r-u*i-a*s;return e[0]=l*f+p*-o+c*-a-h*-u,e[1]=c*f+p*-u+h*-o-l*-a,e[2]=h*f+p*-a+l*-u-c*-o,e},toEuler:function(e,n){var r=n[0],i=n[1],s=n[2],o=n[3],u=i*i,a=57.2957795130824;return e||(e=t.create()),e[0]=Math.atan2(2*(o*r+i*s),1-2*(r*r+u))*a,e[1]=Math.asin(2*(o*i-s*r))*a,e[2]=Math.atan2(2*(o*s+r*i),1-2*(u+s*s))*a,e},lookAt:function(){var e=t.create(),n=t.create(),i=t.create(),s=r.create();return function(o,u,a,f){return t.subtract(i,u,a),t.normalize(i,i),t.cross(n,f,i),t.normalize(n,n),t.cross(e,i,n),t.normalize(e,e),s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=e[0],s[4]=e[1],s[5]=e[2],s[6]=i[0],s[7]=i[1],s[8]=i[2],r.toQuat(o,s)}}(),setEuler:function(e,t){var n=.01745329251994,r=n*.5,i=t[0]*r,s=t[1]*r,o=t[2]*r,u=Math.cos(i),a=Math.cos(s),f=Math.cos(o),l=Math.sin(i),c=Math.sin(s),h=Math.sin(o);return e[3]=u*a*f+l*c*h,e[0]=l*a*f-u*c*h,e[1]=u*c*f+l*a*h,e[2]=u*a*h-l*c*f,e},setFromRotationMatrix:function(e,t){function g(e,t){return t<0?-Math.abs(e):Math.abs(e)}var n,r,s,o,u=t[0],a=t[4],f=t[8],l=t[1],c=t[5],h=t[9],p=t[2],d=t[6],v=t[10],m;return m=Math.pow(i.determinant(t),1/3),o=Math.sqrt(Math.max(0,m+u+c+v))/2,n=Math.sqrt(Math.max(0,m+u-c-v))/2,r=Math.sqrt(Math.max(0,m-u+c-v))/2,s=Math.sqrt(Math.max(0,m-u-c+v))/2,n=g(n,d-h),r=g(r,f-p),s=g(s,l-a),this.copy(e,[n,r,s,o]),this.normalize(e,e),e},toMat3:function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n+n,u=r+r,a=i+i,f=n*o,l=n*u,c=n*a,h=r*u,p=r*a,d=i*a,v=s*o,m=s*u,g=s*a;return e[0]=1-(h+d),e[1]=l+g,e[2]=c-m,e[3]=l-g,e[4]=1-(f+d),e[5]=p+v,e[6]=c+m,e[7]=p-v,e[8]=1-(f+h),e},toMat4:function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n+n,u=r+r,a=i+i,f=n*o,l=n*u,c=n*a,h=r*u,p=r*a,d=i*a,v=s*o,m=s*u,g=s*a;return e[0]=1-(h+d),e[1]=l+g,e[2]=c-m,e[3]=0,e[4]=l-g,e[5]=1-(f+d),e[6]=p+v,e[7]=0,e[8]=c+m,e[9]=p-v,e[10]=1-(f+h),e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},difference:function(e,t,n){var r=-t[0],i=-t[1],s=-t[2],o=t[3],u=n[0],a=n[1],f=n[2],l=n[3];return e[0]=r*l+o*u+i*f-s*a,e[1]=i*l+o*a+s*u-r*f,e[2]=s*l+o*f+r*a-i*u,e[3]=o*l-r*u-i*a-s*f,e},str:function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"}}}),define("kick/scene/SceneLights",["kick/core/Constants","kick/core/Util","kick/math/Mat3","kick/math/Mat4","kick/math/Vec3","kick/math/Quat"],function(e,t,n,r,i,s){var o=!1;return function(e){var u=null,a=null,f=new Float32Array(9),l=f.subarray(0,3),c=f.subarray(3,6),h=f.subarray(6,9),p=i.clone([1,0,0]),d=null,v=new Float32Array(9*e),m=i.wrapArray(v),g=[],y=[0,0,1],b=function(e){var t;for(t=0;t<3;t++)i.copy(m[e*3+t],[0,0,0])};Object.defineProperties(this,{ambientLight:{get:function(){return u},set:function(e){if(o&&e&&u)throw new Error("Cannot have multiple ambient lights in the scene");u=e}},directionalLight:{get:function(){return a},set:function(e){if(o&&e&&a)throw new Error("Cannot have multiple directional lights in the scene");a=e,e!==null?d=a.gameObject.transform:(d=null,n.copy(f,[0,0,0,0,0,0,0,0,0]))}},directionalLightData:{get:function(){return f}},directionalLightWorld:{get:function(){return p}},pointLightData:{get:function(){return v}}}),this.addPointLight=function(n){t.contains(g,n)||(g.length===e?o&&t.fail("Only "+e+" point lights allowed in scene"):g.push(n))},this.removePointLight=function(e){var n=g.indexOf(e);n>=0?g.splice(n,1):o&&t.fail("Error removing point light"),b(g.length)},this.recomputeLight=function(t){a!==null&&(s.multiplyVec3(p,d.rotation,y),r.multiplyVec3Vector(l,t,p),i.normalize(l,l),i.add(h,y,l),i.normalize(h,h),i.copy(c,a.colorIntensity));if(e){var n=0,o,u,f;for(o=g.length-1;o>=0;o--)u=g[o],f=u.transform.position,r.multiplyVec3(m[n],t,f),i.copy(m[n+1],u.colorIntensity),i.copy(m[n+2],u.attenuation),n+=3}},function(){var n;for(n=0;n<e;n++)b(n)}()}}),define("kick/math/Frustum",["kick/core/Constants","./Vec3","./Aabb"],function(e,t,n){var r=0,i=1,s=2;return{create:function(){return new Float32Array(24)},extractPlanes:function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=t[9],p=t[10],d=t[11],v=t[12],m=t[13],g=t[14],y=t[15],b,w,E,S,x,T;e[0]=o+r,e[1]=l+u,e[2]=d+c,e[3]=y+v,e[4]=o-r,e[5]=l-u,e[6]=d-c,e[7]=y-v,e[8]=o-i,e[9]=l-a,e[10]=d-h,e[11]=y-m,e[12]=o+i,e[13]=l+a,e[14]=d+h,e[15]=y+m,e[16]=o+s,e[17]=l+f,e[18]=d+p,e[19]=y+g,e[20]=o-s,e[21]=l-f,e[22]=d-p,e[23]=y-g;if(n)for(b=0;b<6;b++)w=e[b*4],E=e[b*4+1],S=e[b*4+2],x=Math.sqrt(w*w+E*E+S*S),T=1/x,e[b*4]*=T,e[b*4+1]*=T,e[b*4+2]*=T,e[b*4+3]*=T;return e},OUTSIDE:r,INSIDE:i,INTERSECTING:s,intersectAabb:function(){var e=t.create(),o=t.create();return function(t,u){var a=i,f,l,c,h,p,d,v,m,g=function(e){var n=e*4,o=t[n],u=t[n+1],a=t[n+2],f=t[n+3],l=d*Math.abs(o)+v*Math.abs(u)+m*Math.abs(a),g=c*o+h*u+p*a+f;return g-l>0?i:g+l<0?r:s};n.center(e,u),n.halfVec3(o,u),c=e[0],h=e[1],p=e[2],d=o[0],v=o[1],m=o[2];for(f=0;f<6;f++){l=g(f);if(l===r)return l;l===s&&(a=s)}return a}}()}}),define("kick/scene/EngineUniforms",[],function(){return function(e){this.viewMatrix=e.viewMatrix,this.projectionMatrix=e.projectionMatrix,this.viewProjectionMatrix=e.viewProjectionMatrix,this.lightMatrix=e.lightMatrix,this.currentCamera=e.currentCamera,this.currentCameraTransform=e.currentCameraTransform,this.sceneLights=null,Object.seal(this)}}),define("kick/texture/RenderTexture",["kick/core/ProjectAsset","kick/math/Vec2","kick/core/Constants","kick/core/Util","kick/core/EngineSingleton"],function(e,t,n,r,i){return function(n){e(this,n,"kick.texture.RenderTexture");var s=i.engine,o=s.gl,u=s.glState,a=n||{},f=o.createFramebuffer(),l=null,c=t.create(),h=[],p=this,d="",v=function(){var e;for(e=0;e<h.length;e++)o.deleteRenderbuffer(h[e])},m=function(){var e,t;c=l?l.dimension:c,v(),o.bindFramebuffer(36160,f),l?o.framebufferTexture2D(36160,36064,3553,l.textureId,0):(e=o.createRenderbuffer(),o.bindRenderbuffer(36161,e),o.renderbufferStorage(36161,32854,c[0],c[1]),o.framebufferRenderbuffer(36160,36064,36161,e),h.push(e)),e=o.createRenderbuffer(),o.bindRenderbuffer(36161,e),o.renderbufferStorage(36161,33189,c[0],c[1]),o.framebufferRenderbuffer(36160,36096,36161,e),h.push(e),o.bindFramebuffer(36160,null)};this.bind=function(){u.renderTarget=p,o.bindFramebuffer(36160,f)},Object.defineProperties(this,{dimension:{get:function(){return c},set:function(e){c=e,c&&m()}},colorTexture:{get:function(){return l},set:function(e){l=e,l&&m()}},name:{get:function(){return d},set:function(e){d=e}}}),this.destroy=function(){f!==null&&(v(),o.deleteFramebuffer(f),f=null,s.project.removeResourceDescriptor(p.uid))},this.toJSON=function(){return{uid:p.uid,name:d,colorTexture:r.getJSONReference(l)}},this.init(n)}}),define("kick/scene/MeshRenderer",["kick/core/Constants","kick/material/Material","kick/core/Util","kick/mesh/Mesh","kick/core/EngineSingleton"],function(e,t,n,r,i){var s=!1;return function(e){var o,u=[],a,f,l=i.engine,c=this;this.activated=function(){o=c.gameObject.transform;if(u.length===0){var e=l.project;c.material=e.load(e.ENGINE_MATERIAL_DEFAULT)}},Object.defineProperties(this,{aabb:{get:function(){return a.aabb}},renderOrder:{get:function(){return f}},material:{get:function(){return u.length===0?null:u[0]},set:function(e){s&&(e instanceof t||n.fail("MeshRenderer.material must be a kick.material.Material")),u[0]=e,f=u[0].renderOrder,c.gameObject&&c.gameObject.notifyComponentUpdated(c)}},materials:{get:function(){return u},set:function(e){var r;u=[];for(r=0;r<e.length;r++)s&&(e[r]instanceof t||n.fail("MeshRenderer.material must be a kick.material.Material")),u[r]=e[r],f=u[r].renderOrder;c.gameObject&&c.gameObject.notifyComponentUpdated(c)},enumerable:!0},mesh:{get:function(){return a},set:function(e){s&&(e instanceof r||n.fail("MeshRenderer.mesh must be a kick.mesh.Mesh")),a=e},enumerable:!0}}),this.render=function(e,t){var n=u.length,r,i;if(t){i=t.shader;for(r=0;r<n;r++)a.bind(i),i.bindUniform(t,e,o),a.render(r)}else for(r=0;r<n;r++)i=u[r].shader,a.bind(i),i.bindUniform(u[r],e,o),a.render(r)},this.toJSON=function(){return c.gameObject?n.componentToJSON(this,"kick.scene.MeshRenderer"):null},n.applyConfig(this,e)}}),define("kick/scene/PickResult",["./MeshRenderer","kick/material/Material","kick/core/Constants","kick/core/EngineSingleton","kick/core/Util","kick/math/Vec4","kick/math/Vec3","kick/math/Vec2"],function(e,t,n,r,i,s,o,u){return function(e,n,a,f,l,c){var h,p,d,v=r.engine,m=function(r){var i=new Uint8Array(4),s=n.getComponentsWithMethod("render"),o,u=new t({name:"PickResult",shader:r});c.setupCamera(),e.bind(),v.gl.clear(16640);for(o=0;o<s.length;o++)s[o].render(l,u);return v.gl.readPixels(a,f,1,1,6408,5121,i),i},g=function(){var e=v.project.load(v.project.ENGINE_SHADER___PICK_NORMAL);h=m(e),h=o.scale(o.create(),h,1/255),o.add(h,h,[-0.5,-0.5,-0.5]),o.scale(h,h,2)},y=function(){var e=v.project.load(v.project.ENGINE_SHADER___PICK_UV);p=m(e),p=u.scale(u.create(),p,1/255)},b=function(){var e=v.project.load(v.project.ENGINE_SHADER___SHADOWMAP),t=m(e),n=[1/4278190080,1/16711680,1/65280,1/255];d=s.dot(t,n)};Object.defineProperties(this,{gameObject:{value:n},x:{value:a},y:{value:f},normal:{get:function(){return h||g(),h}},uv:{get:function(){return p||y(),p}},distance:{get:function(){d||b();var e=c.far,t=c.near;return 2*e*t/(e+t-(e-t)*(2*d-1))}},point:{get:function(){return d||b(),o.unproject(o.create(),[a,f,d],l.viewMatrix,l.projectionMatrix,c.viewportRect)}}})}}),define("kick/scene/CameraPicking",["kick/math/Vec4","kick/material/Material","kick/texture/RenderTexture","kick/core/Constants","kick/core/Util","./PickResult","kick/core/EngineSingleton"],function(e,t,n,r,i,s,o){return function(r,u,a,f){var l=o.engine,c=null,h=null,p=null,d=e.create(),v=l.glState,m,g=function(){c=[],h=new t({shader:l.project.load(l.project.ENGINE_SHADER___PICK),name:"Picking material"}),p=new n({dimension:v.viewportSize}),p.name="__pickRenderTexture"};g(),this.add=function(e){c.push(e)},this.handlePickRequests=function(e,t){if(c.length>0){v.currentMaterial=null,p.bind(),r(d),l.gl.clear(16640),u(e,h);for(m=c.length-1;m>=0;m--)(function(){var e=c[m],n=e.width*e.width*4,r=new Uint8Array(n),o=[],u={},h,d,v,g;l.gl.readPixels(e.x,e.y,e.width,e.height,6408,5121,r);for(h=0;h<n;h+=4)d=r.subarray(h,h+4),v=i.vec4uint8ToUint32(d),v>0&&(u[v]?u[v]++:(g=a.getObjectByUID(v),g&&(e.point&&(g=new s(p,g,e.x,e.y,t,f)),o.push(g),u[v]=1)));o.length&&l.eventQueue.add(function(){var t,n;for(t=0;t<o.length;t++)n=o[t],e.gameObjectPickedFn(n,u[n.uid])},0)})();c.length=0}}}}),define("kick/scene/Camera",["kick/core/Constants","kick/core/Util","kick/math/Quat","kick/math/Mat4","kick/math/Vec4","kick/math/Vec3","kick/math/Aabb","kick/math/Frustum","./EngineUniforms","./CameraPicking","kick/material/Material","kick/texture/RenderTexture","kick/core/EngineSingleton"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p=!1,d=!1,v;return v=function(v){var m,g,y=this,b,w=h.engine,E=!0,S=e,x=!1,T=null,N=1.0471975511964,C=.1,k=1e3,L=-1,A=1,O=-1,M=1,_=i.clone([0,0,0,1]),D=i.clone([1,1,1,1]),P=!0,H=!0,B=!0,j=null,F,I=1,q=4294967295,R,U,z=null,W=r.create(),X=r.create(),V=r.create(),$=r.create(),J=new a({viewMatrix:X,projectionMatrix:W,viewProjectionMatrix:V,lightMatrix:$,currentCamera:y,currentCameraTransform:null}),K=!1,Q={contextLost:function(){m=null},contextRestored:function(e){m=e}},G=[],Y=[],Z=[],et=[G,Y,Z],tt=i.clone([0,0,1,1]),nt=r.clone([.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1]),rt,it,st=function(e){return typeof e=="number"},ot=function(e){return typeof e=="boolean"},ut=function(){F=(H?16384:0)|(B?256:0)},at=function(e){g.currentClearColor!==e&&(g.currentClearColor=e,m.clearColor(e[0],e[1],e[2],e[3]))},ft=function(e,n){st(e)||t.fail("Camera."+n+" must be number")},lt=function(e,t,n,r){m.viewport(e,t,n,r),m.scissor(e,t,n,r)},ct=function(e,n){var r=e.renderOrder||1e3,i=n.renderOrder||1e3,s,o=function(e,n){var r=["material","shader","uid"],i;for(i=0;i<r.length;i++){e=e[r[i]];if(!e)return p&&t.warn("Cannot find uid of "+e),n}return e};return s=function(e,t){return e.mesh.uid||t},r===i&&e.material&&n.material&&(r=o(e,r),i=o(n,r)),r===i&&e.mesh&&n.mesh&&(r=s(e,r),i=s(n,r)),r-i},ht=function(){function o(e,t){return t.distanceToCamera-e.distanceToCamera}var e=s.create(),t=b.position,n,r,i;for(n=Y.length-1;n>=0;n--)r=Y[n],i=r.gameObject.transform.position,r.distanceToCamera=s.squaredLength(s.subtract(e,i,t));Y.sort(o)},pt=function(){var e=o.create(),t=new Float32Array(24);return function(n,r){var i=function(n){var r=n.aabb,i=n.gameObject;return r&&i?(o.transform(e,r,i.transform.getGlobalMatrix()),u.intersectAabb(t,e)===u.OUTSIDE):!1},s=function(e){var t=e.length,n,s;for(n=0;n<t;n++)s=e[n],i(s)||s.render(J,r)};u.extractPlanes(t,J.viewProjectionMatrix,!1),J.sceneLights=n,s(G),s(Y),s(Z)}}(),dt=function(e){var t=e.directionalLight,i=t.gameObject.transform,o=t.shadowRenderTexture,u=o.dimension,a=u[0],f=u[1],l=s.create(),c=s.create();lt(0,0,a,f),o.bind(),at(D),m.clear(16640),r.copy(W,rt),l=n.multiplyVec3(l,b.rotation,[0,0,-it]),c=s.add(c,l,b.position),c[0]=Math.round(c[0]),c[1]=Math.round(c[1]),c[2]=Math.round(c[2]),r.setTRSInverse(X,c,i.localRotation,[1,1,1]),r.multiply(V,W,X),r.multiply($,r.multiply($,nt,W),X),pt(e,R)},vt={componentsAdded:function(e){var n,r,i,s;for(n=e.length-1;n>=0;n--)r=e[n],typeof r.render=="function"&&r.gameObject.layer&q&&(i=r.renderOrder||1e3,i<2e3?s=G:i>=3e3?s=Z:s=Y,t.contains(s,r)||t.insertSorted(r,s,ct))},componentsRemoved:function(e){var n=!1,r,i,s;for(r=e.length-1;r>=0;r--){s=e[r];if(typeof s.render=="function")for(i=et.length-1;i>=0;i--)n|=t.removeElementFromArray(et[i],s)}return n},componentUpdated:function(e){var t=[e],n=vt.componentsRemoved(t);n&&vt.componentsAdded(t)}};this.pickPoint=function(e,t,n){z||(z=new f(at,pt,U,y)),z.add({gameObjectPickedFn:e,x:t,y:g.viewportSize[1]-n,width:1,height:1,point:!0})},this.pick=function(e,t,n,r,i){r=r||1,i=i||1,z||(z=new f(at,pt,U)),z.add({gameObjectPickedFn:e,x:t,y:n,width:r,height:i})},this.setupCamera=function(){var e=T?T.dimension:g.viewportSize,t=e[0],n=e[1],i=t*tt[0],s=n*tt[1],o=t*tt[2],u=n*tt[3],a;lt(i,s,o,u),g.currentMaterial=null,g.renderTarget!==T&&(T?T.bind():m.bindFramebuffer(36160,null),g.renderTarget=T),at(_),m.clear(F),P?r.perspective(W,N,g.viewportSize[0]/g.viewportSize[1],C,k):r.ortho(W,L,A,O,M,C,k),a=b.getGlobalTRSInverse(),r.copy(X,a),r.multiply(V,W,X)},this.activated=function(){var e=this.gameObject,n,i,s,o;J.currentCameraTransform=e.transform,K||(K=!0,w.addContextListener(Q)),b=e.transform,m=w.gl,g=w.glState,U=e.scene,U.addComponentListener(vt),w.config.shadows?(s=w.project.load(w.project.ENGINE_SHADER___SHADOWMAP),o={name:"Shadow map material",shader:s},R=new l(o),it=w.config.shadowDistance*.5,n=it*1.55377397403004,i=-n*w.config.shadowNearMultiplier,rt=r.create(),r.ortho(rt,-n,n,-n,n,i,n)):x&&(x=!1,d&&t.fail("engine.config.shadows must be enabled for shadows"))},this.deactivated=function(){U.removeComponentListener(y)},this.renderScene=function(e){var t,n;if(!E)return;x&&e.directionalLight&&e.directionalLight.shadow&&(g.currentMaterial=null,dt(e)),y.setupCamera(),e.recomputeLight(X),Y.length>0&&ht(),pt(e,j),T&&T.colorTexture&&T.colorTexture.generateMipmaps&&(n=T.colorTexture.textureId,m.bindTexture(m.TEXTURE_2D,n),m.generateMipmap(m.TEXTURE_2D)),z&&z.handlePickRequests(e,J)},Object.defineProperties(this,{replacementMaterial:{get:function(){return j},set:function(e){j=e}},enabled:{get:function(){return E},set:function(e){E=e}},renderShadow:{get:function(){return x},set:function(e){w?w.config.shadows?x=e:e&&d&&t.fail("engine.config.shadows must be enabled for shadows"):x=e}},layerMask:{get:function(){return q},set:function(e){q=e}},renderTarget:{get:function(){return T},set:function(e){T=e}},fieldOfView:{get:function(){return N*57.2957795130824},set:function(e){N=Math.min(179,Math.max(e,1))*.01745329251994}},near:{get:function(){return C},set:function(e){C=e}},far:{get:function(){return k},set:function(e){k=e}},perspective:{get:function(){return P},set:function(e){P=e}},left:{get:function(){return L},set:function(e){L=e}},right:{get:function(){return A},set:function(e){A=e}},bottom:{get:function(){return O},set:function(e){O=e}},top:{get:function(){return M},set:function(e){M=e}},cameraIndex:{get:function(){return I},set:function(e){I=e}},clearColor:{get:function(){return i.clone(_)},set:function(e){_=i.clone(e)}},clearFlagColor:{get:function(){return H},set:function(e){ut(),H=e}},clearFlagDepth:{get:function(){return B},set:function(e){ut(),B=e}},normalizedViewportRect:{get:function(){return tt},set:function(e){i.copy(tt,e)}},viewportRect:{get:function(){var e=i.clone(tt),t=w.canvasDimension;return e[0]*=t[0],e[2]*=t[0],e[1]*=t[1],e[3]*=t[1],e},set:function(e){var n=i.clone(e),r=w.canvasDimension;n[0]/=r[0],n[2]/=r[0],n[1]/=r[1],n[3]/=r[1],i.copy(tt,n)}}}),this.destroy=function(){K&&(K=!1,w.removeContextListener(Q))},this.toJSON=function(){return{type:"kick/scene/Camera",uid:y.uid||(w?w.getUID(y):0),config:{enabled:E,renderShadow:x,layerMask:q,renderTarget:t.getJSONReference(T),fieldOfView:N,near:C,far:k,perspective:P,left:L,right:A,bottom:O,top:M,cameraIndex:I,clearColor:t.typedArrayToArray(_),clearFlagColor:H,clearFlagDepth:B,normalizedViewportRect:t.typedArrayToArray(tt)}}},t.applyConfig(this,v),ut()},v.prototype.setupClearFlags=function(e,t){this.clearColor=e,this.clearDepth=t,delete this._currentClearFlags},v}),define("kick/scene/Light",["kick/core/Constants","kick/core/Util","kick/math/Vec3","kick/texture/Texture","kick/texture/RenderTexture","kick/core/EngineSingleton"],function(e,t,n,r,i,s){var o=!1,u;return u=function(e){var a=this,f=n.clone([1,1,1]),l=s.engine,c=3,h=!1,p=1,d=.05,v=null,m=null,g=n.clone([1,0,0]),y=1,b,w=n.clone([1,1,1]),E=function(){n.copy(w,[f[0]*y,f[1]*y,f[2]*y])},S,x=!1,T,N=function(){if(h){if(!v){v=new r({minFilter:9728,magFilter:9728,wrapS:33071,wrapT:33071,flipY:!1,generateMipmaps:!1});var e=Math.min(l.gl.getParameter(34024),l.gl.getParameter(3379));e=Math.min(e,4096)*l.config.shadowMapQuality,v.setImageData(e,e,0,5121,null,""),m=new i({colorTexture:v})}}else m&&(m.destroy(),v.destroy(),m=null,v=null)};Object.defineProperties(this,{transform:{get:function(){return b}},shadowRenderTexture:{get:function(){return m}},shadowTexture:{get:function(){return v}},shadow:{get:function(){return h},set:function(e){e!==h&&(h=e,x&&N())},enumerable:!0},shadowStrength:{get:function(){return p},set:function(e){p=e},enumerable:!0},shadowBias:{get:function(){return d},set:function(e){d=e},enumerable:!0},color:{get:function(){return n.clone(f)},set:function(e){o&&e.length!==3&&t.fail("Light color must be vec3"),n.copy(f,e),E()},enumerable:!0},type:{get:function(){return c},set:function(e){x?o&&t.fail("Light type cannot be changed after initialization"):c=e},enumerable:!0},intensity:{get:function(){return y},set:function(e){y=e,E()},enumerable:!0},attenuation:{get:function(){return g},set:function(e){n.copy(g,e)},enumerable:!0},colorIntensity:{get:function(){return w},set:function(e){w=e},enumerable:!0},gameObject:{get:function(){return S},set:function(e){S=e}},scriptPriority:{get:function(){return T},set:function(e){T=e},enumerable:!0}}),this.activated=function(){var e=a.gameObject;x=!0,b=e.transform,N()},this.toJSON=function(){return t.componentToJSON(this,"kick.scene.Light")},t.applyConfig(this,e),t.copyStaticPropertiesToObject(this,u)},u.TYPE_AMBIENT=1,u.TYPE_DIRECTIONAL=2,u.TYPE_POINT=3,Object.freeze(u),u}),define("kick/scene/Transform",["kick/math/Mat4","kick/math/Vec3","kick/math/Quat","kick/core/Constants","kick/core/Util","kick/core/EngineSingleton"],function(e,t,n,r,i,s){var o=!1,u;return u=function(r){var a=e.create(),f=e.create(),l=e.create(),c=e.create(),h=t.create(),p=t.create(),d=n.create(),v=n.create(),m=t.clone([1,1,1]),g=0,y=1,b=2,w=3,E=4,S=5,x=new Int8Array(6),T=[],N=null,C=this,k=function(){var e;x[b]=1,x[w]=1,x[E]=1,x[S]=1;for(e=T.length-1;e>=0;e--)T[e]._markGlobalDirty()},L=function(){x[g]=1,x[y]=1,k()};Object.defineProperties(this,{gameObject:{value:r},position:{get:function(){return N===null?t.clone(p):(x[E]&&(e.multiplyVec3(h,C.getGlobalMatrix(),[0,0,0]),x[E]=0),t.clone(h))},set:function(e){var n;if(N===null){C.localPosition=e;return}n=C.position,t.copy(p,e),C.localPosition=[p[0]+n[0]-e[0],p[1]+n[1]-e[1],p[2]+n[2]-e[2]],L()}},localPosition:{get:function(){return t.clone(p)},set:function(e){t.copy(p,e),L()}},localRotationEuler:{get:function(){var e=t.create();return n.toEuler(e,v),e},set:function(e){n.setEuler(v,e),L()}},rotationEuler:{get:function(){var e=t.create();return n.toEuler(e,C.rotation),e},set:function(e){var t=n.create();n.setEuler(t,e),this.rotation=t}},rotation:{get:function(){var e=null;if(N===null)return n.clone(v);if(x[S]){n.copy(d,v),e=C.parent;while(e!==null)n.multiply(d,e.localRotation,d),e=e.parent;x[S]=!1}return d},set:function(e){if(N===null){this.localRotation=e;return}var t=n.create();n.difference(t,e,C.rotation),this.localRotation=n.multiply(v,v,t)}},localRotation:{get:function(){return v},set:function(e){n.copy(v,e),L()}},localScale:{get:function(){return t.clone(m)},set:function(e){var n;t.copy(m,e);for(n=0;n<m.length;n++)m[n]===0&&(m[n]=1e-5);L()}},children:{value:T},parent:{get:function(){return N},set:function(e){e===this&&i.fail("Cannot assign parent to self"),o&&typeof e=="undefined"&&i.fail("Cannot set newParent to undefined - should be null"),e!==N&&(e===null?(N=null,i.removeElementFromArray(e.children,this)):(N=e,e.children.push(this)),k())}}}),this.lookAt=function(e,t){o&&(e instanceof u||i.fail("transform must be a kick.scene.Transform")),n.lookAt(v,C.position,e.position,t),L()},this.getLocalMatrix=function(){return x[g]&&(e.setTRS(a,p,v,m),x[g]=0),a},this.getLocalTRSInverse=function(){return x[y]&&(e.setTRSInverse(l,p,v,m),x[y]=0),l},this.getGlobalMatrix=function(){if(x[b]){e.copy(f,C.getLocalMatrix());var t=C.parent;while(t!==null)e.multiply(f,t.getLocalMatrix(),f),t=t.parent;x[b]=0}return f},this.getGlobalTRSInverse=function(){if(x[w]){e.copy(c,C.getLocalTRSInverse());var t=C.parent;while(t!==null)e.multiply(c,c,t.getLocalTRSInverse()),t=t.parent;x[w]=0}return c},this._markGlobalDirty=k,this.toJSON=function(){var e=i.typedArrayToArray;return o&&(C.gameObject||i.fail("Cannot serialize a Transform object that has no reference to gameObject")),{type:"kick.scene.Transform",uid:s.engine.getUID(C),config:{localPosition:e(p),localRotation:e(v),localScale:e(m),parent:N?i.getJSONReference(N):null}}},this.str=function(){return JSON.stringify(C.toJSON())}},u}),define("kick/scene/GameObject",["./Transform","kick/core/Util","kick/core/Constants"],function(e,t,n){var r=!1;return function(n,i){var s=new e(this),o=[s],u=1,a,f=n.engine.createUID(),l=this;Object.defineProperties(this,{scene:{value:n},engine:{get:function(){return r&&t.fail("GameObject.engine is deprecated. Use EngineSingleton.engine instead."),n.engine}},transform:{value:s},layer:{get:function(){return u},set:function(e){typeof e!="number"&&t.fail("GameObject.layer must be a Number"),u=e}},name:{get:function(){return a},set:function(e){a=e}},uid:{get:function(){return f},set:function(e){f=e}},numberOfComponents:{get:function(){return o.length}},destroyed:{get:function(){return o.length===0}}}),this.getComponent=function(e){return o[e]},this.addComponent=function(i){if(i instanceof e){r&&t.fail("Cannot add another Transform to a GameObject");return}if(i.gameObject)throw{name:"Error",message:"Component "+i+" already added to gameObject "+i.gameObject};i.scriptPriority||(i.scriptPriority=0),i.gameObject=this,o.push(i),n.addComponent(i)},this.removeComponent=function(e){try{delete e.gameObject}catch(r){}t.removeElementFromArray(o,e),n.removeComponent(e)},this.notifyComponentUpdated=function(e){n.notifyComponentUpdated(e)},this.destroy=function(){var e;for(e=o.length-1;e>=0;e--)l.removeComponent(o[e]);n.destroyObject(l)},this.getComponentOfType=function(e){var t,n;for(n=o.length-1;n>=0;n--){t=o[n];if(t instanceof e)return t}return null},this.getComponentsOfType=function(e){var t,n,r=[];for(n=o.length-1;n>=0;n--)t=o[n],t instanceof e&&r.push(t);return r},this.getComponentsWithMethod=function(e){var t,n;for(n=o.length-1;n>=0;n--){t=o[n];if(typeof t[e]=="function")return t}return null},this.getComponentsWithMethod=function(e){var t,n,r=[];for(n=o.length-1;n>=0;n--)t=o[n],typeof t[e]=="function"&&r.push(t);return r},this.toJSON=function(){var e=[],n,r,i;for(r=0;r<o.length;r++)n=o[r],n.toJSON?(i=n.toJSON(),i&&e.push(i)):e.push(t.componentToJSON(n));return{name:a,layer:u,uid:f,components:e}},function(){t.applyConfig(l,i,["uid"])}()}}),define("kick/scene/ComponentChangedListener",[],function(){return{isComponentListener:function(e){return e&&typeof e.componentsAdded=="function"&&typeof e.componentsRemoved=="function"}}}),define("kick/scene/Scene",["require","kick/core/ProjectAsset","./SceneLights","kick/core/Constants","kick/core/Util","./Camera","./Light","./GameObject","./ComponentChangedListener","kick/core/EngineSingleton"],function(e,t,n,r,i,s,o,u,a,f){var l=!1,c=!1,h;return h=function(r){t(this,r,"kick.scene.Scene"),c&&r===f.engine&&i.fail("Scene constructor changed - engine parameter is removed");var h=f.engine,p={},d=[],v=[],m=[],g=[],y=[],b=[],w=[],E=[],S=[],x=[],T=[],N=new n(h.config.maxNumerOfLights),C="Scene",k,L,A=this,O=function(e){e.type===o.TYPE_AMBIENT?N.ambientLight=e:e.type===o.TYPE_DIRECTIONAL?N.directionalLight=e:N.addPointLight(e)},M=function(e){e.type===o.TYPE_AMBIENT?N.ambientLight=null:e.type===o.TYPE_DIRECTIONAL?N.directionalLight=null:N.removePointLight(e)},_=function(e,t){return e.scriptPriority-t.scriptPriority},D=function(e,t){return t.cameraIndex-e.cameraIndex},P=function(){var e,t,n;m.length>0&&(v=v.concat(m),m.length=0);if(b.length>0){n=b,b=[];for(e=n.length-1;e>=0;e--)t=n[e],S.push(t),typeof t.activated=="function"&&t.activated(),typeof t.update=="function"&&i.insertSorted(t,y,_),typeof t.render=="function"&&T.push(t),typeof t.render=="function"&&i.removeElementFromArray(T,t),t instanceof s?i.insertSorted(t,x,D):t instanceof o&&O(t);for(e=E.length-1;e>=0;e--)E[e].componentsAdded(n)}},H=function(){var e,t,n;g.length>0&&(i.removeElementsFromArray(v,g),i.removeElementsFromArray(d,g),g.length=0);if(w.length>0){n=w,w=[];for(e=n.length-1;e>=0;e--)t=n[e],i.removeElementFromArray(S,t),typeof t.deactivated=="function"&&t.deactivated(),typeof t.update=="function"&&i.removeElementFromArray(y,t),t instanceof s?i.removeElementFromArray(x,t):t instanceof o&&M(t);for(e=E.length-1;e>=0;e--)E[e].componentsRemoved(n)}},B=function(){H(),P();var e;for(e=y.length-1;e>=0;e--)y[e].update()},j=function(){var e;for(e=x.length-1;e>=0;e--)x[e].renderScene(N);h.gl.flush()},F=function(e){var t=new u(A,e);return m.push(t),d.push(t),p[t.uid]=t,t};this.notifyComponentUpdated=function(e){for(L=E.length-1;L>=0;L--)E[L].componentUpdated(e)},this.destroy=function(){h.project.removeResourceDescriptor(A.uid),A===h.activeScene&&(h.activeScene=null)},this.addComponentListener=function(e){a.isComponentListener(e)||i.fail("Component listener does not have the correct interface. It should contain the two functions: componentsAdded(components) and componentsRemoved(components)"),e.componentUpdated||(e.componentUpdated=function(){},l&&i.warn("componentListener has no componentUpdated method")),E.push(e),e.componentsAdded(S)},this.findComponentsOfType=function(e){c&&typeof e!="function"&&i.fail("Scene.findComponentsOfType expects a function");var t=[],n,r,s;for(n=d.length-1;n>=0;n--){s=d[n].getComponentsOfType(e);for(r=0;r<s.length;r++)t.push(s[r])}return t},this.removeComponentListener=function(e){i.removeElementFromArray(E,e)},this.addComponent=function(e){i.insertSorted(e,b,_);var t=h.getUID(e);c&&p[t]&&i.fail("Component with uid "+t+" already exist"),p[t]=e},this.getObjectByUID=function(e){return p[e]},this.getGameObjectByName=function(e){var t,n;for(t=d.length-1;t>=0;t--){n=d[t];if(n.name===e)return n}},this.removeComponent=function(e){i.removeElementFromArray(b,e),w.push(e),delete p[e.uid]},Object.defineProperties(this,{engine:{value:h},name:{get:function(){return C},set:function(e){C=e}}}),this.createGameObject=function(e){var t=F(e),n=t.transform;return p[h.getUID(n)]=n,t},this.destroyObject=function(e){var t=i.contains(g,e);t||(g.push(e),delete p[e.uid]),e.destroyed||e.destroy()},this.getNumberOfGameObjects=function(){return d.length},this.getGameObject=function(e){return d[e]},this.updateAndRender=function(){B(),j()},this.toJSON=function(e){var t=[],n,r;e=e||function(){return!0};for(n=0;n<d.length;n++)r=d[n],e(r)&&t.push(r.toJSON());return{uid:A.uid,gameObjects:t,name:C}},this.init=function(t){var n,r=i.hasProperty,s=i.applyConfig,o,u=function(e){var t={},n,s;for(n in e)e.hasOwnProperty(n)&&r(e,n)&&(s=e[n],s=i.deserializeConfig(s,A),t[n]=s);return t};if(t){C=t.name||"Scene";var a=t.gameObjects||[],f={},l=[],c={};(function(){for(o=0;o<a.length;o++)n=t.gameObjects[o],l[o]=F(n),f[n.uid]=l[o]})(),function(){var a,h,d,v,m=t.gameObjects||[],g,y,b,w,E,S;for(g=0;g<m.length;g++){v=t.gameObjects[g],n=l[g];for(y=0;v.components&&y<v.components.length;y++){a=v.components[y];if(a.type==="kick.scene.Transform")h=n.transform,h.uid=a.uid,p[h.uid]=h;else{d=e(a.type.replace(/\./g,"/"));if(typeof d!="function"){i.warn("Cannot find Class "+a.type);continue}h=new d({uid:a.uid}),h.uid=a.uid,n.addComponent(h)}f[a.uid]=h,c[a.uid]=a.config}}for(b in f)f.hasOwnProperty(b)&&r(f,b)&&(w=c[b],w&&(E=u(w),S=f[b],s(S,E)))}()}},this.init(r)},h.createDefault=function(e){var t=new h(e),n=t.createGameObject();return n.addComponent(new s),t},h}),define("kick/math/Mat2",[],function(){return{create:function(){var e=new Float32Array(4);return e[0]=1,e[3]=1,e},clone:function(e){var t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},transpose:function(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},invert:function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n*s-i*r;return o?(o=1/o,e[0]=s*o,e[1]=-r*o,e[2]=-i*o,e[3]=n*o,e):null},adjoint:function(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e},determinant:function(e){return e[0]*e[3]-e[2]*e[1]},multiply:function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=n[0],a=n[1],f=n[2],l=n[3];return e[0]=r*u+i*f,e[1]=r*a+i*l,e[2]=s*u+o*f,e[3]=s*a+o*l,e},rotate:function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a+i*u,e[1]=r*-u+i*a,e[2]=s*a+o*u,e[3]=s*-u+o*a,e},scale:function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=n[0],a=n[1];return e[0]=r*u,e[1]=i*a,e[2]=s*u,e[3]=o*a,e},str:function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"},strPretty:function(e){return"["+e[0]+", "+e[2]+"\n"+", "+e[1]+", "+e[3]+"]"}}}),define("kick/math",["./math/Vec2","./math/Vec3","./math/Vec4","./math/Mat2","./math/Mat3","./math/Mat4","./math/Quat","./math/Frustum","./math/Aabb"],function(e,t,n,r,i,s,o,u,a){return{Vec2:e,Vec3:t,Vec4:n,Mat2:r,Mat3:i,Mat4:s,Quat:o,Frustum:u,Aabb:a}}),define("kick/core/Time",[],function(){return function(){this.time=0,this.deltaTime=0,this.frame=0,this.scale=0}}),define("kick/core/WebGLDebugUtils",["./Constants"],function(e){return{}}),define("kick/core/Shim",[],function(){typeof window.requestAnimationFrame=="undefined"&&(window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){var n=16.7;return window.setTimeout(e,n,(new Date).getTime())}}()),typeof window.cancelAnimationFrame=="undefined"&&(window.cancelAnimationFrame=function(){return window.cancelAnimationFrame||window.cancelRequestAnimFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}()),typeof window.console=="undefined"&&(window.console={}),typeof window.console.log=="undefined"&&(window.console.log=function(e){alert(e)})}),define("kick/core/Engine",["require","./GLState","./Project","./Constants","./ResourceLoader","./MouseInput","./KeyInput","./Config","./Util","./EventQueue","kick/scene/Scene","kick/math","./Time","./WebGLDebugUtils","./EngineSingleton","./Shim"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=!1,g=null,y=function(e,c){var v=new t,y=null,b=typeof e=="string"?document.getElementById(e):e,w=["experimental-webgl","webgl"],E=this,S=(new Date).getTime()-16,x=0,T=new h,N=0,C=0,k=1,L=[],A=[],O,M=new n(this),_=null,D=null,P,H={updateAndRender:function(){}},B={},j=function(e){e<1e12&&(e=Date.now()),E._gameLoop(e)};Object.defineProperties(this,{version:{value:"0.5.0"},resourceLoader:{value:new i(E)},project:{value:M},glState:{get:function(){return v}},gl:{get:function(){return y}},canvas:{value:b},activeScene:{get:function(){return P===H?null:P},set:function(e){e===null||typeof e=="undefined"?P=H:P=e}},mouseInput:{get:function(){return _||(_=new s(E),E.addFrameListener(_)),_}},keyInput:{get:function(){return D||(D=new o,E.addFrameListener(D)),D}},eventQueue:{get:function(){return O}},canvasDimension:{get:function(){return new Float32Array([b.width,b.height])}},time:{value:T},config:{value:new u(c||{})},paused:{get:function(){return B===null},set:function(e){var t=E.paused;e!==t&&(e?(window.cancelAnimationFrame(B),B=null):(S=(new Date).getTime()-16,B=window.requestAnimationFrame(j,E.canvas)))}}}),this.isFullScreenSupported=function(){return b.requestFullscreen||b.webkitRequestFullScreen||b.mozRequestFullScreen},this.setFullscreen=function(e){E.isFullScreenSupported()&&(e?b.requestFullscreen?b.requestFullscreen():b.webkitRequestFullScreen?(b.onwebkitfullscreenchange=function(){document.webkitIsFullScreen?(b.originalWidth=b.width,b.originalHeight=b.height,b.width=screen.width,b.height=screen.height):(b.width=b.originalWidth,b.height=b.originalHeight),E.canvasResized()},b.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)):b.mozRequestFullScreen&&b.mozRequestFullScreen():document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen())},this._gameLoop=function(e){var t;x=e-S,S=e,x*=k,N+=x,C+=1,O.run(),P.updateAndRender();for(t=A.length-1;t>=0;t--)A[t].frameUpdated();B!==null&&(B=window.requestAnimationFrame(j,E.canvas))},this.addFrameListener=function(e){m&&typeof e.frameUpdated!="function"&&a.fail("frameListener must define the method frameUpdated"),A.push(e)},this.removeFrameListener=function(e){return a.removeElementFromArray(A,e)},this.addContextListener=function(e){m&&(typeof e.contextLost!="function"||typeof e.contextRestored!="function")&&a.fail("contextLostListener must define the functions contextLost() and contextRestored(gl)"),L.push(e)},this.removeContextListener=function(e){return a.removeElementFromArray(L,e)},this.createUID=function(){return++M.maxUID},this.getUID=function(e){return e.uid||(e.uid=E.createUID()),e.uid},this.canvasResized=function(){v.viewportSize=E.canvasDimension,_&&_.updateCanvasElementPosition()},function(){var t=r,n,i,s,o=function(){if(E.config.highDPISupport){var e=window.devicePixelRatio||1;b.width=b.clientWidth*e,b.height=b.clientHeight*e}for(n=w.length-1;n>=0;n--)try{y=b.getContext(w[n],E.config);if(y)break}catch(t){alert(t)}if(!y)return!1;if(E.config.enableDebugContext)if(p&&!1){var r=function(e,t){var n;for(n=0;n<t.length;++n)t[n]===undefined&&console.error("undefined passed to gl."+e+"("+p.glFunctionArgsToString(e,t)+")")};y=p.makeDebugContext(y,undefined,r)}else console.log("webgl-debug.js not included - cannot find WebGLDebugUtils");return Object.freeze(y),y.enable(2929),y.enable(3089),!0};d.engine=E,g=E,i=o();if(!i){E.config.webglNotFoundFn(b);return}b.addEventListener("webglcontextlost",function(e){s=E.paused,E.paused=!0;for(n=0;n<L.length;n++)L[n].contextLost();e.preventDefault(),y=null},!1),b.addEventListener("webglcontextrestored",function(e){v.clear(),E.canvasResized(),o();for(n=0;n<L.length;n++)L[n].contextRestored(y);s||(E.paused=!1),e.preventDefault()},!1),E.canvasResized(),E.config.checkCanvasResizeInterval&&setInterval(function(){(b.height!==v.viewportSize[0]||b.width!==v.viewportSize[1])&&E.canvasResized()},E.config.checkCanvasResizeInterval),Object.defineProperties(T,{time:{get:function(){return N}},deltaTime:{get:function(){return x}},frame:{get:function(){return C}},scale:{get:function(){return k},set:function(e){k=e}}}),Object.freeze(T),P=new l,O=new f(E),N=0,C=0,E._gameLoop(S)}()};return Object.defineProperties(y,{instance:{get:function(){return g}}}),y}),define("kick/core/ResourceProvider",[],function(){return{}}),define("kick/core",["./core/BuiltInResourceProvider","./core/ChunkData","./core/Config","./core/Constants","./core/Engine","./core/EventQueue","./core/GLState","./core/KeyInput","./core/MouseInput","./core/Project","./core/ProjectAsset","./core/ResourceDescriptor","./core/ResourceLoader","./core/ResourceProvider","./core/Time","./core/URLResourceProvider","./core/Util","./core/EngineSingleton"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){return{BuiltInResourceProvider:e,ChunkData:t,Config:n,Constants:r,Engine:i,EngineSingleton:g,EventQueue:s,GLState:o,KeyInput:u,MouseInput:a,Project:f,ProjectAsset:l,ResourceDescriptor:c,ResourceLoader:h,ResourceProvider:p,Time:d,URLResourceProvider:v,Util:m}}),define("kick/importer/ColladaImporter",["kick/math","kick/core/Constants","kick/core/Util","kick/mesh/MeshData","kick/mesh/Mesh","kick/scene/MeshRenderer","kick/material/Material","kick/core/EngineSingleton"],function(e,t,n,r,i,s,o,u){var a=!1,f=e.Quat,l=e.Mat4,c=function(e,t){return e.querySelector("[id="+t+"]")},h={};return h.import=function(h,p,d){a&&p===u.engine&&n.fail("ColladaImporter function changed - engine parameter is removed");if(typeof h=="string"){var v=new window.DOMParser;h=v.parseFromString(h,"text/xml")}var m=u.engine,g={},y=[],b=[],w=t,E=function(e,t){t||(t=Array),e=e.replace(/^\s+|\s+$/g,""),e=e.replace(/\s{2,}/g," ");var n=e.split(" ").map(Number);return!t||t===Array?n:new t(n)},S=function(e){e.charAt(0)==="#"&&(e=e.substring(1));if(g[e])return g[e];var t=c(h,e),n,r;return t.tagName==="float_array"?n=Float32Array:n=Int32Array,r=E(t.textContent,n),g[e]=r,r},x=function(e){var t=e.getAttribute("semantic"),n=c(h,e.getAttribute("source").substring(1)),r,i,s,o,u,a,f;return n.tagName==="vertices"&&(n=n.getElementsByTagName("input")[0],n=c(h,n.getAttribute("source").substring(1))),r=n.getElementsByTagName("technique_common")[0],i=r.getElementsByTagName("accessor")[0],s=Number(i.getAttribute("count")),o=Number(i.getAttribute("stride")),u=Number(i.getAttribute("offset")),u||(u=0),a=i.getAttribute("source"),f=S(a),function(e,t){var n=u+o*e+t;return f[n]}},T=function(e,t,r){var i=e.firstChild,s,o,u,a=function(){return 3},f=Number(e.getAttribute("count")),l={names:[],offset:{},accessors:{},length:{}},c=[],h=n.contains,p=r.numberOfVertices||0,d,v,m,g,y,b,w;while(i!==null){s=i.tagName;if(s==="input")d=i.getAttribute("semantic"),v=Number(i.getAttribute("offset")),l.accessors[d]=new x(i),l.names.push(d),l.offset[d]=v,l.length[d]=d==="TEXCOORD"?2:3,h(c,v)||c.push(v);else if(s==="vcount")m=E(i.textContent,Int32Array),a=function(e){return m[e]};else if(s==="p"){g=c.length,y=E(i.textContent,Int32Array),b={};for(o=0;o<l.names.length;o++)b[l.names[o]]=[];w=function(e,t,n){var i="",s,o,u,a,f,c=e*g,h,d,v,m,b,w;for(a=0;a<l.names.length;a++)u=l.names[a],s=l.offset[u],o=y[s+c],i+=e+"#"+o+"#";h=r[i],d=typeof h=="number";if(d)n.push(h);else{for(a=0;a<l.names.length;a++){u=l.names[a],v=l.accessors[u],m=l.length[u],s=l.offset[u],o=y[s+c];for(f=0;f<m;f++)b=v(o,f),t[u].push(b)}w=p,p+=1,n.push(w),r[i]=w}};var S=0,T=[];for(o=0;o<f;o++){var N=a(o);for(u=0;u<3;u++)w(S+u,b,T);for(u=3;u<N;u++)w(S,b,T),w(S+u-1,b,T),w(S+u,b,T);S+=N}for(o=0;o<l.names.length;o++){var C=l.names[o],k=C.toLowerCase();k==="texcoord"&&(k="uv1");if(t[k]&&t[k].length){var L=n.typedArrayToArray,A=L(t[k]),O=L(b[C]);A.push.apply(A,O),t[k]=A}else t[k]=b[C]}t.meshType=4;var M=t.subMeshes;M.push(T),t.subMeshes=M}i=i.nextSibling}r.numberOfVertices=p},N=function(e,t,i){var s,o,u=i.getAttribute("name")||"MeshData",a,f=i.getElementsByTagName("mesh");if(f.length===0)return null;var l={};f=f[0],o=f.firstChild;while(o!==null)s=o.tagName,s==="lines"?n.warn("Collada importer: lines - unsupported"):s==="linestrips - unsupported"?n.warn("Collada importer:linestrips - unsupported"):s==="polygons"?n.warn("Collada importer:polygons  - unsupported"):s==="polylist"||s==="triangles"?(a||(a=new r({name:u})),T(o,a,l)):s==="trifans"?n.warn("Collada importer: Trifans unsupported"):s==="tristrips"&&n.warn("Collada importer: Tristrips - unsupported"),o=o.nextSibling;return a},C=function(e,t){var n=[],r,s;if(H[t])return H[t];t&&t.charAt(0)==="#"&&(t=t.substring(1));for(r=0;r<_.length;r++){s=_[r];if(s.getAttribute("id")===t){var o=N(h,e,s);if(o){var u=new i({meshData:o,name:o.name+" mesh"});y.push(u),n.push(u)}break}}return H[t]=n,n},k=function(t,r){var i=r.tagName,s=r.getAttribute("sid"),o,u,a,c,h=e.Vec3.create(),p=e.Quat.create(),d=e.Vec3.create(),v=t.getLocalMatrix(),m=l.identity(l.create());if(i==="translate")l.translate(m,m,E(r.textContent));else if(i==="rotate"){o=E(r.textContent),u=o[3];if(!u)return;a=f.setAxisAngle(e.Quat.create(),o,u*.01745329251994),f.toMat4(m,a)}else if(i==="scale")l.scale(m,m,E(r.textContent));else{if(i!=="matrix"){n.warn("Collada importer:"+i+" - unsupported");return}l.transpose(E(r.textContent),m)}l.multiply(m,v,m),l.decompose(m,h,p,d),t.localPosition=h,t.localRotation=p,t.localScale=d},L=function(e,t){var n=t.getAttribute("url"),r,i,u,a;n&&(n=n.substring(1)),i=C(m,n);for(u=0;u<i.length;u++)r=new s,r.mesh=i[u],a=new o({name:"Some material",shader:m.project.load(m.project.ENGINE_SHADER_DEFAULT)}),r.material=a,b.push(a),e.addComponent(r)},A=function(e,t){var r=p.createGameObject(),i=r.transform,s,o;t&&(i.parent=t),r.name=e.getAttribute("id"),P.push(r),s=e.firstElementChild;while(s)o=s.tagName,o==="translate"||o==="rotate"||o==="scale"||o==="matrix"?k(i,s):o==="instance_geometry"?L(r,s):o==="node"?A(s,i):n.warn("Collada importer: ignore collada tagName '"+o+"'"),s=s.nextElementSibling},O=h.firstChild.getElementsByTagName("library_geometries"),M=h.firstChild.getElementsByTagName("visual_scene"),_,D;p||(p=m.activeScene),O.length===0,O=O[0],_=O.getElementsByTagName("geometry");var P=[],H={};for(D=0;D<M.length;D++){var B=M[D],j=B.firstElementChild;while(j)A(j,null),j=j.nextElementSibling}if(d){var F=p.createGameObject({name:"Collada Parent"}),I=F.transform;I.localRotationEuler=[-90,0,0];for(D=0;D<P.length;D++){var q=P[D].transform;q.parent||(q.parent=I)}P.push(F)}return{mesh:y,gameObjects:P,materials:b}},h}),define("kick/importer/ObjImporter",["kick/math","kick/mesh/MeshData","kick/mesh/Mesh","kick/scene/MeshRenderer","kick/material/Material","kick/core/Constants","kick/core/EngineSingleton"],function(e,t,n,r,i,s,o){var u=!1,a=e.Quat,f=e.Mat4,l={};return l.import=function(e,s,a){u&&s===o.engine&&Util.fail("ObjImporter function changed - engine parameter is removed");var l=o.engine,c=e.split("\n"),h=c.length,p=[],d=[],v=[],m=[],g=[],y=[m],b=[],w=[],E=[],S="MeshObject",x,T,N=function(e){return e.replace(/^\s+|\s+$/g,"")},C=function(e,t){t||(t=Array),e=e.replace(/^\s+|\s+$/g,""),e=e.replace(/\s{2,}/g," ");var n=e.split(" ").map(Number);return!t||t===Array?n:new t(n)},k=function(e){var t=[],n,r,i,s;for(n=0;n<e.length;n++)r=e[n],i=r.split("/"),s=parseInt(i[0],10),t.push([s,i.length>=2?parseInt(i[1],10):s,i.length>=3?parseInt(i[2],10):s]);return t},L=function(){var e=function(e,t,n){var r=e[t-1],i;for(i=0;i<r.length;i++)n.push(r[i])};if(p.length===0)return;var o=s.createGameObject(),u=new t,a=new n,f=[],c=[],h=[],x,T=[],N={},C=0,L,A,O,M,_,D;E.push(a);for(M=0;M<y.length;M++){m=y[M],x=[],T.push(x);for(_=0;_<m.length;_++){L=m[_],A=k(L);for(D=0;D<3;D++)O=L[D],typeof N[O]=="number"?x.push(N[O]):(e(p,A[D][0],f),v.length&&e(v,A[D][1],h),d.length&&e(d,A[D][2],c),x.push(C),N[O]=C,C++)}}u.vertex=f,c.length&&(u.normal=c),h.length&&(u.uv1=h),u.subMeshes=T,a.meshData=u,a.name=S+" mesh";var P=new r;P.mesh=a;var H=[],B=function(e){var t=new i({name:e,shader:l.project.load(l.project.ENGINE_SHADER_DEFAULT)});H.push(t),w.push(t)};for(_=0;_<T.length;_++)if(_<g.length){var j=g[_],F=l.project.loadByName(j,"kick.material.Material");F?H.push(F):B(j)}else B("material");P.materials=H,o.name=S,o.addComponent(P),b.push(o),m=[]},A=f.identity(f.create());a&&f.rotateX(A,-1.5707963267946);for(x=0;x<h;x++){var O=N(c[x]),M=O.indexOf(" ");if(M<0)continue;var _=O.substring(0,M),D=O.substring(M+1);if(_==="o")L(),S=D,g.length=0;else if(_==="usemtl")g.push(D),m.length>0&&(m=[],y[y.length]=m);else if(_==="v"){var P=C(D);f.multiplyVec3(P,A,P),p.push(P)}else if(_==="vn"){var H=C(D);f.multiplyVec3(H,A,H),d.push(H)}else if(_==="vt")v.push(C(D));else if(_==="f"){var B=D.split(" ");m.push(B.slice(0,3));for(T=3;T<B.length;T++)m.push([B[T-1],B[T],B[0]])}}return L(),{mesh:E,gameObjects:b,materials:w}},l}),define("kick/importer",["./importer/ColladaImporter","./importer/ObjImporter"],function(e,t){return{ColladaImporter:e,ObjImporter:t}}),define("kick/material",["./material/GLSLConstants","./material/Material","./material/MaterialUniform","./material/Shader","./material/UniformDescriptor"],function(e,t,n,r,i){return{GLSLConstants:e,Material:t,MaterialUniform:n,Shader:r,UniformDescriptor:i}}),define("kick/mesh",["./mesh/Mesh","./mesh/MeshData","./mesh/MeshDataFactory"],function(e,t,n){return{Mesh:e,MeshData:t,MeshDataFactory:n}}),define("kick/scene/Component",[],function(){return{}}),define("kick/scene",["./scene/Camera","./scene/Component","./scene/ComponentChangedListener","./scene/EngineUniforms","./scene/GameObject","./scene/Light","./scene/MeshRenderer","./scene/Scene","./scene/SceneLights","./scene/Transform"],function(e,t,n,r,i,s,o,u,a,f){return{Camera:e,Component:t,ComponentChangedListener:n,EngineUniforms:r,GameObject:i,Light:s,MeshRenderer:o,Scene:u,SceneLights:a,Transform:f}}),define("kick/texture/MovieTexture",["kick/core/ProjectAsset","kick/core/Constants","kick/core/Util","kick/core/EngineSingleton"],function(e,t,n,r){return function(t){e(this,t,"kick.texture.MovieTexture");var i=r.engine,s=i.gl,o=i.glState,u=33984,a="MovieTexture",f=null,l=s.createTexture(),c=33071,h=33071,p=9728,d=9728,v=6408,m=0,g=!1,y=i.time,b=this,w=-1;this.bind=function(e){s.activeTexture(u+e),s.bindTexture(3553,l),w<y.frame&&f&&(w=y.frame+m,s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!0),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,f),g&&s.generateMipmap(3553))},this.destroy=function(){l!==null&&(o.currentMaterial=null,s.deleteTexture(l),l=null,i.project.removeResourceDescriptor(b.uid))},this.setTemporaryTexture=function(){var e=new Uint8Array([255,255,255,0,0,0,0,0,0,255,255,255]);b.bind(0),s.pixelStorei(3317,1),s.texImage2D(3553,0,6407,2,2,0,6407,5121,e),s.texParameteri(3553,10240,d),s.texParameteri(3553,10241,p),s.texParameteri(3553,10242,c),s.texParameteri(3553,10243,h),o.currentMaterial=null},Object.defineProperties(this,{name:{get:function(){return a},set:function(e){a=e}},skipFrames:{get:function(){return m},set:function(e){m=e}},videoElement:{get:function(){return f},set:function(e){f=e}},generateMipmaps:{get:function(){return g},set:function(e){g=e}},textureId:{value:l},wrapS:{get:function(){return c},set:function(e){c=e}},wrapT:{get:function(){return h},set:function(e){h=e}},minFilter:{get:function(){return p},set:function(e){p=e}},magFilter:{get:function(){return d},set:function(e){d=e}},internalFormat:{get:function(){return v},set:function(e){e!==6406&&e!==6407&&e!==6408&&e!==6409&&e!==6410&&n.fail("Texture.internalFormat should be either GL_ALPHA, GL_RGB, GL_RGBA, GL_LUMINANCE, or LUMINANCE_ALPHA"),v=e}}}),this.toJSON=function(){return{uid:b.uid,wrapS:c,wrapT:h,minFilter:p,name:a,magFilter:d,internalFormat:v}},this.init(t)}}),define("kick/texture",["./texture/MovieTexture","./texture/RenderTexture","./texture/Texture"],function(e,t,n){return{MovieTexture:e,RenderTexture:t,Texture:n}}),define("kick",["kick/core","kick/importer","kick/material","kick/math","kick/mesh","kick/scene","kick/texture"],function(e,t,n,r,i,s,o){return{core:e,importer:t,material:n,math:r,mesh:i,scene:s,texture:o}});